import{_ as ue,m as _e,p as fe,r,Q as me,T as ge,G as he,a as o,o as d,l as g,d as e,w as t,e as a,f as C,D as S,j as n,x as h,c as y,i as D,F as G,C as J,z as ve,A as ye,n as be}from"./index.2b31a27b.js";import{d as xe,u as ke,q as we}from"./datasetKnowledge.f95e40db.js";const F=z=>(ve("data-v-43f04da6"),z=z(),ye(),z),Ce={class:"app-container"},Se=F(()=>a("span",{class:"text-large font-600 mr-3",style:{"font-size":"16px"}}," [\u6D4B\u8BD5\u6570\u636E\u96C6] \u4E0A\u4F20",-1)),ze={class:"step-container"},Ve={key:0,class:"step-content"},Ie=F(()=>a("div",{class:"el-upload__text"},[n(" \u5C06\u6587\u4EF6\u62D6\u5230\u6B64\u5904\uFF0C\u6216"),a("em",null,"\u70B9\u51FB\u4E0A\u4F20"),a("div",{class:"el-upload__tip text-center"},[a("span",null,[n(" \u652F\u6301.txt,.docx,.csv,.xlsx,.pdf,.md,.html,.pptx \u7C7B\u578B\u6587\u4EF6 "),a("br"),n(" \u6700\u591A\u652F\u6301 10 \u4E2A\u6587\u4EF6\u5355\u4E2A\u6587\u4EF6\u6700\u5927 50 MB ")])])],-1)),De={class:"file-list"},Fe={key:1,class:"step-content"},Ue=F(()=>a("div",{class:"step-content-title"},"\u6570\u636E\u5904\u7406\u65B9\u5F0F",-1)),Be={style:{display:"flex","align-items":"center",gap:"3px"}},Te={style:{display:"flex","align-items":"flex-start",gap:"3px","flex-direction":"column"}},Pe=F(()=>a("div",{class:"step-content-title"},"\u4E0A\u4F20\u6587\u4EF6\u5217\u8868",-1)),Ne={class:"file-list"},Le={key:2,class:"step-content"},$e={class:"file-list"},Re={key:1},qe={__name:"dataUpload",setup(z){const{proxy:b}=be(),R=_e(),x=fe("datasetId"),H=r("right"),_=r(1);r([]);const c=r({processingMethod:"direct_segmentation",processingParam:"\u81EA\u52A8",idealChunkLength:"512",customSplitSymbol:`
;======;==SPLIT==`}),q=r(null),W=r(null),k=r(!1),X=r(0),Y=r([{code:"direct_segmentation",name:"\u76F4\u63A5\u5206\u6BB5",icon:""},{code:"enhanced_processing",name:"\u589E\u5F3A\u5904\u7406",icon:""},{code:"qa_split",name:"\u95EE\u7B54\u62C6\u5206",icon:""}]),Z=r([{label:"\u81EA\u52A8",description:"\u81EA\u52A8\u8BBE\u7F6E\u5206\u5272\u548C\u9884\u5904\u7406\u89C4\u5219"},{label:"\u81EA\u5B9A\u4E49",description:"\u81EA\u5B9A\u4E49\u8BBE\u7F6E\u6570\u636E\u5904\u7406\u89C4\u5219"}]),f=me({open:!1,title:"",isUploading:!1,updateSupport:0,headers:{Authorization:"Bearer "+ge()},url:"/prod-api/api/infra/base/search/datasetKnowledge/upload"}),ee=r({processingMethod:[{required:!0,message:"\u8BF7\u9009\u62E9\u6570\u636E\u5904\u7406\u65B9\u5F0F",trigger:"change"}],processingParam:[{required:!0,message:"\u8BF7\u9009\u62E9\u5904\u7406\u53C2\u6570",trigger:"change"}],idealChunkLength:[{required:!0,message:"\u8BF7\u8F93\u5165\u7406\u60F3\u5206\u5757\u957F\u5EA6",trigger:"blur"}],customSplitSymbol:[{required:!0,message:"\u8BF7\u8F93\u5165\u81EA\u5B9A\u4E49\u5206\u5272\u7B26\u53F7",trigger:"blur"}]}),le=()=>{R.back()},M=()=>{if(_.value===1&&m.value.length===0){b.$message({message:"\u8BF7\u9009\u62E9\u6587\u4EF6",type:"warning"});return}_.value++},Q=()=>{_.value>1&&_.value--},te=(s,i,P)=>{const w=Math.round(s.loaded*100/s.total),V=m.value.findIndex(N=>N.documentName===i.name);V>-1&&(m.value[V].uploadProgress=w),f.isUploading=!0},ae=(s,i,P)=>{f.open=!1,f.isUploading=!1,b.$refs.uploadRef.handleRemove(i),T()},m=r([]),U=s=>{switch(s){case"pdf":return"fa-solid fa-file-pdf";case"docx":return"fa-solid fa-file-word";case"pptx":return"fa-solid fa-file-powerpoint";case"xlsx":return"fa-solid fa-file-excel";case"csv":return"fa-solid fa-file-csv";case"txt":return"fa-solid fa-file-lines";case"md":return"fa-solid fa-file-code";default:return"fa-solid fa-file"}},B=s=>{xe(s.id).then(i=>{b.$message({message:"\u5220\u9664\u6210\u529F",type:"success"}),T()})},A=s=>{s.fileName.split(".").pop().toLowerCase()==="pdf"&&s.fileUrl?window.open(s.fileUrl,"_blank"):console.log("\u6682\u4E0D\u652F\u6301\u8BE5\u6587\u4EF6\u7C7B\u578B\u7684\u9884\u89C8")},se=()=>{k.value=!0;try{c.value.datasetId=x,ke(c.value).then(s=>{b.$message({message:"\u89E3\u6790\u6210\u529F",type:"success"}),k.value=!1;const i="/base/search/vectorData/parseDataset?datasetId="+x;R.push(i)})}catch(s){console.error("\u63D0\u4EA4\u6570\u636E\u5904\u7406\u65B9\u5F0F\u65F6\u51FA\u9519",s),b.$message.error("\u63D0\u4EA4\u6570\u636E\u5904\u7406\u65B9\u5F0F\u5931\u8D25")}},oe=()=>{q.value.validate(s=>{s?M():console.log("\u8868\u5355\u6821\u9A8C\u4E0D\u901A\u8FC7")})},T=()=>{we(x).then(s=>{console.log("response.data ="+JSON.stringify(s.data)),m.value=s.data})};return he(()=>{console.log("handleQueryTmpFileByDatasetId ="+x),T()}),(s,i)=>{const P=o("el-page-header"),w=o("el-step"),V=o("el-steps"),N=o("upload-filled"),K=o("el-icon"),ne=o("el-upload"),p=o("el-table-column"),L=o("el-progress"),u=o("el-button"),$=o("el-table"),ie=o("QuestionFilled"),O=o("el-radio"),j=o("el-radio-group"),I=o("el-form-item"),de=o("el-input-number"),re=o("el-input"),ce=o("el-form"),E=o("el-col"),pe=o("el-row");return d(),g("div",Ce,[e(P,{onBack:le},{content:t(()=>[Se]),_:1}),a("div",ze,[e(V,{active:_.value,simple:"","finish-status":"success",class:"step-container-panel"},{default:t(()=>[e(w,{title:"\u9009\u62E9\u6587\u4EF6"}),e(w,{title:"\u6570\u636E\u5904\u7406"}),e(w,{title:"\u786E\u8BA4\u4E0A\u4F20"})]),_:1},8,["active"])]),_.value===1?(d(),g("div",Ve,[e(ne,{ref_key:"uploadRef",ref:W,multiple:"",limit:10,accept:".xlsx,.xls,.ppt,.docx,.doc,.pdf,.pptx,.md",headers:C(f).headers,action:C(f).url+"?updateSupport="+C(f).updateSupport+"&datasetId="+C(x),disabled:C(f).isUploading,"on-progress":te,"on-success":ae,"auto-upload":!0,drag:""},{default:t(()=>[e(K,{class:"el-icon--upload"},{default:t(()=>[e(N)]),_:1}),Ie]),_:1},8,["headers","action","disabled"]),a("div",De,[e($,{data:m.value,style:{width:"100%"}},{default:t(()=>[e(p,{label:"\u6587\u4EF6\u540D"},{default:t(({row:l})=>[a("i",{class:S(U(l.fileType)),style:{"margin-right":"5px"}},null,2),n(" "+h(l.documentName),1)]),_:1}),e(p,{prop:"uploadProgress",width:"300px",align:"center",label:"\u6587\u4EF6\u4E0A\u4F20\u8FDB\u5EA6"},{default:t(l=>[l.row.hasUploaded==="uploaded"?(d(),y(L,{key:0,status:"success",percentage:100,"stroke-width":20,striped:"","text-inside":!0,"striped-flow":""})):(d(),y(L,{key:1,percentage:l.row.uploadProgress,striped:"","striped-flow":"","stroke-width":10,status:"primary",duration:10},null,8,["percentage"]))]),_:1}),e(p,{prop:"fileSize",label:"\u6587\u4EF6\u5927\u5C0F",align:"center",width:"280"}),e(p,{label:"\u64CD\u4F5C",align:"center",width:"200"},{default:t(({row:l})=>[e(u,{size:"mini",onClick:v=>A(l),icon:"View"},{default:t(()=>[n("\u9884\u89C8")]),_:2},1032,["onClick"]),e(u,{size:"mini",onClick:v=>B(l),icon:"DeleteFilled"},{default:t(()=>[n("\u5220\u9664")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),e(u,{onClick:M,type:"primary",size:"large",icon:"Right",class:"next-button"},{default:t(()=>[n("\u4E0B\u4E00\u6B65")]),_:1})])):D("",!0),_.value===2?(d(),g("div",Fe,[e(pe,null,{default:t(()=>[e(E,{span:10},{default:t(()=>[Ue,e(ce,{model:c.value,ref_key:"formRef",ref:q,"label-width":"150","label-position":H.value,rules:ee.value},{default:t(()=>[e(I,{prop:"processingMethod",label:"\u6570\u636E\u5904\u7406\u65B9\u5F0F"},{default:t(()=>[e(j,{modelValue:c.value.processingMethod,"onUpdate:modelValue":i[0]||(i[0]=l=>c.value.processingMethod=l)},{default:t(()=>[(d(!0),g(G,null,J(Y.value,(l,v)=>(d(),y(O,{label:l.code,value:l.code,size:"large",key:v,border:""},{default:t(()=>[a("div",null,[a("div",Be,[a("i",{class:S(l.icon)},null,2),n(h(l.name)+" ",1),e(K,null,{default:t(()=>[e(ie)]),_:1})])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(I,{prop:"processingParam",label:"\u5904\u7406\u53C2\u6570"},{default:t(()=>[e(j,{modelValue:c.value.processingParam,"onUpdate:modelValue":i[1]||(i[1]=l=>c.value.processingParam=l)},{default:t(()=>[(d(!0),g(G,null,J(Z.value,l=>(d(),y(O,{size:"large",key:l.label,label:l.label,border:""},{default:t(()=>[a("div",Te,[a("div",null,[a("i",{class:S(l.icon)},null,2),n(h(l.label),1)])])]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(I,{prop:"idealChunkLength",label:"\u7406\u60F3\u5206\u5757\u957F\u5EA6"},{default:t(()=>[e(de,{modelValue:c.value.idealChunkLength,"onUpdate:modelValue":i[2]||(i[2]=l=>c.value.idealChunkLength=l),size:"large",min:1,step:1,max:5e3,"controls-position":"right",placeholder:"\u7406\u60F3\u5206\u5757\u957F\u5EA6",style:{width:"30%"}},null,8,["modelValue"])]),_:1}),e(I,{prop:"customSplitSymbol",label:"\u81EA\u5B9A\u4E49\u5206\u5272\u7B26\u53F7"},{default:t(()=>[e(re,{modelValue:c.value.customSplitSymbol,"onUpdate:modelValue":i[3]||(i[3]=l=>c.value.customSplitSymbol=l),size:"large",placeholder:"\u81EA\u5B9A\u4E49\u5206\u5272\u7B26\u53F7",style:{width:"70%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","label-position","rules"])]),_:1}),e(E,{span:14},{default:t(()=>[Pe,a("div",Ne,[e($,{data:m.value,style:{width:"100%"}},{default:t(()=>[e(p,{label:"\u6587\u4EF6\u540D"},{default:t(({row:l})=>[a("i",{class:S(U(l.fileType)),style:{"margin-right":"5px"}},null,2),n(" "+h(l.documentName),1)]),_:1}),e(p,{prop:"fileSize",label:"\u6587\u4EF6\u5927\u5C0F",align:"center",width:"280"}),e(p,{label:"\u64CD\u4F5C",align:"center",width:"200"},{default:t(({row:l})=>[e(u,{size:"mini",onClick:v=>A(l),icon:"View"},{default:t(()=>[n("\u9884\u89C8")]),_:2},1032,["onClick"]),e(u,{size:"mini",onClick:v=>B(l),icon:"DeleteFilled"},{default:t(()=>[n("\u5220\u9664")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1})]),_:1}),e(u,{onClick:Q,type:"danger",size:"large",icon:"Back",class:"prev-button"},{default:t(()=>[n("\u4E0A\u4E00\u6B65")]),_:1}),e(u,{onClick:oe,type:"primary",size:"large",icon:"Right",class:"next-button"},{default:t(()=>[n("\u4E0B\u4E00\u6B65")]),_:1})])):D("",!0),_.value===3?(d(),g("div",Le,[a("div",$e,[e($,{data:m.value,style:{width:"100%"}},{default:t(()=>[e(p,{label:"\u6587\u4EF6\u540D"},{default:t(({row:l})=>[a("i",{class:S(U(l.fileType)),style:{"margin-right":"5px"}},null,2),n(" "+h(l.documentName),1)]),_:1}),e(p,{prop:"status",align:"center",label:"\u72B6\u6001"},{default:t(l=>[l.row.status==="\u672A\u89E3\u6790"?(d(),y(u,{key:0,text:"",bg:"",loading:"",type:"primary"},{default:t(()=>[n("\u89E3\u6790\u4E2D")]),_:1})):(d(),g("span",Re,h(l.row.status),1))]),_:1}),e(p,{prop:"fileSize",label:"\u6587\u4EF6\u5927\u5C0F",align:"center",width:"280"}),e(p,{label:"\u64CD\u4F5C",align:"center",width:"200"},{default:t(({row:l})=>[e(u,{size:"mini",onClick:v=>B(l),icon:"DeleteFilled"},{default:t(()=>[n("\u5220\u9664")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),k.value?(d(),y(L,{key:0,percentage:X.value,class:"progress-bar"},null,8,["percentage"])):D("",!0),a("div",null,[e(u,{onClick:Q,type:"danger",size:"large",icon:"Back",class:"prev-button"},{default:t(()=>[n("\u4E0A\u4E00\u6B65")]),_:1}),e(u,{onClick:se,loading:k.value,icon:"Upload",type:"primary",size:"large",class:"upload-button"},{default:t(()=>[n(h(k.value?"\u4E0A\u4F20\u4E2D...":"\u4E0A\u4F20"),1)]),_:1},8,["loading"])])])):D("",!0)])}}},Ae=ue(qe,[["__scopeId","data-v-43f04da6"]]);export{Ae as default};
