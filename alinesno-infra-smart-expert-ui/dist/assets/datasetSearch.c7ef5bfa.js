import{_ as ae,c5 as oe,r as u,Q as se,R as ne,a as i,H as re,o as m,l as D,d as l,w as a,I as S,f as n,h as ie,j as d,U as L,c as h,e as r,x as v,i as N,F as ue,C as de,D as U,z as ce,A as pe,n as fe}from"./index.2b31a27b.js";import{b as me,c as _e}from"./vectorDataset.02b10d35.js";const b=g=>(ce("data-v-e20994c3"),g=g(),pe(),g),ve={class:"result-item"},ge={class:"role-icon"},he=b(()=>r("i",{class:"fa-solid fa-file-pdf"},null,-1)),be={class:"result-content"},ye={class:"role-icon"},xe=b(()=>r("i",{class:"fa-solid fa-file-pdf"},null,-1)),Re={class:"config-container"},qe=b(()=>r("div",{class:"config-title"},"\u67E5\u8BE2\u914D\u7F6E",-1)),Se={style:{display:"flex","flex-direction":"row","contain-intrinsic-block-size":"auto 100px","line-height":"20px","align-items":"center",gap:"10px"}},we={style:{display:"flex","flex-direction":"column"}},ke={style:{color:"#333"}},Ve={style:{color:"#667085","font-size":"13px"}},Te={style:{"margin-top":"10px","text-align":"right"}},Ie=b(()=>r("i",{class:"fa-solid fa-file-pdf"},null,-1)),Ce={__name:"datasetSearch",setup(g,{expose:K}){const w=oe(),{proxy:c}=fe(),k=u([]),_=u(!1),P=u(!0),B=u([]),F=u(!0),Q=u(!0),y=u(0),V=u([]),$=u([{key:0,label:"\u56FE\u6807",visible:!0},{key:1,label:"\u6570\u636E\u96C6\u540D\u79F0",visible:!0},{key:2,label:"\u6240\u6709\u8005",visible:!0},{key:3,label:"\u63CF\u8FF0\u4FE1\u606F",visible:!0},{key:4,label:"\u72B6\u6001",visible:!0},{key:5,label:"\u8BBF\u95EE\u6743\u9650",visible:!0},{key:6,label:"\u6570\u636E\u603B\u91CF",visible:!0},{key:7,label:"\u521B\u5EFA\u65F6\u95F4",visible:!0},{key:8,label:"\u7F16\u8F91",visible:!0}]),E=se({form:{},queryParams:{pageNum:1,pageSize:10,DatasetName:void 0,searchText:void 0,topK:10,status:void 0,deptId:void 0,searchType:"vector",quoteLimit:1e3,reorderResults:!1,minRelevance:.5},rules:{applicationId:[{required:!0,message:"\u5E94\u7528\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],name:[{required:!0,message:"\u5E94\u7528\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{min:2,max:20,message:"\u5E94\u7528\u540D\u79F0\u957F\u5EA6\u5FC5\u987B\u4ECB\u4E8E 2 \u548C 20 \u4E4B\u95F4",trigger:"blur"}],searchText:[{required:!0,message:"\u663E\u793A\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],description:[{required:!0,message:"\u63CF\u8FF0\u4FE1\u606F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],datasetStatus:[{required:!0,message:"\u57DF\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],accessPermission:[{required:!0,message:"\u5B89\u5168\u5B58\u50A8\u8DEF\u5F84\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],datasetSize:[{required:!0,message:"\u5E94\u7528\u76EE\u6807\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}}),{queryParams:e,form:ze,rules:j}=ne(E),A=u([{code:"vector",label:"\u5411\u91CF\u68C0\u7D22",desc:"\u4F7F\u7528\u5411\u91CF\u8FDB\u884C\u6587\u672C\u76F8\u5173\u6027\u67E5\u8BE2",enable:!0,icon:"fa-solid fa-magnifying-glass-chart"},{code:"fulltext",label:"\u5168\u6587\u68C0\u7D22",desc:"\u4F7F\u7528\u4F20\u7EDF\u7684\u5168\u6587\u68C0\u7D22\uFF0C\u57FA\u4E8EPostgreSql\u7684\u5168\u6587\u68C0\u7D22",enable:!1,icon:"fa-solid fa-file-pdf"},{code:"hybrid",label:"\u6DF7\u5408\u68C0\u7D22",desc:"\u4F7F\u7528\u5411\u91CF\u68C0\u7D22\u4E0E\u5168\u6587\u68C0\u7D22\u7684\u7EFC\u5408\u7ED3\u679C\u8FD4\u56DE\u3002",enable:!1,icon:"fa-solid fa-code-branch"}]),H=s=>{s&&(console.log("props.dataset = "+JSON.stringify(s)),e.value.searchType=s.searchType,e.value.quoteLimit=s.quoteLimit,e.value.reorderResults=s.reorderResults,e.value.minRelevance=s.minRelevance)};function T(){_.value=!0;let s=w.query.datasetId;e.value.datasetId=s,me(c.addDateRange(e.value,V.value)).then(o=>{_.value=!1,k.value=o.data,y.value=o.total}).catch(()=>{_.value=!1})}function x(){c.$refs.queryRef.validate(s=>{s&&T()})}function J(){V.value=[],c.resetForm("queryRef"),c.resetForm("configRef"),_.value=!1,e.value.DatasetName=void 0,e.value.searchText=void 0,e.value.topK=10,e.value.status=void 0,e.value.deptId=void 0,e.value.searchType="vector",e.value.quoteLimit=1e3,e.value.reorderResults=!1,e.value.minRelevance=.5,x()}function O(s){B.value=s.map(o=>o.id),F.value=s.length!=1,Q.value=!s.length}function G(){e.value.datasetId=w.query.datasetId,console.log("\u4FDD\u5B58\u7684\u914D\u7F6E:",e.value),_e(e.value).then(s=>{c.$modal.msgSuccess("\u4FEE\u6539\u6210\u529F")}).catch(()=>{c.$modal.msgError("\u4FEE\u6539\u5931\u8D25")})}function M(s,o){return s.length>o?s.slice(0,o)+"...":s}return K({setDataset:H}),(s,o)=>{const R=i("el-input"),p=i("el-form-item"),q=i("el-button"),I=i("el-form"),C=i("el-table-column"),W=i("el-table"),X=i("pagination"),Y=i("el-scrollbar"),f=i("el-col"),Z=i("el-radio"),ee=i("el-radio-group"),le=i("el-switch"),z=i("el-row"),te=re("loading");return m(),D("div",null,[l(z,{gutter:20},{default:a(()=>[l(f,{span:17},{default:a(()=>[S(l(I,{model:n(e),ref:"queryRef",rules:n(j),inline:!0,"label-width":"100px"},{default:a(()=>[l(p,{label:"\u641C\u7D22\u6761\u4EF6",prop:"searchText"},{default:a(()=>[l(R,{modelValue:n(e).searchText,"onUpdate:modelValue":o[0]||(o[0]=t=>n(e).searchText=t),placeholder:"\u8BF7\u8F93\u5165\u641C\u7D22\u6761\u4EF6",clearable:"",style:{width:"540px"},onKeyup:ie(x,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),l(p,null,{default:a(()=>[l(q,{type:"primary",icon:"Search",onClick:x},{default:a(()=>[d("\u641C\u7D22")]),_:1}),l(q,{icon:"Refresh",onClick:J},{default:a(()=>[d("\u91CD\u7F6E")]),_:1})]),_:1})]),_:1},8,["model","rules"]),[[L,P.value]]),l(Y,{class:"result-scrollbar"},{default:a(()=>[S((m(),h(W,{data:k.value,onSelectionChange:O},{default:a(()=>[l(C,{type:"index",width:"50",label:"\u5E8F\u53F7",align:"center"}),$.value[1].visible?(m(),h(C,{label:"\u67E5\u8BE2\u7ED3\u679C",align:"left",key:"name",prop:"name"},{default:a(t=>[r("div",ve,[r("div",ge,[d(" \u8BC4\u5206:"),he,d(" "+v(t.row.score),1)]),r("div",be,v(M(t.row.document_content,300)),1),r("div",ye,[d(" \u5F15\u7528: "),xe,d(" "+v(t.row.document_title),1)])])]),_:1})):N("",!0)]),_:1},8,["data"])),[[te,_.value]]),S(l(X,{total:y.value,page:n(e).pageNum,"onUpdate:page":o[1]||(o[1]=t=>n(e).pageNum=t),limit:n(e).pageSize,"onUpdate:limit":o[2]||(o[2]=t=>n(e).pageSize=t),onPagination:T},null,8,["total","page","limit"]),[[L,y.value>0]])]),_:1})]),_:1}),l(f,{span:7},{default:a(()=>[r("div",Re,[qe,l(I,{model:n(e),"label-position":"top",ref:"configRef",inline:!0,style:{width:"100%"},"label-width":"120px"},{default:a(()=>[l(z,null,{default:a(()=>[l(f,{span:24},{default:a(()=>[l(p,{label:"\u68C0\u7D22\u7C7B\u578B"},{default:a(()=>[l(ee,{modelValue:n(e).searchType,"onUpdate:modelValue":o[3]||(o[3]=t=>n(e).searchType=t)},{default:a(()=>[(m(!0),D(ue,null,de(A.value,t=>(m(),h(Z,{key:t.code,label:t.code,style:{height:"60px"},size:"large",class:U(["search-type-radio",t.code===n(e).searchType?"search-type-radio-active":"search-type-radio-normal"])},{default:a(()=>[r("div",Se,[r("span",null,[r("i",{class:U(t.icon)},null,2)]),r("div",we,[r("span",ke,v(t.label),1),r("span",Ve,v(t.desc),1)])])]),_:2},1032,["label","class"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(f,{span:24},{default:a(()=>[l(p,{label:"\u5F15\u7528\u4E0A\u9650",prop:"quoteLimit"},{default:a(()=>[l(R,{modelValue:n(e).quoteLimit,"onUpdate:modelValue":o[4]||(o[4]=t=>n(e).quoteLimit=t),placeholder:"\u8BF7\u8F93\u5165\u4E0A\u9650\u5B57\u7B26\u6570"},null,8,["modelValue"])]),_:1})]),_:1}),l(f,{span:24},{default:a(()=>[l(p,{label:"\u662F\u5426\u7ED3\u679C\u91CD\u6392",prop:"reorderResults"},{default:a(()=>[l(le,{modelValue:n(e).reorderResults,"onUpdate:modelValue":o[5]||(o[5]=t=>n(e).reorderResults=t),"active-value":1,"inactive-value":0,"active-text":"\u662F","inactive-text":"\u5426"},null,8,["modelValue"])]),_:1})]),_:1}),l(f,{span:24},{default:a(()=>[n(e).searchType==="vector"?(m(),h(p,{key:0,label:"\u6700\u4F4E\u76F8\u5173\u5EA6",prop:"minRelevance"},{default:a(()=>[l(R,{modelValue:n(e).minRelevance,"onUpdate:modelValue":o[6]||(o[6]=t=>n(e).minRelevance=t),placeholder:"\u8BF7\u8F93\u5165\u6700\u4F4E\u76F8\u5173\u5EA6"},null,8,["modelValue"])]),_:1})):N("",!0)]),_:1})]),_:1}),r("div",Te,[l(q,{type:"primary",bg:"",text:"",size:"large",onClick:G},{default:a(()=>[Ie,d(" \xA0 \u4FDD\u5B58\u914D\u7F6E ")]),_:1})])]),_:1},8,["model"])])]),_:1})]),_:1})])}}},Ne=ae(Ce,[["__scopeId","data-v-e20994c3"]]);export{Ne as default};
