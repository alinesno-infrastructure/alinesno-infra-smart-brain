import{E as k,K as j,B as re,m as se,r,Q as ie,R as de,a as s,H as D,o as u,l as E,d as l,w as t,I as H,c as m,f as a,e as _,i as f,x as C,U as ue,j as P,F as pe,C as ce,J as me,n as fe}from"./index.2b31a27b.js";var i="/api/infra/smart/brain/generateTaskHistory/",w={datatables:i+"datatables",createUrl:i+"add",saveUrl:i+"save",updateUrl:i+"modify",statusUrl:i+"changeStatus",cleanUrl:i+"clean",detailUrl:i+"detail",removeUrl:i+"delete",exportUrl:i+"exportExcel",changeField:i+"changeField",downloadFile:i+"downloadFile",resetRetry:i+"resetRetry",getTaskHistory:i+"getTaskHistory"};function _e(p){return k({url:w.datatables,method:"post",params:p})}function ge(p){return k({url:w.detailUrl+"/"+j(p),method:"get"})}function ve(p){return k({url:w.saveUrl,method:"post",data:p})}function be(p){return k({url:w.updateUrl,method:"put",data:p})}function ye(p){return k({url:w.removeUrl+"/"+j(p),method:"delete"})}const he={class:"role-icon"},ke=["src"],we={style:{"font-size":"15px","font-weight":"500",color:"#3b5998"}},xe={style:{"font-size":"13px",color:"#a5a5a5"}},Te=_("div",{style:{"font-size":"13px",color:"#a5a5a5"}}," \u4F1A\u8BDD\u6B21\u6570: 12734 \u6709\u6548\u6C9F\u901A:198312 ",-1),Ue={class:"dialog-footer"},He=re({name:"TaskHistory"}),Ve=Object.assign(He,{props:{currentBusinessId:{type:String,require:!0}},setup(p){se();const{proxy:g}=fe();r([]);const F=r([]),v=r(!1),V=r(!0);r(!0);const S=r([]),L=r(!0),J=r(!0),I=r(0),N=r(""),K=r([]);r([]),r([]);const b=r([{key:0,label:"\u7C7B\u578B\u540D\u79F0",visible:!0},{key:1,label:"\u7C7B\u578B\u63CF\u8FF0",visible:!0},{key:2,label:"\u8868\u6570\u636E\u91CF",visible:!0},{key:3,label:"\u7C7B\u578B",visible:!0},{key:4,label:"\u7C7B\u578B\u5730\u5740",visible:!0},{key:5,label:"\u72B6\u6001",visible:!0},{key:6,label:"\u66F4\u65B0\u65F6\u95F4",visible:!0}]),O=ie({form:{},queryParams:{pageNum:1,pageSize:10,name:void 0,description:void 0},rules:{name:[{required:!0,message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],description:[{required:!0,message:"\u8FDE\u63A5\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],promptCount:[{required:!0,message:"\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],parentId:[{required:!0,message:"\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}}),{queryParams:y,form:d,rules:Q}=de(O);function h(){V.value=!0,_e(g.addDateRange(y.value,K.value)).then(o=>{V.value=!1,F.value=o.rows,I.value=o.total})}function A(o){const n=o.id||S.value;g.$modal.confirm('\u662F\u5426\u786E\u8BA4\u5220\u9664\u7C7B\u578B\u7F16\u53F7\u4E3A"'+n+'"\u7684\u6570\u636E\u9879\uFF1F').then(function(){return ye(n)}).then(()=>{h(),g.$modal.msgSuccess("\u5220\u9664\u6210\u529F")}).catch(()=>{})}function G(o){S.value=o.map(n=>n.id),L.value=o.length!=1,J.value=!o.length}function $(){d.value={id:void 0,deptId:void 0,TaskHistoryName:void 0,promptCount:void 0,password:void 0,phonenumber:void 0,status:"0",remark:void 0},g.resetForm("databaseRef")}function M(){v.value=!1,$()}function W(o){$();const n=o.id||S.value;ge(n).then(c=>{d.value=c.data,v.value=!0,N.value="\u4FEE\u6539\u7C7B\u578B"})}function X(){g.$refs.databaseRef.validate(o=>{o&&(d.value.TaskHistoryId!=null?be(d.value).then(n=>{g.$modal.msgSuccess("\u4FEE\u6539\u6210\u529F"),v.value=!1,h()}):ve(d.value).then(n=>{g.$modal.msgSuccess("\u65B0\u589E\u6210\u529F"),v.value=!1,h()}))})}return h(),(o,n)=>{const c=s("el-table-column"),x=s("el-button"),q=s("el-tooltip"),Y=s("el-table"),Z=s("pagination"),T=s("el-col"),U=s("el-row"),ee=s("el-option"),te=s("el-select"),R=s("el-form-item"),z=s("el-input"),le=s("el-form"),ae=s("el-dialog"),B=D("hasPermi"),ne=D("loading");return u(),E("div",null,[l(U,{gutter:20},{default:t(()=>[l(T,{span:24,xs:24},{default:t(()=>[H((u(),m(Y,{data:a(F),onSelectionChange:G},{default:t(()=>[l(c,{type:"selection",width:"50",align:"center"}),a(b)[0].visible?(u(),m(c,{key:0,label:"\u56FE\u6807",align:"center",width:"80px",prop:"icon"},{default:t(e=>[_("div",he,[_("img",{src:"http://data.linesno.com/icons/dataset/dataset_"+(e.$index+8)+".png",style:{width:"45px",height:"45px","border-radius":"50%"}},null,8,ke)])]),_:1})):f("",!0),a(b)[0].visible?(u(),m(c,{label:"\u7C7B\u578B\u540D\u79F0",align:"left",width:"200",key:"name",prop:"name"},{default:t(e=>[_("div",we,C(e.row.name),1),_("div",xe,C(e.row.name),1)]),_:1})):f("",!0),a(b)[1].visible?(u(),m(c,{label:"\u7C7B\u578B\u63CF\u8FF0",align:"left",key:"description",prop:"description","show-overflow-tooltip":!0},{default:t(e=>[_("div",null,C(e.row.description),1),Te]),_:1})):f("",!0),a(b)[2].visible?(u(),m(c,{label:"\u751F\u6210\u5F0F\u6570\u91CF",align:"center",width:"150",key:"promptCount",prop:"promptCount","show-overflow-tooltip":!0})):f("",!0),a(b)[5].visible?(u(),m(c,{label:"\u72B6\u6001",align:"center",width:"100",key:"hasStatus"})):f("",!0),a(b)[6].visible?(u(),m(c,{key:5,label:"\u6DFB\u52A0\u65F6\u95F4",align:"center",prop:"addTime",width:"160"},{default:t(e=>[_("span",null,C(o.parseTime(e.row.addTime)),1)]),_:1})):f("",!0),l(c,{label:"\u64CD\u4F5C",align:"center",width:"150","class-name":"small-padding fixed-width"},{default:t(e=>[e.row.TaskHistoryId!==1?(u(),m(q,{key:0,content:"\u4FEE\u6539",placement:"top"},{default:t(()=>[H(l(x,{link:"",type:"primary",icon:"Edit",onClick:oe=>W(e.row)},null,8,["onClick"]),[[B,["system:TaskHistory:edit"]]])]),_:2},1024)):f("",!0),e.row.TaskHistoryId!==1?(u(),m(q,{key:1,content:"\u5220\u9664",placement:"top"},{default:t(()=>[H(l(x,{link:"",type:"primary",icon:"Delete",onClick:oe=>A(e.row)},null,8,["onClick"]),[[B,["system:TaskHistory:remove"]]])]),_:2},1024)):f("",!0)]),_:1})]),_:1},8,["data"])),[[ne,a(V)]]),H(l(Z,{total:a(I),page:a(y).pageNum,"onUpdate:page":n[0]||(n[0]=e=>a(y).pageNum=e),limit:a(y).pageSize,"onUpdate:limit":n[1]||(n[1]=e=>a(y).pageSize=e),onPagination:h},null,8,["total","page","limit"]),[[ue,a(I)>0]])]),_:1})]),_:1}),l(ae,{title:a(N),modelValue:a(v),"onUpdate:modelValue":n[5]||(n[5]=e=>me(v)?v.value=e:null),width:"700px","append-to-body":""},{footer:t(()=>[_("div",Ue,[l(x,{type:"primary",onClick:X},{default:t(()=>[P("\u786E \u5B9A")]),_:1}),l(x,{onClick:M},{default:t(()=>[P("\u53D6 \u6D88")]),_:1})])]),default:t(()=>[l(le,{model:a(d),rules:a(Q),ref:"databaseRef","label-width":"100px"},{default:t(()=>[l(U,null,{default:t(()=>[l(T,{span:24},{default:t(()=>[l(R,{label:"\u7236\u7C7B",prop:"name"},{default:t(()=>[l(te,{clearable:"",modelValue:a(d).parentId,"onUpdate:modelValue":n[2]||(n[2]=e=>a(d).parentId=e),style:{width:"100%"},placeholder:"\u53EF\u591A\u9009","multiple-limit":10},{default:t(()=>[(u(),E(pe,null,ce(10,e=>l(ee,{key:e,label:e,value:e},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(U,null,{default:t(()=>[l(T,{span:24},{default:t(()=>[l(R,{label:"\u540D\u79F0",prop:"name"},{default:t(()=>[l(z,{modelValue:a(d).name,"onUpdate:modelValue":n[3]||(n[3]=e=>a(d).name=e),placeholder:"\u8BF7\u8F93\u5165\u7C7B\u578B\u540D\u79F0",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(U,null,{default:t(()=>[l(T,{span:24},{default:t(()=>[l(R,{label:"\u63CF\u8FF0",prop:"description"},{default:t(()=>[l(z,{modelValue:a(d).description,"onUpdate:modelValue":n[4]||(n[4]=e=>a(d).description=e),placeholder:"\u8BF7\u8F93\u5165jdbcUrl\u8FDE\u63A5\u5730\u5740",maxlength:"128"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}});export{Ve as default};
