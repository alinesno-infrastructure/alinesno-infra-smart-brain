import{E as R,K as ue,_ as ze,B as Le,m as Ee,r as c,Q as oe,T as Ke,R as je,a as i,H as ie,o as r,l as se,d as t,w as e,I as V,f as n,h as de,j as s,U as re,c as f,J as E,e as d,i as v,x as N,F as Be,C as Me,z as Qe,A as Oe,n as He}from"./index.2b31a27b.js";import{l as Je}from"./role.f35abc69.js";var p="/api/infra/base/im/channel/",F={datatables:p+"datatables",createUrl:p+"add",saveUrl:p+"createChannel",updateUrl:p+"modify",statusUrl:p+"changeStatus",cleanUrl:p+"clean",detailUrl:p+"detail",removeUrl:p+"delete",removeChannel:p+"removeChannel",exportUrl:p+"exportExcel",changeField:p+"changeField",downloadFile:p+"downloadFile",createChannel:p+"createChannel",allMyChannel:p+"allMyChannel",allPublicChannel:p+"allPublicChannel",joinChannel:p+"joinChannel",getDefaultChannelId:p+"getDefaultChannelId",updateChannelAgent:p+"updateChannelAgent",closeChannelSSE:"/v1/api/infra/base/im/sseChannelTask/closeSseConnect",getFlowTaskNotice:"/v1/api/infra/base/im/chat/getFlowTaskNotice"};function Ge(m,y){const P={channelId:m,rolesId:y};return R({url:F.updateChannelAgent,method:"post",data:P})}function We(m){return R({url:F.datatables,method:"post",params:m})}function Xe(m){return R({url:F.detailUrl+"/"+ue(m),method:"get"})}function Ye(m){return R({url:F.saveUrl,method:"post",data:m})}function Ze(m){return R({url:F.updateUrl,method:"put",data:m})}function el(m){return R({url:F.removeUrl+"/"+ue(m),method:"delete"})}const T=m=>(Qe("data-v-991e0f26"),m=m(),Oe(),m),ll={class:"app-container"},tl={class:"role-icon"},al=["src"],nl={style:{"font-size":"15px","font-weight":"500",color:"#3b5998"}},ol={style:{"font-size":"13px",color:"#a5a5a5"}},il=T(()=>d("i",{class:"fa-solid fa-user-shield"},null,-1)),sl=T(()=>d("i",{class:"fa-solid fa-user-ninja"},null,-1)),dl=T(()=>d("i",{class:"fa-solid fa-user-ninja"},null,-1)),rl=T(()=>d("i",{class:"fa-solid fa-users-gear"},null,-1)),ul=T(()=>d("i",{class:"fa-solid fa-user-shield"},null,-1)),pl={class:"dialog-footer"},cl=T(()=>d("div",{class:"el-upload__text"},[s("\u5C06\u6587\u4EF6\u62D6\u5230\u6B64\u5904\uFF0C\u6216"),d("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1)),fl={class:"el-upload__tip text-center"},ml={class:"el-upload__tip"},hl=T(()=>d("span",null,"\u4EC5\u5141\u8BB8\u5BFC\u5165xls\u3001xlsx\u683C\u5F0F\u6587\u4EF6\u3002",-1)),_l={class:"dialog-footer"},gl={style:{"text-align":"center"}},vl={class:"dialog-footer"},yl=Le({name:"Channel"}),bl=Object.assign(yl,{setup(m){Ee();const{proxy:y}=He(),P=c([]),w=c(!1),K=c(!0),q=c(!0),j=c([]),H=c(!0),J=c(!0),B=c(0),M=c(""),G=c([]),pe=c(""),ce=[{id:"9",name:"\u516C\u5F00\u9891\u9053"},{id:"1",name:"\u4E2A\u4EBA\u516C\u5171\u9891\u9053"},{id:"3",name:"\u63A8\u8350\u9891\u9053"},{id:"2",name:"\u79C1\u6709\u9891\u9053"}],W=c([]),I=c(!1),X=c(""),D=c([]),Y=c(0),h=oe({open:!1,title:"",isUploading:!1,updateSupport:0,headers:{Authorization:"Bearer "+Ke()},url:"/prod-api/v1/api/infra/base/im/chat/importData"}),b=c([{key:0,label:"\u56FE\u6807",visible:!0},{key:1,label:"\u9891\u9053\u540D\u79F0",visible:!0},{key:2,label:"\u9891\u9053\u7C7B\u578B",visible:!0},{key:3,label:"\u4F7F\u7528\u573A\u666F",visible:!0},{key:4,label:"\u72B6\u6001",visible:!0},{key:5,label:"\u9891\u9053\u63CF\u8FF0",visible:!0},{key:6,label:"\u5E94\u7528\u76EE\u6807",visible:!0},{key:7,label:"\u521B\u5EFA\u65F6\u95F4",visible:!0},{key:8,label:"\u7F16\u8F91",visible:!0}]),fe=oe({form:{},queryParams:{pageNum:1,pageSize:10,ChannelName:void 0,name:void 0,toolType:void 0,status:void 0,deptId:void 0},rules:{channelName:[{required:!0,message:"\u9891\u9053\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{min:2,max:20,message:"\u9891\u9053\u540D\u79F0\u957F\u5EA6\u5FC5\u987B\u4ECB\u4E8E 2 \u548C 20 \u4E4B\u95F4",trigger:"blur"}],channelDesc:[{required:!0,message:"\u9891\u9053\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],screen:[{required:!0,message:"\u4F7F\u7528\u573A\u666F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],hasStatus:[{required:!0,message:"\u72B6\u6001\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],description:[{required:!0,message:"\u9891\u9053\u63CF\u8FF0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],target:[{required:!0,message:"\u5E94\u7528\u76EE\u6807\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}}),{queryParams:_,form:g,rules:me}=je(fe);function S(){K.value=!0,We(y.addDateRange(_.value,G.value)).then(o=>{K.value=!1,P.value=o.rows,B.value=o.total})}function z(){console.log(_),_.value.pageNum=1,S()}const he=(o,a)=>{pe.value=URL.createObjectURL(a.raw),g.value.icon=o.data},_e=o=>o.size/1024/1024>2?(ElMessage.error("Avatar picture size can not exceed 2MB!"),!1):!0;function ge(){G.value=[],y.resetForm("queryRef"),_.value.name=void 0,_.value.toolType=void 0,y.$refs.deptTreeRef.setCurrentKey(null),z()}function Z(o){const a=o.id||j.value;y.$modal.confirm('\u662F\u5426\u786E\u8BA4\u5220\u9664\u5E94\u7528\u7F16\u53F7\u4E3A"'+a+'"\u7684\u6570\u636E\u9879\uFF1F').then(function(){return el(a)}).then(()=>{S(),y.$modal.msgSuccess("\u5220\u9664\u6210\u529F")}).catch(()=>{})}function ve(o){j.value=o.map(a=>a.id),H.value=o.length!=1,J.value=!o.length}function Q(){g.value={applicationId:void 0,name:void 0,toolType:void 0,screen:void 0,hasStatus:void 0,description:void 0,target:void 0},y.resetForm("ChannelRef")}function ye(){w.value=!1,Q()}function be(){Q(),w.value=!0,M.value="\u6DFB\u52A0\u5E94\u7528"}function ee(o){Q();const a=o.id||j.value;Xe(a).then(C=>{g.value=C.data,g.value.applicationId=a,w.value=!0,M.value="\u4FEE\u6539\u5E94\u7528"})}function Ce(){y.$refs.ChannelRef.validate(o=>{o&&(g.value.applicationId!=null?Ze(g.value).then(a=>{y.$modal.msgSuccess("\u4FEE\u6539\u6210\u529F"),w.value=!1,S()}):Ye(g.value).then(a=>{y.$modal.msgSuccess("\u65B0\u589E\u6210\u529F"),w.value=!1,S()}))})}function ke(o){I.value=!0,X.value=o.channelName+"\u6210\u5458",Y.value=o.id,D.value=o.roles}function we(){Je().then(o=>{for(let a=0;a<o.data.length;a++){let C=o.data[a];W.value.push({key:C.id,label:C.roleName,disabled:!1})}})}function Se(){I.value=!1,Ge(Y.value,D.value).then(o=>{y.$modal.msgSuccess("\u66F4\u65B0\u6210\u529F"),S()})}const xe=(o,a)=>a;return S(),we(),(o,a)=>{const C=i("el-input"),U=i("el-form-item"),u=i("el-button"),le=i("el-form"),x=i("el-col"),Ue=i("right-toolbar"),A=i("el-row"),k=i("el-table-column"),Ve=i("el-switch"),te=i("el-tooltip"),Te=i("el-table"),Ie=i("pagination"),Ae=i("Plus"),ae=i("el-icon"),ne=i("el-upload"),Ne=i("el-radio"),Re=i("el-radio-group"),O=i("el-dialog"),Fe=i("upload-filled"),De=i("el-checkbox"),$e=i("el-link"),Pe=i("el-transfer"),L=ie("hasPermi"),qe=ie("loading");return r(),se("div",ll,[t(A,{gutter:20},{default:e(()=>[t(x,{span:24,xs:24},{default:e(()=>[V(t(le,{model:n(_),ref:"queryRef",inline:!0,"label-width":"68px"},{default:e(()=>[t(U,{label:"\u9891\u9053\u540D\u79F0",prop:"name"},{default:e(()=>[t(C,{modelValue:n(_)["condition[name|like]"],"onUpdate:modelValue":a[0]||(a[0]=l=>n(_)["condition[name|like]"]=l),placeholder:"\u8BF7\u8F93\u5165\u9891\u9053\u540D\u79F0",clearable:"",style:{width:"240px"},onKeyup:de(z,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(U,{label:"\u9891\u9053\u7C7B\u578B",prop:"toolType","label-width":"100px"},{default:e(()=>[t(C,{modelValue:n(_)["condition[toolType|like]"],"onUpdate:modelValue":a[1]||(a[1]=l=>n(_)["condition[toolType|like]"]=l),placeholder:"\u8BF7\u8F93\u5165\u9891\u9053\u7C7B\u578B",clearable:"",style:{width:"240px"},onKeyup:de(z,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(U,null,{default:e(()=>[t(u,{type:"primary",icon:"Search",onClick:z},{default:e(()=>[s("\u641C\u7D22")]),_:1}),t(u,{icon:"Refresh",onClick:ge},{default:e(()=>[s("\u91CD\u7F6E")]),_:1})]),_:1})]),_:1},8,["model"]),[[re,n(q)]]),t(A,{gutter:10,class:"mb8"},{default:e(()=>[t(x,{span:1.5},{default:e(()=>[t(u,{type:"primary",plain:"",icon:"Plus",onClick:be},{default:e(()=>[s("\u65B0\u589E ")]),_:1})]),_:1},8,["span"]),t(x,{span:1.5},{default:e(()=>[V((r(),f(u,{type:"success",plain:"",icon:"Edit",disabled:n(H),onClick:ee},{default:e(()=>[s("\u4FEE\u6539 ")]),_:1},8,["disabled"])),[[L,["system:Channel:edit"]]])]),_:1},8,["span"]),t(x,{span:1.5},{default:e(()=>[V((r(),f(u,{type:"danger",plain:"",icon:"Delete",disabled:n(J),onClick:Z},{default:e(()=>[s("\u5220\u9664 ")]),_:1},8,["disabled"])),[[L,["system:Channel:remove"]]])]),_:1},8,["span"]),t(Ue,{showSearch:n(q),"onUpdate:showSearch":a[2]||(a[2]=l=>E(q)?q.value=l:null),onQueryTable:S,columns:n(b)},null,8,["showSearch","columns"])]),_:1}),V((r(),f(Te,{data:n(P),onSelectionChange:ve},{default:e(()=>[t(k,{type:"selection",width:"50",align:"center"}),n(b)[0].visible?(r(),f(k,{key:0,label:"\u56FE\u6807",align:"center",width:"60px",prop:"icon"},{default:e(l=>[d("div",tl,[d("img",{src:o.imagePath(l.row.icon)},null,8,al)])]),_:1})):v("",!0),n(b)[1].visible?(r(),f(k,{label:"\u9891\u9053\u540D\u79F0",align:"left",width:"200",key:"name",prop:"name","show-overflow-tooltip":!0},{default:e(l=>[d("div",nl,N(l.row.channelName),1),d("div",ol," Key: "+N(l.row.channelId),1)]),_:1})):v("",!0),n(b)[5].visible?(r(),f(k,{label:"\u9891\u9053\u63CF\u8FF0",align:"left",key:"description",prop:"description","show-overflow-tooltip":!0},{default:e(l=>[d("div",null,N(l.row.channelDesc),1)]),_:1})):v("",!0),n(b)[2].visible?(r(),f(k,{label:"\u9891\u9053\u7C7B\u578B",align:"center",key:"channelType",width:"180",prop:"channelType","show-overflow-tooltip":!0},{default:e(l=>[l.row.channelType==1?(r(),f(u,{key:0,text:"",bg:"",type:"primary"},{default:e(()=>[il,s("\xA0\u4E2A\u4EBA\u9891\u9053")]),_:1})):v("",!0),l.row.channelType==2?(r(),f(u,{key:1,text:"",bg:"",type:"danger"},{default:e(()=>[sl,s("\xA0\u79C1\u4EBA\u9891\u9053")]),_:1})):v("",!0),l.row.channelType==3?(r(),f(u,{key:2,text:"",bg:"",type:"success"},{default:e(()=>[dl,s("\xA0\u63A8\u8350\u9891\u9053")]),_:1})):v("",!0),l.row.channelType==9?(r(),f(u,{key:3,text:"",bg:"",type:"primary"},{default:e(()=>[rl,s("\xA0\u516C\u5171\u9891\u9053")]),_:1})):v("",!0)]),_:1})):v("",!0),n(b)[2].visible?(r(),f(k,{label:"\u6210\u5458",align:"center",key:"channelType",width:"180",prop:"channelType","show-overflow-tooltip":!0},{default:e(l=>[t(u,{text:"",bg:"",type:"primary",onClick:$=>ke(l.row)},{default:e(()=>[ul,s("\xA0\u6210\u5458\u7BA1\u7406("+N(l.row.roles.length)+") ",1)]),_:2},1032,["onClick"])]),_:1})):v("",!0),n(b)[1].visible?(r(),f(k,{label:"\u72B6\u6001",align:"center",width:"100",key:"hasStatus",prop:"hasStatus","show-overflow-tooltip":!0},{default:e(l=>[t(Ve,{modelValue:l.row.hasStatus,"onUpdate:modelValue":$=>l.row.hasStatus=$,"active-value":0,"inactive-value":1,onChange:$=>o.handleChangStatusField("hasStatus",l.row.hasStatus,l.row.id)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})):v("",!0),n(b)[7].visible?(r(),f(k,{key:6,label:"\u66F4\u65B0\u65F6\u95F4",align:"center",prop:"addTime",width:"160"},{default:e(l=>[d("span",null,N(o.parseTime(l.row.addTime)),1)]),_:1})):v("",!0),n(b)[8].visible?(r(),f(k,{key:7,label:"\u64CD\u4F5C",align:"center",width:"100","class-name":"small-padding fixed-width"},{default:e(l=>[l.row.applicationId!==1?(r(),f(te,{key:0,content:"\u4FEE\u6539",placement:"top"},{default:e(()=>[V(t(u,{link:"",type:"primary",icon:"Edit",onClick:$=>ee(l.row)},null,8,["onClick"]),[[L,["system:Channel:edit"]]])]),_:2},1024)):v("",!0),l.row.applicationId!==1?(r(),f(te,{key:1,content:"\u5220\u9664",placement:"top"},{default:e(()=>[V(t(u,{link:"",type:"primary",icon:"Delete",onClick:$=>Z(l.row)},null,8,["onClick"]),[[L,["system:Channel:remove"]]])]),_:2},1024)):v("",!0)]),_:1})):v("",!0)]),_:1},8,["data"])),[[qe,n(K)]]),V(t(Ie,{total:n(B),page:n(_).pageNum,"onUpdate:page":a[3]||(a[3]=l=>n(_).pageNum=l),limit:n(_).pageSize,"onUpdate:limit":a[4]||(a[4]=l=>n(_).pageSize=l),onPagination:S},null,8,["total","page","limit"]),[[re,n(B)>0]])]),_:1})]),_:1}),t(O,{title:n(M),modelValue:n(w),"onUpdate:modelValue":a[8]||(a[8]=l=>E(w)?w.value=l:null),width:"900px","append-to-body":""},{footer:e(()=>[d("div",pl,[t(u,{type:"primary",onClick:Ce},{default:e(()=>[s("\u786E \u5B9A")]),_:1}),t(u,{onClick:ye},{default:e(()=>[s("\u53D6 \u6D88")]),_:1})])]),default:e(()=>[t(le,{model:n(g),rules:n(me),ref:"ChannelRef","label-width":"80px"},{default:e(()=>[t(A,null,{default:e(()=>[t(x,{span:24,class:"editor-after-div"},{default:e(()=>[t(U,{label:"\u5934\u50CF",rules:[{required:!0,message:"\u8BF7\u4E0A\u4F20\u5934\u50CF",trigger:"blur"}]},{default:e(()=>[t(ne,{"file-list":o.fileList,action:h.url+"?type=img&updateSupport="+h.updateSupport,"list-type":"picture-card","auto-upload":!0,limit:1,"on-success":he,"before-upload":_e,headers:h.headers,disabled:h.isUploading,"on-progress":o.handleFileUploadProgress},{default:e(()=>[t(ae,{class:"avatar-uploader-icon"},{default:e(()=>[t(Ae)]),_:1})]),_:1},8,["file-list","action","headers","disabled","on-progress"])]),_:1})]),_:1})]),_:1}),t(A,null,{default:e(()=>[t(x,{span:24},{default:e(()=>[t(U,{label:"\u9891\u9053\u7C7B\u578B",prop:"channelType"},{default:e(()=>[t(Re,{modelValue:n(g).channelType,"onUpdate:modelValue":a[5]||(a[5]=l=>n(g).channelType=l)},{default:e(()=>[(r(),se(Be,null,Me(ce,l=>t(Ne,{key:l.id,value:l.id,label:l.id,size:"large"},{default:e(()=>[s(N(l.name),1)]),_:2},1032,["value","label"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(A,null,{default:e(()=>[t(x,{span:24},{default:e(()=>[t(U,{label:"\u9891\u9053\u540D\u79F0",prop:"channelName"},{default:e(()=>[t(C,{modelValue:n(g).channelName,"onUpdate:modelValue":a[6]||(a[6]=l=>n(g).channelName=l),placeholder:"\u8BF7\u8F93\u5165\u9891\u9053\u540D\u79F0",maxlength:"30"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(A,null,{default:e(()=>[t(x,{span:24},{default:e(()=>[t(U,{label:"\u9891\u9053\u63CF\u8FF0",prop:"channelDesc"},{default:e(()=>[t(C,{modelValue:n(g).channelDesc,"onUpdate:modelValue":a[7]||(a[7]=l=>n(g).channelDesc=l),placeholder:"\u8BF7\u8F93\u5165\u9891\u9053\u7C7B\u578B",maxlength:"350"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),t(O,{title:h.title,modelValue:h.open,"onUpdate:modelValue":a[11]||(a[11]=l=>h.open=l),width:"400px","append-to-body":""},{footer:e(()=>[d("div",_l,[t(u,{type:"primary",onClick:o.submitFileForm},{default:e(()=>[s("\u786E \u5B9A")]),_:1},8,["onClick"]),t(u,{onClick:a[10]||(a[10]=l=>h.open=!1)},{default:e(()=>[s("\u53D6 \u6D88")]),_:1})])]),default:e(()=>[t(ne,{ref:"uploadRef",limit:1,accept:".xlsx, .xls",headers:h.headers,action:h.url+"?updateSupport="+h.updateSupport,disabled:h.isUploading,"on-progress":o.handleFileUploadProgress,"on-success":o.handleFileSuccess,"auto-upload":!1,drag:""},{tip:e(()=>[d("div",fl,[d("div",ml,[t(De,{modelValue:h.updateSupport,"onUpdate:modelValue":a[9]||(a[9]=l=>h.updateSupport=l)},null,8,["modelValue"]),s(" \u662F\u5426\u66F4\u65B0\u5DF2\u7ECF\u5B58\u5728\u7684\u5E94\u7528\u6570\u636E ")]),hl,t($e,{type:"primary",underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},onClick:o.importTemplate},{default:e(()=>[s("\u4E0B\u8F7D\u6A21\u677F ")]),_:1},8,["onClick"])])]),default:e(()=>[t(ae,{class:"el-icon--upload"},{default:e(()=>[t(Fe)]),_:1}),cl]),_:1},8,["headers","action","disabled","on-progress","on-success"])]),_:1},8,["title","modelValue"]),t(O,{modelValue:n(I),"onUpdate:modelValue":a[14]||(a[14]=l=>E(I)?I.value=l:null),title:n(X),width:"50%"},{footer:e(()=>[d("div",vl,[t(u,{onClick:a[13]||(a[13]=l=>I.value=!1)},{default:e(()=>[s("\u5173\u95ED")]),_:1}),t(u,{type:"primary",onClick:Se},{default:e(()=>[s("\u786E\u8BA4")]),_:1})])]),default:e(()=>[d("div",gl,[t(Pe,{modelValue:n(D),"onUpdate:modelValue":a[12]||(a[12]=l=>E(D)?D.value=l:null),filterable:"",style:{"text-align":"left",width:"100%",display:"inline-block"},titles:["\u6E90\u89D2\u8272","\u5DF2\u9009\u62E9"],format:{noChecked:"${total}",hasChecked:"${checked}/${total}"},"filter-method":xe,"filter-placeholder":"\u641C\u7D22\u89D2\u8272",data:n(W)},null,8,["modelValue","data"])])]),_:1},8,["modelValue","title"])])}}}),wl=ze(bl,[["__scopeId","data-v-991e0f26"]]);export{wl as default};
