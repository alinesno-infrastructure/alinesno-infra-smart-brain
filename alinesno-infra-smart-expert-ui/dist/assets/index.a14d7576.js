import{E as x,K as W,B as pe,m as me,r,Q as ce,R as be,a as u,H as A,o as i,l as fe,d as e,w as a,I as N,f as l,h as H,j as V,U as J,J as G,c as p,i as _,e as M,x as ge,n as _e}from"./index.2b31a27b.js";var m="/api/infra/base/starter/datasource/",C={datatables:m+"datatables",createUrl:m+"add",saveUrl:m+"save",updateUrl:m+"modify",statusUrl:m+"changeStatus",cleanUrl:m+"clean",detailUrl:m+"detail",removeUrl:m+"delete",exportUrl:m+"exportExcel",changeField:m+"changeField",downloadFile:m+"downloadFile"};function ve(c){return x({url:C.datatables,method:"post",params:c})}function ye(c){return x({url:C.detailUrl+"/"+W(c),method:"get"})}function he(c){return x({url:C.saveUrl,method:"post",data:c})}function we(c){return x({url:C.updateUrl,method:"put",data:c})}function ke(c){return x({url:C.removeUrl+"/"+W(c),method:"delete"})}const Ue={class:"app-container"},Ve={class:"dialog-footer"},De=pe({name:"Database"}),xe=Object.assign(De,{setup(c){me();const{proxy:v}=_e(),$=r([]),k=r(!1),T=r(!0),S=r(!0),I=r([]),F=r(!0),K=r(!0),q=r(0),P=r(""),E=r([]);r([]),r([]);const y=r([{key:0,label:"\u6570\u636E\u5E93\u540D\u79F0",visible:!0},{key:1,label:"\u6570\u636E\u5E93\u63CF\u8FF0",visible:!0},{key:2,label:"\u8868\u6570\u636E\u91CF",visible:!0},{key:3,label:"\u7C7B\u578B",visible:!0},{key:4,label:"\u6570\u636E\u5E93\u5730\u5740",visible:!0},{key:5,label:"\u72B6\u6001",visible:!0},{key:6,label:"\u66F4\u65B0\u65F6\u95F4",visible:!0}]),X=ce({form:{},queryParams:{pageNum:1,pageSize:10,dbName:void 0,dbDesc:void 0},rules:{dbName:[{required:!0,message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],jdbcUrl:[{required:!0,message:"\u8FDE\u63A5\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],dbType:[{required:!0,message:"\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],dbUsername:[{required:!0,message:"\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],dbPasswd:[{required:!0,message:"\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],dbDesc:[{required:!0,message:"\u5907\u6CE8\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}}),{queryParams:s,form:o,rules:Y}=be(X);function U(){T.value=!0,ve(v.addDateRange(s.value,E.value)).then(d=>{T.value=!1,$.value=d.rows,q.value=d.total})}function R(){s.value.pageNum=1,U()}function Z(){E.value=[],v.resetForm("queryRef"),s.value.deptId=void 0,v.$refs.deptTreeRef.setCurrentKey(null),R()}function B(d){const t=d.id||I.value;v.$modal.confirm('\u662F\u5426\u786E\u8BA4\u5220\u9664\u6570\u636E\u5E93\u7F16\u53F7\u4E3A"'+t+'"\u7684\u6570\u636E\u9879\uFF1F').then(function(){return ke(t)}).then(()=>{U(),v.$modal.msgSuccess("\u5220\u9664\u6210\u529F")}).catch(()=>{})}function ee(d){I.value=d.map(t=>t.id),F.value=d.length!=1,K.value=!d.length}function j(){o.value={id:void 0,deptId:void 0,DatabaseName:void 0,nickName:void 0,password:void 0,phonenumber:void 0,status:"0",remark:void 0},v.resetForm("databaseRef")}function le(){k.value=!1,j()}function ae(){j(),k.value=!0,P.value="\u6DFB\u52A0\u6570\u636E\u5E93"}function Q(d){j();const t=d.id||I.value;ye(t).then(b=>{o.value=b.data,k.value=!0,P.value="\u4FEE\u6539\u6570\u636E\u5E93"})}function te(){v.$refs.databaseRef.validate(d=>{d&&(o.value.DatabaseId!=null?we(o.value).then(t=>{v.$modal.msgSuccess("\u4FEE\u6539\u6210\u529F"),k.value=!1,U()}):he(o.value).then(t=>{v.$modal.msgSuccess("\u65B0\u589E\u6210\u529F"),k.value=!1,U()}))})}return U(),(d,t)=>{const b=u("el-input"),h=u("el-form-item"),w=u("el-button"),z=u("el-form"),f=u("el-col"),ne=u("right-toolbar"),D=u("el-row"),g=u("el-table-column"),L=u("el-tooltip"),oe=u("el-table"),de=u("pagination"),re=u("el-tree-select"),ue=u("el-dialog"),O=A("hasPermi"),se=A("loading");return i(),fe("div",Ue,[e(D,{gutter:20},{default:a(()=>[e(f,{span:24,xs:24},{default:a(()=>[N(e(z,{model:l(s),ref:"queryRef",inline:!0,"label-width":"100px"},{default:a(()=>[e(h,{label:"\u6570\u636E\u5E93\u540D\u79F0",prop:"dbName"},{default:a(()=>[e(b,{modelValue:l(s).dbName,"onUpdate:modelValue":t[0]||(t[0]=n=>l(s).dbName=n),placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u540D\u79F0",clearable:"",style:{width:"240px"},onKeyup:H(R,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(h,{label:"\u6570\u636E\u5E93\u540D\u79F0",prop:"dbName"},{default:a(()=>[e(b,{modelValue:l(s)["condition[dbName|like]"],"onUpdate:modelValue":t[1]||(t[1]=n=>l(s)["condition[dbName|like]"]=n),placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u540D\u79F0",clearable:"",style:{width:"240px"},onKeyup:H(R,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(h,null,{default:a(()=>[e(w,{type:"primary",icon:"Search",onClick:R},{default:a(()=>[V("\u641C\u7D22")]),_:1}),e(w,{icon:"Refresh",onClick:Z},{default:a(()=>[V("\u91CD\u7F6E")]),_:1})]),_:1})]),_:1},8,["model"]),[[J,l(S)]]),e(D,{gutter:10,class:"mb8"},{default:a(()=>[e(f,{span:1.5},{default:a(()=>[e(w,{type:"primary",plain:"",icon:"Plus",onClick:ae},{default:a(()=>[V("\u65B0\u589E")]),_:1})]),_:1},8,["span"]),e(f,{span:1.5},{default:a(()=>[e(w,{type:"success",plain:"",icon:"Edit",disabled:l(F),onClick:Q},{default:a(()=>[V("\u4FEE\u6539")]),_:1},8,["disabled"])]),_:1},8,["span"]),e(f,{span:1.5},{default:a(()=>[e(w,{type:"danger",plain:"",icon:"Delete",disabled:l(K),onClick:B},{default:a(()=>[V("\u5220\u9664")]),_:1},8,["disabled"])]),_:1},8,["span"]),e(ne,{showSearch:l(S),"onUpdate:showSearch":t[2]||(t[2]=n=>G(S)?S.value=n:null),onQueryTable:U,columns:l(y)},null,8,["showSearch","columns"])]),_:1}),N((i(),p(oe,{data:l($),onSelectionChange:ee},{default:a(()=>[e(g,{type:"selection",width:"50",align:"center"}),l(y)[5].visible?(i(),p(g,{label:"\u56FE\u6807",align:"center",with:"80",key:"status"})):_("",!0),l(y)[0].visible?(i(),p(g,{label:"\u6570\u636E\u5E93\u540D\u79F0",align:"center",key:"dbName",prop:"dbName"})):_("",!0),l(y)[1].visible?(i(),p(g,{label:"\u6570\u636E\u5E93\u63CF\u8FF0",align:"center",key:"dbDesc",prop:"dbDesc","show-overflow-tooltip":!0})):_("",!0),l(y)[2].visible?(i(),p(g,{label:"\u8868\u6570\u636E\u91CF",align:"center",key:"nickName",prop:"nickName","show-overflow-tooltip":!0})):_("",!0),l(y)[3].visible?(i(),p(g,{label:"\u7C7B\u578B",align:"center",key:"dbType",prop:"dbType","show-overflow-tooltip":!0})):_("",!0),l(y)[4].visible?(i(),p(g,{label:"\u6570\u636E\u5E93\u5730\u5740",align:"center",key:"jdbcUrl",prop:"jdbcUrl",width:"120"})):_("",!0),l(y)[5].visible?(i(),p(g,{label:"\u72B6\u6001",align:"center",key:"hasStatus"})):_("",!0),l(y)[6].visible?(i(),p(g,{key:7,label:"\u6DFB\u52A0\u65F6\u95F4",align:"center",prop:"addTime",width:"160"},{default:a(n=>[M("span",null,ge(d.parseTime(n.row.addTime)),1)]),_:1})):_("",!0),e(g,{label:"\u64CD\u4F5C",align:"center",width:"150","class-name":"small-padding fixed-width"},{default:a(n=>[n.row.DatabaseId!==1?(i(),p(L,{key:0,content:"\u4FEE\u6539",placement:"top"},{default:a(()=>[N(e(w,{link:"",type:"primary",icon:"Edit",onClick:ie=>Q(n.row)},null,8,["onClick"]),[[O,["system:Database:edit"]]])]),_:2},1024)):_("",!0),n.row.DatabaseId!==1?(i(),p(L,{key:1,content:"\u5220\u9664",placement:"top"},{default:a(()=>[N(e(w,{link:"",type:"primary",icon:"Delete",onClick:ie=>B(n.row)},null,8,["onClick"]),[[O,["system:Database:remove"]]])]),_:2},1024)):_("",!0)]),_:1})]),_:1},8,["data"])),[[se,l(T)]]),N(e(de,{total:l(q),page:l(s).pageNum,"onUpdate:page":t[3]||(t[3]=n=>l(s).pageNum=n),limit:l(s).pageSize,"onUpdate:limit":t[4]||(t[4]=n=>l(s).pageSize=n),onPagination:U},null,8,["total","page","limit"]),[[J,l(q)>0]])]),_:1})]),_:1}),e(ue,{title:l(P),modelValue:l(k),"onUpdate:modelValue":t[12]||(t[12]=n=>G(k)?k.value=n:null),width:"900px","append-to-body":""},{footer:a(()=>[M("div",Ve,[e(w,{type:"primary",onClick:te},{default:a(()=>[V("\u786E \u5B9A")]),_:1}),e(w,{onClick:le},{default:a(()=>[V("\u53D6 \u6D88")]),_:1})])]),default:a(()=>[e(z,{model:l(o),rules:l(Y),ref:"databaseRef","label-width":"100px"},{default:a(()=>[e(D,null,{default:a(()=>[e(f,{span:24},{default:a(()=>[e(h,{label:"\u540D\u79F0",prop:"dbName"},{default:a(()=>[e(b,{modelValue:l(o).dbName,"onUpdate:modelValue":t[5]||(t[5]=n=>l(o).dbName=n),placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u540D\u79F0",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(D,null,{default:a(()=>[e(f,{span:24},{default:a(()=>[e(h,{label:"\u8FDE\u63A5",prop:"jdbcUrl"},{default:a(()=>[e(b,{modelValue:l(o).jdbcUrl,"onUpdate:modelValue":t[6]||(t[6]=n=>l(o).jdbcUrl=n),placeholder:"\u8BF7\u8F93\u5165jdbcUrl\u8FDE\u63A5\u5730\u5740",maxlength:"128"},null,8,["modelValue"])]),_:1})]),_:1}),e(f,{span:24},{default:a(()=>[e(h,{label:"\u7C7B\u578B",prop:"dbType"},{default:a(()=>[e(b,{modelValue:l(o).dbType,"onUpdate:modelValue":t[7]||(t[7]=n=>l(o).dbType=n),placeholder:"\u8BF7\u8F93\u5165\u7C7B\u578B",maxlength:"50"},null,8,["modelValue"]),e(re,{modelValue:l(o).deptId,"onUpdate:modelValue":t[8]||(t[8]=n=>l(o).deptId=n),data:d.deptOptions,props:{value:"id",label:"label",children:"children"},"value-key":"id",placeholder:"\u8BF7\u9009\u62E9\u5F52\u5C5E\u90E8\u95E8","check-strictly":""},null,8,["modelValue","data"])]),_:1})]),_:1})]),_:1}),e(D,null,{default:a(()=>[e(f,{span:24},{default:a(()=>[e(h,{label:"\u7528\u6237\u540D",prop:"dbUsername"},{default:a(()=>[e(b,{modelValue:l(o).dbUsername,"onUpdate:modelValue":t[9]||(t[9]=n=>l(o).dbUsername=n),placeholder:"\u8BF7\u8F93\u5165\u8FDE\u63A5\u7528\u6237\u540D",maxlength:"30"},null,8,["modelValue"])]),_:1})]),_:1}),e(f,{span:24},{default:a(()=>[e(h,{label:"\u5BC6\u7801",prop:"dbPasswd"},{default:a(()=>[e(b,{modelValue:l(o).dbPasswd,"onUpdate:modelValue":t[10]||(t[10]=n=>l(o).dbPasswd=n),placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u5BC6\u7801",type:"password",maxlength:"30","show-password":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(D,null,{default:a(()=>[e(f,{span:24},{default:a(()=>[e(h,{label:"\u5907\u6CE8",prop:"dbDesc"},{default:a(()=>[e(b,{modelValue:l(o).dbDesc,"onUpdate:modelValue":t[11]||(t[11]=n=>l(o).dbDesc=n),placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}});export{xe as default};
