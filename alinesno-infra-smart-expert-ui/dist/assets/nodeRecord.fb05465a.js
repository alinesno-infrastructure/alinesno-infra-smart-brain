import{E as R,B as ne,m as de,r as s,Q as $,T as se,R as ie,a as i,H as re,o as f,l as ue,d as e,w as t,I as B,c as h,f as o,i as y,j as p,x as z,e as g,U as pe,J as me,n as ce}from"./index.2b31a27b.js";var r="/api/infra/smart/assistant/workflowNodeExecution/",q={datatables:r+"datatables",createUrl:r+"add",saveUrl:r+"save",updateUrl:r+"modify",statusUrl:r+"changeStatus",cleanUrl:r+"clean",detailUrl:r+"detail",removeUrl:r+"delete",exportUrl:r+"exportExcel",changeField:r+"changeField",downloadFile:r+"downloadFile",getNodeList:r+"getNodeList"};function fe(_){return R({url:q.datatables,method:"post",params:_})}function ge(_){return R({url:q.saveUrl,method:"post",data:_})}function _e(_){return R({url:q.updateUrl,method:"put",data:_})}const be={class:"dialog-footer"},ve=g("div",{class:"el-upload__text"},[p("\u5C06\u6587\u4EF6\u62D6\u5230\u6B64\u5904\uFF0C\u6216"),g("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1),he={class:"el-upload__tip text-center"},xe={class:"el-upload__tip"},we=g("span",null,"\u4EC5\u5141\u8BB8\u5BFC\u5165xls\u3001xlsx\u683C\u5F0F\u6587\u4EF6\u3002",-1),ke={class:"dialog-footer"},Ne=ne({name:"NodeExcection"}),Ve=Object.assign(Ne,{props:{currentWorkflowId:{type:String}},setup(_){const D=_;de();const{proxy:V}=ce(),I=s([]),x=s(!1),E=s(!0);s(!0);const L=s([]),W=s(!0),M=s(!0),F=s(0),j=s(""),A=s([]);s(""),s(void 0),s(void 0),s([]),s([]);const u=$({open:!1,title:"",isUploading:!1,updateSupport:0,headers:{Authorization:"Bearer "+se()},url:"/prod-api/system/NodeExcection/importData"}),U=s([{key:0,label:"\u56FE\u6807",visible:!0},{key:1,label:"\u8282\u70B9\u540D\u79F0",visible:!0},{key:2,label:"\u663E\u793A\u540D\u79F0",visible:!0},{key:3,label:"\u6240\u5C5E\u9886\u57DF",visible:!0},{key:4,label:"\u57DF\u540D",visible:!0},{key:5,label:"\u5B89\u5168\u5B58\u50A8\u8DEF\u5F84",visible:!0},{key:6,label:"\u6267\u884C\u72B6\u6001",visible:!0},{key:7,label:"\u521B\u5EFA\u65F6\u95F4",visible:!0},{key:8,label:"\u7F16\u8F91",visible:!0}]),H=$({form:{},queryParams:{pageNum:1,pageSize:10,currentWorkflowId:D.currentWorkflowId,nodeName:void 0,showName:void 0,status:void 0,deptId:void 0},rules:{NodeExcectionId:[{required:!0,message:"\u8282\u70B9\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],nodeName:[{required:!0,message:"\u8282\u70B9\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{min:2,max:20,message:"\u8282\u70B9\u540D\u79F0\u957F\u5EA6\u5FC5\u987B\u4ECB\u4E8E 2 \u548C 20 \u4E4B\u95F4",trigger:"blur"}],showName:[{required:!0,message:"\u663E\u793A\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],domain:[{required:!0,message:"\u6240\u5C5E\u9886\u57DF\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],timeSpent:[{required:!0,message:"\u57DF\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],storagePath:[{required:!0,message:"\u5B89\u5168\u5B58\u50A8\u8DEF\u5F84\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],target:[{required:!0,message:"\u6267\u884C\u72B6\u6001\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}}),{queryParams:S,form:d,rules:J}=ie(H);function C(){E.value=!0,fe(V.addDateRange(S.value,A.value)).then(n=>{E.value=!1,I.value=n.rows,F.value=n.total})}function O(n){const l=n/60,m=Math.floor(l/3600),c=Math.floor(l%3600/60),P=Math.floor(l%60);let w="";return m>0&&(w+=`${m}\u65F6`),(c>0||m>0)&&(w+=`${c}\u5206`),w+=`${P}\u79D2`,w}function Q(n){L.value=n.map(l=>l.id),W.value=n.length!=1,M.value=!n.length}function G(){d.value={NodeExcectionId:void 0,nodeName:void 0,showName:void 0,domain:void 0,timeSpent:void 0,storagePath:void 0,target:void 0},V.resetForm("NodeExcectionRef")}function K(){x.value=!1,G()}function X(){V.$refs.NodeExcectionRef.validate(n=>{n&&(d.value.NodeExcectionId!=null?_e(d.value).then(l=>{V.$modal.msgSuccess("\u4FEE\u6539\u6210\u529F"),x.value=!1,C()}):ge(d.value).then(l=>{V.$modal.msgSuccess("\u65B0\u589E\u6210\u529F"),x.value=!1,C()}))})}return C(),(n,l)=>{const m=i("el-table-column"),c=i("el-button"),P=i("el-table"),w=i("pagination"),b=i("el-col"),v=i("el-row"),k=i("el-input"),N=i("el-form-item"),Y=i("el-form"),T=i("el-dialog"),Z=i("upload-filled"),ee=i("el-icon"),te=i("el-checkbox"),le=i("el-link"),ae=i("el-upload"),oe=re("loading");return f(),ue("div",null,[e(v,{gutter:20},{default:t(()=>[e(b,{span:24,xs:24},{default:t(()=>[B((f(),h(P,{data:o(I),onSelectionChange:Q},{default:t(()=>[e(m,{type:"index",width:"50",label:"\u5E8F\u53F7",align:"center"}),o(U)[1].visible?(f(),h(m,{label:"\u8282\u70B9\u540D\u79F0",align:"left",key:"nodeName",prop:"nodeName","show-overflow-tooltip":!0})):y("",!0),o(U)[4].visible?(f(),h(m,{label:"\u6267\u884C\u65F6\u95F4",align:"left",width:"150",key:"timeSpent",prop:"timeSpent"},{default:t(a=>[p(z(O(a.row.timeSpent)),1)]),_:1})):y("",!0),o(U)[3].visible?(f(),h(m,{label:"\u6267\u884C\u72B6\u6001",align:"center",key:"status",prop:"workflowStatus",width:"100","show-overflow-tooltip":!0},{default:t(a=>[a.row.status==="success"?(f(),h(c,{key:0,type:"success",icon:n.CircleCheck,text:"",bg:""},{default:t(()=>[p("\u6210\u529F")]),_:1},8,["icon"])):y("",!0),a.row.status==="fail"?(f(),h(c,{key:1,type:"warning",icon:n.Warning,text:"",bg:""},{default:t(()=>[p("\u5931\u8D25")]),_:1},8,["icon"])):y("",!0)]),_:1})):y("",!0),o(U)[7].visible?(f(),h(m,{key:3,label:"\u7ED3\u675F\u65F6\u95F4",align:"center",prop:"addTime",width:"160"},{default:t(a=>[g("span",null,z(n.parseTime(a.row.endTime)),1)]),_:1})):y("",!0)]),_:1},8,["data"])),[[oe,o(E)]]),B(e(w,{total:o(F),page:o(S).pageNum,"onUpdate:page":l[0]||(l[0]=a=>o(S).pageNum=a),limit:o(S).pageSize,"onUpdate:limit":l[1]||(l[1]=a=>o(S).pageSize=a),onPagination:C},null,8,["total","page","limit"]),[[pe,o(F)>0]])]),_:1})]),_:1}),e(T,{title:o(j),modelValue:o(x),"onUpdate:modelValue":l[8]||(l[8]=a=>me(x)?x.value=a:null),width:"900px","append-to-body":""},{footer:t(()=>[g("div",be,[e(c,{type:"primary",onClick:X},{default:t(()=>[p("\u786E \u5B9A")]),_:1}),e(c,{onClick:K},{default:t(()=>[p("\u53D6 \u6D88")]),_:1})])]),default:t(()=>[e(Y,{model:o(d),rules:o(J),ref:"NodeExcectionRef","label-width":"80px"},{default:t(()=>[e(v,null,{default:t(()=>[e(b,{span:24},{default:t(()=>[e(N,{label:"\u8282\u70B9\u540D\u79F0",prop:"nodeName"},{default:t(()=>[e(k,{modelValue:o(d).nodeName,"onUpdate:modelValue":l[2]||(l[2]=a=>o(d).nodeName=a),placeholder:"\u8BF7\u8F93\u5165\u8282\u70B9\u540D\u79F0",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(v,null,{default:t(()=>[e(b,{span:24},{default:t(()=>[e(N,{label:"\u663E\u793A\u540D\u79F0",prop:"showName"},{default:t(()=>[e(k,{modelValue:o(d).showName,"onUpdate:modelValue":l[3]||(l[3]=a=>o(d).showName=a),placeholder:"\u8BF7\u8F93\u5165\u663E\u793A\u540D\u79F0",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(v,null,{default:t(()=>[e(b,{span:24},{default:t(()=>[e(N,{label:"\u57DF\u540D",prop:"timeSpent"},{default:t(()=>[e(k,{modelValue:o(d).timeSpent,"onUpdate:modelValue":l[4]||(l[4]=a=>o(d).timeSpent=a),placeholder:"\u8BF7\u8F93\u5165\u57DF\u540D",maxlength:"100"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(v,null,{default:t(()=>[e(b,{span:24},{default:t(()=>[e(N,{label:"\u6240\u5C5E\u9886\u57DF",prop:"domain"},{default:t(()=>[e(k,{modelValue:o(d).domain,"onUpdate:modelValue":l[5]||(l[5]=a=>o(d).domain=a),placeholder:"\u8BF7\u8F93\u5165\u6240\u5C5E\u9886\u57DF",maxlength:"100"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(v,null,{default:t(()=>[e(b,{span:24},{default:t(()=>[e(N,{label:"\u5B89\u5168\u5B58\u50A8\u8DEF\u5F84",prop:"storagePath","label-width":"107px"},{default:t(()=>[e(k,{modelValue:o(d).storagePath,"onUpdate:modelValue":l[6]||(l[6]=a=>o(d).storagePath=a),placeholder:"\u8BF7\u8F93\u5165\u5B89\u5168\u5B58\u50A8\u8DEF\u5F84",maxlength:"200"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(v,null,{default:t(()=>[e(b,{span:24},{default:t(()=>[e(N,{label:"\u6267\u884C\u72B6\u6001",prop:"target"},{default:t(()=>[e(k,{modelValue:o(d).target,"onUpdate:modelValue":l[7]||(l[7]=a=>o(d).target=a),placeholder:"\u8BF7\u8F93\u5165\u6267\u884C\u72B6\u6001",maxlength:"20"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),e(T,{title:u.title,modelValue:u.open,"onUpdate:modelValue":l[11]||(l[11]=a=>u.open=a),width:"400px","append-to-body":""},{footer:t(()=>[g("div",ke,[e(c,{type:"primary",onClick:n.submitFileForm},{default:t(()=>[p("\u786E \u5B9A")]),_:1},8,["onClick"]),e(c,{onClick:l[10]||(l[10]=a=>u.open=!1)},{default:t(()=>[p("\u53D6 \u6D88")]),_:1})])]),default:t(()=>[e(ae,{ref:"uploadRef",limit:1,accept:".xlsx, .xls",headers:u.headers,action:u.url+"?updateSupport="+u.updateSupport,disabled:u.isUploading,"on-progress":n.handleFileUploadProgress,"on-success":n.handleFileSuccess,"auto-upload":!1,drag:""},{tip:t(()=>[g("div",he,[g("div",xe,[e(te,{modelValue:u.updateSupport,"onUpdate:modelValue":l[9]||(l[9]=a=>u.updateSupport=a)},null,8,["modelValue"]),p(" \u662F\u5426\u66F4\u65B0\u5DF2\u7ECF\u5B58\u5728\u7684\u8282\u70B9\u6570\u636E ")]),we,e(le,{type:"primary",underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},onClick:n.importTemplate},{default:t(()=>[p("\u4E0B\u8F7D\u6A21\u677F ")]),_:1},8,["onClick"])])]),default:t(()=>[e(ee,{class:"el-icon--upload"},{default:t(()=>[e(Z)]),_:1}),ve]),_:1},8,["headers","action","disabled","on-progress","on-success"])]),_:1},8,["title","modelValue"])])}}});export{Ve as default};
