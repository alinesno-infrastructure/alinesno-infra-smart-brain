import{_ as W,r,Q as X,o as Y,K as R,a as d,C as Z,D as ee,u as f,b as p,c as _,e as s,d as n,w as l,n as P,t as u,F as oe,f as te,S as v,l as m,y as se,G as ae,N as ne,H as le,I as ie,L as re,p as ce,i as de,J as ue}from"./index.d9d30be3.js";import{M as he,H as I,m as pe}from"./index.23422e4c.js";import{g as ge,c as fe}from"./roleChat.91ed275b.js";import{h as _e,o as ve}from"./chatsse.0657b2ca.js";const K=y=>(ce("data-v-4961f40f"),y=y(),de(),y),me=["element-loading-spinner"],ye={class:"smart-container inner-smart-container"},be={class:"robot-chat-windows"},ke={class:"robot-chat-header"},we={class:"chat-header-title"},xe={class:"chat-header-desc"},Ce={class:"chat-header-desc",style:{float:"right","margin-top":"-10px"}},Se=K(()=>s("i",{class:"fa-solid fa-truck-fast icon-btn"},null,-1)),Te={class:"robot-chat-body inner-robot-chat-body"},Ie=["onMouseover","onMouseleave"],Le={class:"header-images"},$e=["src"],De={key:0,class:"say-message-info"},Ne={key:1,class:"say-message-info"},Ee=["innerHTML"],He={class:"robot-chat-footer chat-container",style:{float:"left",width:"100%"}},Me={class:"message-input"},Ve=K(()=>s("i",{class:"fa-solid fa-feather icon-btn"},null,-1)),ze={__name:"agentChatPanel",setup(y){const{proxy:L}=ue(),$=r(!0),b=r(null),g=r(null),k=r({}),c=r(""),D=r(null),N=r(null),h=r([]),w=r(null),E=new he({html:!0,linkify:!0,highlight(e,o){if(!!(o&&I.getLanguage(o))){const i=o||"";return M(I.highlight(e,{language:i}).value,i)}return M(I.highlightAuto(e).value,"")}});E.use(pe,{blockClass:"katexmath-block rounded-md p-[10px]",errorColor:" #cc0000"});function H(){P(()=>{const o=D.value.scrollHeight;N.value.setScrollTop(o)})}function M(e,o){return`<pre class="code-block-wrapper"><code class="hljs code-block-body ${o}">${e}</code></pre>`}function J(e){!c.value||(C(),c.value="")}function O(e){return E.render(e)}const x=e=>{if(console.log(`--->>> newMessage = ${JSON.stringify(e)}`),e.llmStream===!0){const o=h.value.findIndex(a=>a.businessId===e.businessId);o!==-1?h.value[o].chatText+=e.chatText:h.value.push(e)}else h.value.push(e);H()};function F(e){P(()=>{if(e){let o=ve(e);o.onmessage=function(a){if(a.data.includes("[DONE]"))console.log("\u6D88\u606F\u63A5\u6536\u7ED3\u675F."),w.value&&w.value.close();else{let i=a.data;if(console.log("sseSource.onmessage = "+i),i!="ping"){const S=JSON.parse(i);x(S)}}}}})}X(()=>{_e(g.value).then(e=>{console.log("\u5173\u95EDsse\u8FDE\u63A5\u6210\u529F:"+g)})});function G(e){ge(e).then(o=>{let a=o.role,i=o.message;k.value=a,x(i),$.value=!1})}const C=e=>{if(!c.value){L.$modal.msgError("\u8BF7\u8F93\u5165\u6D88\u606F\u5185\u5BB9.");return}w.value=ie.service({lock:!0,text:"\u4EFB\u52A1\u6267\u884C\u4E2D\uFF0C\u8BF7\u52FF\u64CD\u4F5C\u5176\u5B83\u754C\u9762 ...",background:"rgba(0, 0, 0, 0.2)"});let o={channelId:g.value,message:c.value};fe(o,b.value).then(a=>{L.$modal.msgSuccess("\u53D1\u9001\u6210\u529F"),x(a.data)}),c.value=""};function A(e){h.value.forEach(o=>{o.showTools=o===e})}function U(e){e.showTools=!1}return Y(()=>{H(),b.value=R("roleId"),g.value=R("channelId"),F(g.value),G(b.value)}),(e,o)=>{const a=d("el-button"),i=d("el-scrollbar"),S=d("el-input"),T=d("el-col"),j=d("svg-icon"),V=d("el-tooltip"),z=d("el-row"),Q=Z("loading");return ee((p(),_("div",{class:"acp-dashboard aip-chat-dashboard-panel","element-loading-text":"Loading...","element-loading-spinner":e.svg,"element-loading-svg-view-box":"-10, -10, 50, 50","element-loading-background":"rgba(122, 122, 122, 0.8)",style:{padding:"0px !important"}},[s("div",ye,[n(z,null,{default:l(()=>[n(T,{span:24},{default:l(()=>[s("div",be,[s("div",ke,[s("div",we,u(f(k).roleName),1),s("div",xe," ("+u(e.truncateString(f(k).responsibilities,30))+") ",1),s("div",Ce,[n(a,{type:"primary",text:"",bg:"",size:"large",onClick:o[0]||(o[0]=t=>e.taskFlowDialogVisible=!0)},{default:l(()=>[Se]),_:1})])]),s("div",Te,[n(i,{class:"scroll-panel",ref_key:"scrollbarRef",ref:N,loading:"",always:"","wrap-style":"padding:10px"},{default:l(()=>[s("div",{ref_key:"innerRef",ref:D},[(p(!0),_(oe,null,te(f(h),(t,q)=>(p(),_("div",{class:"robot-chat-ai-say-box",onMouseover:B=>A(t),onMouseleave:B=>U(t),key:q},[s("div",{class:v(["chat-ai-header",t.roleType=="person"?"say-right-window":""])},[s("div",Le,[s("img",{src:e.imagePath(t)},null,8,$e)])],2),s("div",{class:v(["chat-ai-say-body",t.roleType=="person"?"say-right-window":""]),style:{"max-width":"calc(100% - 135px)"}},[t.roleType=="person"?(p(),_("div",De,[s("span",{style:{"margin-left":"10px"},class:v(t.showTools?"show-tools":"hide-tools")},u(t.dateTime),3),m(" "+u(t.name),1)])):(p(),_("div",Ne,[m(u(t.name)+" ",1),t.loading?(p(),se(a,{key:0,size:"default",type:"primary",loading:"",text:""},{default:l(()=>[m("\u4EFB\u52A1\u5904\u7406\u4E2D")]),_:1})):ae("",!0),s("span",{style:{"margin-left":"10px"},class:v(t.showTools?"show-tools":"hide-tools")},u(t.dateTime),3)])),s("div",{class:"say-message-body markdown-body",innerHTML:O(t.chatText)},null,8,Ee),s("div",{class:v(["chat-ai-say-tools",t.showTools?"show-tools":"hide-tools"]),style:{"margin-top":"3px","text-align":"right",float:"right"}},[n(a,{type:"primary",link:"",icon:"EditPen",size:"small",onClick:B=>e.handleEditGenContent(t)},{default:l(()=>[m("\u590D\u5236")]),_:2},1032,["onClick"])],2)],2)],40,Ie))),128))],512)]),_:1},512)]),s("div",He,[n(z,{gutter:20},{default:l(()=>[n(T,{span:16},{default:l(()=>[s("div",Me,[n(S,{class:"input-chat-box",onKeydown:ne(re(J,["ctrl","prevent"]),["enter"]),modelValue:f(c),"onUpdate:modelValue":o[1]||(o[1]=t=>le(c)?c.value=t:null),options:e.mentionOptions,prefix:["@"],placeholder:"\u8BF7\u8F93\u5165\u4F60\u7684\u95EE\u9898.",onSelect:e.handleSelect},{label:l(({item:t})=>[m(u(t.label),1)]),_:1},8,["onKeydown","modelValue","options","onSelect"])])]),_:1}),n(T,{span:8,style:{"text-align":"right"}},{default:l(()=>[n(V,{class:"box-item",effect:"dark",content:"\u786E\u8BA4\u53D1\u9001\u6307\u4EE4\u7ED9Agent\uFF0C\u5FEB\u6377\u952E\uFF1AEnter+Ctrl",placement:"top"},{default:l(()=>[n(a,{type:"danger",text:"",bg:"",size:"large",onClick:o[2]||(o[2]=t=>C("send"))},{default:l(()=>[n(j,{"icon-class":"send",class:"icon-btn",style:{"font-size":"25px"}})]),_:1})]),_:1}),n(V,{class:"box-item",effect:"dark",content:"\u6267\u884C\u4EFB\u52A1",placement:"top"},{default:l(()=>[n(a,{type:"warning",text:"",bg:"",size:"large",onClick:o[3]||(o[3]=t=>C("function"))},{default:l(()=>[Ve]),_:1})]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1})])],8,me)),[[Q,f($)]])}}},Je=W(ze,[["__scopeId","data-v-4961f40f"]]);export{Je as default};
