import{_ as Ce,g as xe,r as i,n as be,a as c,b as z,c as M,d as n,w as a,e as s,l as m,t as x,F as ke,f as Se,y as U,G as we,L as q,E as Ie,K as Ee,I as Ve,P as Ne,p as De,i as ze,J as $e}from"./index.d9d30be3.js";import{i as Ae,g as Be,j as Pe,s as Oe}from"./generalAgent.c411e10f.js";const $=b=>(De("data-v-4b8cdca7"),b=b(),ze(),b),qe={class:"card-header"},Ge={style:{display:"flex","align-items":"center",gap:"5px"}},Le=$(()=>s("i",{class:"fa-solid fa-arrow-left"},null,-1)),Te=$(()=>s("i",{class:"fa-solid fa-file-pdf"},null,-1)),Re={class:"edit-header-avatar"},Je=["src","onClick"],Me=$(()=>s("i",{class:"fa-solid fa-plus-minus"},null,-1)),Ue=$(()=>s("i",{class:"fa-solid fa-file-shield"},null,-1)),je={class:"data-outline-tree-content"},Fe={class:"custom-tree-node",style:{height:"auto"}},He={style:{display:"flex","flex-direction":"column"}},Ke={style:{"font-size":"16px","font-weight":"bold"}},Qe={class:"description"},We={style:{color:"#777"}},Xe={style:{"margin-right":"10px",display:"flex","align-items":"center",gap:"5px"}},Ye={class:"dialog-footer"},Ze={style:{display:"flex",gap:"20px","align-items":"center"}},et={style:{"font-weight":"bold"}},tt={style:{"margin-bottom":"10px"}},nt={class:"dialog-footer"},lt={__name:"agentOutlineEditor",emits:["setCurrentSceneInfo","getChannelStreamId","openChatBox","closeShowDebugRunDialog","genChapterContentByAgent","editContent","handleExecuteHandle"],setup(b,{expose:j,emit:y}){const v=xe(),{proxy:_}=$e(),A=i(v.query.channelStreamId),F=i("\u4F60\u5148\u8FD8\u6CA1\u6709\u751F\u6210\u7AE0\u8282\u5185\u5BB9,\u8BF7\u70B9\u51FB\u667A\u80FD\u4F53\u5934\u50CF\u751F\u6210\u7AE0\u8282\u5185\u5BB9"),H=i(null),k=i(null),d=i({roleAvatar:"",roleName:"",responsibilities:"",email:"zhangsan@example.com"}),g=i([]),C=i(!1),K=i(v.query.sceneId);i("");const Q=i(!1),B=i([]),W=i("chapter"),r=i({id:0,sceneName:null,sceneDesc:null,sceneCount:0,knowledgeId:null,chapterEditors:[],contentEditors:[]}),S=i(v.query.sceneId),X=i(v.query.genStatus);i([]);const f=i(!1),w=i(null),I=i(""),E=i(""),u=i("");i(!1);const Y=(e,t,l)=>l!=="inner",Z=e=>e.data.id!==1,ee=e=>{console.log("Node clicked: ",e)},G=()=>{f.value=!1,y("openChatBox",d.value.id,u.value)},te=(e,t,l)=>{e.preventDefault(),console.log("Node context menu: ",t,l)},ne=e=>{const t={id:Date.now(),label:"\u65B0\u8282\u70B9",description:"\u8282\u70B9\u5185\u5BB9\u63CF\u8FF0\u4FE1\u606F",children:[]};e.children||(e.children=[]),e.children.push(t)},le=(e,t)=>{const l=e.parent,h=l.data.children||l.data,N=h.findIndex(P=>P.id===t.id);h.splice(N,1)},oe=(e,t)=>{w.value=e,E.value=t.description,I.value=e.label,C.value=!0},ae=(e,t)=>{y("editContent",e,t)},se=()=>{w.value&&(w.value.data.label=I.value,w.value.data.description=E.value,Ie.success("\u7F16\u8F91\u6210\u529F"),C.value=!1)},ie=async(e,t)=>{u.value=t,d.value.id=e,S.value=Ee("sceneId"),await re()},ce=()=>{_.$router.push({path:"/scene/generalAgent/index",query:{sceneId:K.value,back:!0}})},re=async()=>{if(!u.value){_.$modal.msgError("\u8BF7\u8F93\u5165\u6D88\u606F\u5185\u5BB9.");return}if(console.log("channelStreamId = "+A.value),!A.value){_.$modal.msgError("\u8BF7\u5148\u521B\u5EFA\u573A\u666F.");return}k.value=Ve.service({lock:!0,text:"\u4EFB\u52A1\u6267\u884C\u4E2D\uFF0C\u8BF7\u52FF\u64CD\u4F5C\u5176\u5B83\u754C\u9762 ...",background:"rgba(0, 0, 0, 0.2)"});let e={sceneId:S.value,channelStreamId:A.value,message:u.value,roleId:d.value.id};console.log("outline.value = "+g.value);const t=await Ae(e);console.log("response = "+t),_.$modal.msgSuccess("\u53D1\u9001\u6210\u529F"),f.value=!1,u.value="",Array.prototype.push.apply(g.value,t.data),L(),ge()},de=()=>{const e={id:Date.now(),label:`\u7B2C${g.value.length+1}\u7AE0`,description:"\u8282\u70B9\u5185\u5BB9\u63CF\u8FF0\u4FE1\u606F",children:[]};g.value.push(e)};function ue(e){f.value=!0,console.log("selectChaterGenerator"),d.value=e,d.value.email="zhangsan@example.com"}function pe(e){Q.value=!0,console.log("configAgent"),W.value=e;const t=e=="chapter"?"\u9009\u62E9\u5927\u7EB2\u751F\u6210\u4E13\u5458":"\u9009\u62E9\u5185\u5BB9\u751F\u6210\u4E13\u5458";e==="chapter"?B.value=r.value.chapterEditors.map(l=>l.id):e==="content"&&(B.value=r.value.contentEditors.map(l=>l.id)),H.value.handleOpendAgent(t,B.value)}function V(){Be(S.value).then(e=>{r.value=e.data,g.value=e.data.chapterTree||[],y("setCurrentSceneInfo",e.data);const t=r.value.genStatus;u.value=r.value.promptContent,t==0&&X.value&&r.value.promptContent&&Ne.confirm("\u68C0\u6D4B\u5230\u6570\u636E\u5206\u6790\u6307\u4EE4["+r.value.promptContent+"]\u662F\u5426\u6267\u884C\u5206\u6790\u89C4\u5212\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{Pe(S.value,1).then(l=>{d.value=r.value.businessProcessorEngineers[0],u.value=r.value.promptContent,G()})}).catch(()=>{console.log("\u7528\u6237\u53D6\u6D88\u4E86\u751F\u6210\u7AE0\u8282\u64CD\u4F5C")})})}const ge=()=>{const e=JSON.stringify(g.value,null,2);console.log(e),Oe(e,v.query.sceneId).then(t=>{_.$modal.msgSuccess("\u4FDD\u5B58\u6210\u529F"),V(),y("genChapterContentByAgent")})},ve=()=>{const e=JSON.stringify(g.value,null,2);saveChapter(e,v.query.sceneId).then(t=>{_.$modal.msgSuccess("\u4FDD\u5B58\u6210\u529F"),V()})},L=()=>{console.log("child method. "+k.value),k.value&&k.value.close(),y("closeShowDebugRunDialog")};return j({closeStreamDialog:L,handleGetScene:V,genStreamContentByMessage:ie,configAgent:pe}),be(()=>{console.log("sceneId = "+v.query.sceneId),V()}),(e,t)=>{const l=c("el-button"),h=c("el-tooltip"),N=c("el-avatar"),P=c("el-popconfirm"),me=c("el-tree"),_e=c("el-scrollbar"),T=c("el-card"),O=c("el-input"),R=c("el-form-item"),fe=c("el-form"),J=c("el-dialog"),he=c("el-col"),ye=c("el-row");return z(),M("div",null,[n(T,{class:"box-card",shadow:"never"},{header:a(()=>[s("div",qe,[s("div",Ge,[n(l,{type:"primary",size:"large",text:"",bg:"",onClick:t[0]||(t[0]=o=>ce())},{default:a(()=>[Le]),_:1}),Te,m(" "+x(r.value.sceneName)+" ",1),(z(!0),M(ke,null,Se(r.value.businessProcessorEngineers,(o,p)=>(z(),U(h,{key:p,class:"box-item",effect:"dark",content:o.roleName,placement:"top"},{default:a(()=>[s("span",Re,[s("img",{src:e.imagePathByPath(o.roleAvatar),onClick:D=>ue(o)},null,8,Je)])]),_:2},1032,["content"]))),128))]),s("span",null,[n(h,{class:"box-item",effect:"dark",content:"\u6DFB\u52A0\u7AE0\u8282",placement:"top"},{default:a(()=>[n(l,{type:"primary",text:"",bg:"",size:"large",onClick:de},{default:a(()=>[Me,m(" \xA0 \u6DFB\u52A0 ")]),_:1})]),_:1}),n(h,{class:"box-item",effect:"dark",content:"\u4FDD\u5B58\u7AE0\u8282",placement:"top"},{default:a(()=>[n(l,{type:"success",text:"",bg:"",size:"large",onClick:ve},{default:a(()=>[Ue,m(" \xA0 \u4FDD\u5B58 ")]),_:1})]),_:1})])])]),default:a(()=>[n(_e,{style:{height:"calc(100vh - 180px)"}},{default:a(()=>[s("div",je,[n(me,{data:g.value,"node-key":"id","default-expand-all":"",draggable:"","empty-text":F.value,"allow-drop":Y,"allow-drag":Z,onNodeClick:ee,onNodeContextmenu:te},{default:a(({node:o,data:p})=>[s("div",Fe,[s("div",He,[s("div",Ke,x(o.label),1),s("div",Qe,[s("span",We,x(p.description),1)])]),s("span",Xe,[p.chapterEditor?(z(),U(N,{key:0,size:20,src:e.imagePathByPath(p.chapterEditorAvatar),style:{"margin-right":"10px"}},null,8,["src"])):we("",!0),n(l,{type:"text",icon:"Plus",bg:"",size:"mini",onClick:q(D=>ne(p),["stop"])},null,8,["onClick"]),n(l,{type:"text",icon:"Edit",bg:"",size:"mini",onClick:q(D=>oe(o,p),["stop"])},null,8,["onClick"]),n(l,{type:"text",icon:"EditPen",bg:"",size:"mini",onClick:q(D=>ae(o,p),["stop"])},null,8,["onClick"]),n(P,{title:"\u786E\u8BA4\u8981\u5220\u9664\u7AE0\u8282\u4E48?",onConfirm:D=>le(o,p)},{reference:a(()=>[n(l,{type:"text",icon:"Delete",bg:"",size:"mini"})]),_:2},1032,["onConfirm"])])])]),_:1},8,["data","empty-text"])])]),_:1})]),_:1}),n(J,{title:"\u7F16\u8F91\u8282\u70B9",modelValue:C.value,"onUpdate:modelValue":t[5]||(t[5]=o=>C.value=o),width:"900px"},{default:a(()=>[n(fe,{"label-width":"80px",size:"large"},{default:a(()=>[n(R,{label:"\u8282\u70B9\u540D\u79F0"},{default:a(()=>[n(O,{modelValue:I.value,"onUpdate:modelValue":t[1]||(t[1]=o=>I.value=o),placeholder:"\u8BF7\u8F93\u5165\u8282\u70B9\u540D\u79F0"},null,8,["modelValue"])]),_:1}),n(R,{label:"\u8282\u70B9\u63CF\u8FF0"},{default:a(()=>[n(O,{type:"textarea",rows:5,resize:"none",modelValue:E.value,"onUpdate:modelValue":t[2]||(t[2]=o=>E.value=o),placeholder:"\u8BF7\u8F93\u5165\u8282\u70B9\u63CF\u8FF0"},null,8,["modelValue"])]),_:1})]),_:1}),s("div",Ye,[n(l,{onClick:t[3]||(t[3]=o=>C.value=!1)},{default:a(()=>[m("\u53D6 \u6D88")]),_:1}),n(l,{type:"primary",onClick:t[4]||(t[4]=o=>se())},{default:a(()=>[m("\u786E \u8BA4")]),_:1})])]),_:1},8,["modelValue"]),n(J,{title:"\u7531\u4EE5\u4E0B\u5DE5\u7A0B\u5E08\u751F\u6210\u5927\u7EB2",modelValue:f.value,"onUpdate:modelValue":t[9]||(t[9]=o=>f.value=o),width:"600px"},{default:a(()=>[n(T,{class:"person-card",shadow:"never"},{default:a(()=>[s("div",Ze,[s("div",null,[n(N,{size:60,src:e.imagePathByPath(d.value.roleAvatar)},null,8,["src"])]),s("div",null,[s("h2",et,x(d.value.roleName),1),n(ye,null,{default:a(()=>[n(he,{span:24},{default:a(()=>[s("div",tt,x(d.value.responsibilities),1)]),_:1})]),_:1})])])]),_:1}),n(O,{size:"large",modelValue:u.value,"onUpdate:modelValue":t[6]||(t[6]=o=>u.value=o),placeholder:"\u8BF7\u8F93\u51FA\u9488\u5BF9\u4E8E\u672C\u7AE0\u8282\u5185\u5BB9\u7684\u4E00\u4E9B\u81EA\u5B9A\u4E49\u8981\u6C42"},null,8,["modelValue"]),s("div",nt,[n(l,{size:"large",onClick:t[7]||(t[7]=o=>f.value=!1)},{default:a(()=>[m("\u53D6 \u6D88")]),_:1}),n(l,{size:"large",type:"primary",onClick:t[8]||(t[8]=o=>G())},{default:a(()=>[m("\u5F00\u59CB\u89C4\u5212")]),_:1})])]),_:1},8,["modelValue"])])}}},st=Ce(lt,[["__scopeId","data-v-4b8cdca7"]]);export{st as default};
