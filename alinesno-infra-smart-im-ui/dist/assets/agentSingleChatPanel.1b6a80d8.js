import{_ as Pe,r as g,o as Re,K as ee,Q as Be,a as p,C as De,D as He,u as d,b as r,c as _,e as i,d as a,w as l,H as oe,n as N,t as m,R as $e,F as ne,f as se,S,l as b,y,G as h,a6 as ze,N as Ue,E as te,L as Fe,p as Ne,i as Ve,J as Ee}from"./index.d9d30be3.js";import{M as Me,H as V,m as Qe}from"./index.23422e4c.js";import Ge from"./rightPanel.96f45fe5.js";import{C as Oe,U as Je,a as Ke,A as je}from"./userQuestionSuggestionsPanel.cb0efdab.js";import{g as We,p as qe,c as Xe}from"./roleChat.91ed275b.js";import{h as Ye,o as Ze}from"./chatsse.0657b2ca.js";import{s as eo}from"./speaking.fcefe2d3.js";import oo from"./chatMessageEditor.d2d25d40.js";import{S as no}from"./snowflake-id.35ef5390.js";import"./index.79cc8ea8.js";/* empty css                                                                          */const I=T=>(Ne("data-v-0ddbba35"),T=T(),Ve(),T),so=["element-loading-spinner"],to={class:"smart-container inner-smart-container"},ao={class:"robot-chat-windows"},lo={class:"robot-chat-header"},io={class:"chat-header-title"},ro={class:"chat-header-desc"},co={class:"chat-header-desc",style:{float:"right","margin-top":"-10px"}},uo=I(()=>i("i",{class:"fa-solid fa-truck-fast icon-btn"},null,-1)),go=["onMouseover","onMouseleave"],ho={class:"header-images"},po=["src"],fo={key:0,class:"say-message-info"},_o={key:1,class:"say-message-info"},vo=["onClick"],yo={class:"chat-debugger"},ko={class:"chat-debugger-item"},bo={key:0,class:"chat-debugger-content"},mo=["innerHTML"],xo=["innerHTML"],Co=["innerHTML"],So=["innerHTML"],To=["src"],wo={class:"robot-chat-footer chat-container robot-chat-attachement-panel"},Lo={class:"message-chat-container"},Ao={class:"message-input-box"},Io={class:"message-input"},Po={class:"message-btn-box"},Ro=I(()=>i("i",{class:"fa-solid fa-feather icon-btn"},null,-1)),Bo=I(()=>i("i",{class:"fa-solid fa-file-word icon-btn"},null,-1)),Do=I(()=>i("div",{class:"aigen-text-warning"}," \u5185\u5BB9\u7531\u7B2C\u4E09\u65B9 AI \u751F\u6210\uFF0C\u65E0\u6CD5\u786E\u4FDD\u771F\u5B9E\u51C6\u786E\uFF0C\u4EC5\u4F9B\u53C2\u8003 ",-1)),Ho={__name:"agentSingleChatPanel",setup(T){const ae=new no,P=g(ae.generate()),{proxy:E}=Ee(),M=g(null),le=g(null),w=g(null),L=g(218),Q=g(!0),R=g(null),A=g(null),k=g({}),f=g(""),B=g(null),D=g(!1),G=g(null),O=g(null),u=g([]),ie=g(null),J=g(null),x=g(!1),H=new Me({html:!0,linkify:!0,highlight(e,o){if(!!(o&&V.getLanguage(o))){const c=o||"";return K(V.highlight(e,{language:c}).value,c)}return K(V.highlightAuto(e).value,"")}});H.use(Qe,{blockClass:"katexmath-block rounded-md p-[10px]",errorColor:" #cc0000"});function $(){N(()=>{const o=G.value.scrollHeight;O.value.setScrollTop(o)})}function K(e,o){return`<pre class="code-block-wrapper"><code class="hljs code-block-body ${o}">${e}</code></pre>`}function re(e){!f.value||(C("send"),f.value="")}function j(e){f.value=e,C("send"),f.value=""}function W(e){return H.render(e)}const ce=()=>{let e={};k.value.uploadData&&(e=JSON.parse(k.value.uploadData)),w.value.openFileSelector(e)};function q(e){if(e)return H.render(e)}const z=e=>{if(console.log(`--->>> newMessage = ${JSON.stringify(e)}`),e.llmStream===!0){const o=u.value.findIndex(s=>s.businessId===e.businessId);if(o!==-1){u.value[o].reasoningText+=e.reasoningText,u.value[o].chatText+=e.chatText,u.value[o].messageId=e.messageId,e.usage&&(u.value[o].usage=e.usage);const s=u.value[o];if(e.flowStep){const c=s.flowStepArr.findIndex(v=>v.stepId===e.flowStep.stepId);console.log("existingStepIdIndex = "+c),c!==-1?(u.value[o].flowStepArr[c].status=e.flowStep.status,u.value[o].flowStepArr[c].isPrint=e.flowStep.print,u.value[o].flowStepArr[c].flowChatText+=e.flowStep.flowChatText,u.value[o].flowStepArr[c].flowReasoningText+=e.flowStep.flowReasoningText,console.log("flow chat text = "+u.value[o].flowStepArr[c].flowChatText)):u.value[o].flowStepArr.push(e.flowStep)}}else e.flowStep&&e.flowStepArr.push(e.flowStep),u.value.push(e)}else u.value.push(e);$()};function de(e){const o=" #"+e.messageId+" ";B.value=e.messageId,f.value+=o,C("function")}const ue=(e,o)=>{console.log("handleShowDebuggerContent messageIndex = "+e+" , stepIndex = "+o),u.value[e].flowStepArr[o].isPrint=!u.value[e].flowStepArr[o].isPrint};function ge(e){N(()=>{if(e){let o=Ze(e);o.onmessage=function(s){if(s.data.includes("[DONE]"))s.data.includes("[DONE]")&&(console.log("\u6D88\u606F\u63A5\u6536\u7ED3\u675F."),x.value=!1);else{let c=s.data;if(c!="ping"){const v=JSON.parse(c);z(v)}}}}})}function he(e){const o=" #"+e.messageId+" ";B.value=e.messageId,f.value+=o}function pe(e){const o={id:e.fileId,name:e.fileName,extension:e.fileType};w.value.setReferenceFile(o)}function fe(e){We(e).then(o=>{let s=o.role,c=o.message;k.value=s,z(c),Q.value=!1,N(()=>{M.value.setRoleInfo(s)})})}const _e=e=>{console.log("heightVal = "+e),e>0?L.value=e-42:L.value=260-42,console.log("heightDiff.value = "+L.value)},ve=e=>{if(!k.value.voicePlayStatus){te.error("\u672A\u5F00\u542F\u8BED\u97F3\u64AD\u653E");return}e.getSpeechLoading=!0,qe(e).then(o=>{const s=new Blob([o],{type:"audio/wav"}),c=URL.createObjectURL(s),v=new Audio(c);v.addEventListener("ended",()=>{console.log("\u97F3\u9891\u64AD\u653E\u5B8C\u6210"),e.isPlaySpeaking=!1}),e.getSpeechLoading=!1,e.isPlaySpeaking=!0,v.play()}).catch(o=>{e.getSpeechLoading=!1,te.error("\u64AD\u653E\u5931\u8D25\uFF0C\u8BF7\u786E\u8BA4\u662F\u5426\u914D\u7F6E\u8BED\u97F3\u670D\u52A1")})},C=e=>{const o=w.value.handleGetUploadFiles();if(console.log("handleGetUploadFiles = "+o),!f.value){E.$modal.msgError("\u8BF7\u8F93\u5165\u6D88\u606F\u5185\u5BB9.");return}x.value=!0;let s={channelId:A.value,channelStreamId:P.value,message:f.value,businessIds:[B.value],type:e,fileIds:o};Xe(s,R.value).then(c=>{E.$modal.msgSuccess("\u53D1\u9001\u6210\u529F"),z(c.data)}).catch(c=>{J.value.close()}),f.value=""},ye=async e=>{try{x.value=!0,f.value=e,J.value.close(),C("send")}catch(o){console.error("\u8BED\u97F3\u8BC6\u522B\u8BF7\u6C42\u5931\u8D25:",o),x.value=!1}};function ke(e){u.value.forEach(o=>{o.showTools=o===e})}function be(e){e.showTools=!1}return Re(()=>{$(),R.value=ee("roleId"),A.value=ee("channelId"),ge(P.value),fe(R.value)}),Be(()=>{Ye(P.value).then(e=>{console.log("\u5173\u95EDsse\u8FDE\u63A5\u6210\u529F:"+A)})}),(e,o)=>{const s=p("el-button"),c=p("Loading"),v=p("el-icon"),me=p("CircleCheck"),xe=p("ArrowRightBold"),Ce=p("ArrowDownBold"),X=p("el-collapse-transition"),Se=p("el-scrollbar"),Te=p("el-input"),we=p("svg-icon"),U=p("el-tooltip"),Y=p("el-col"),Le=p("el-row"),Ae=p("el-dialog"),Ie=De("loading");return He((r(),_("div",{class:"acp-dashboard aip-chat-dashboard-panel","element-loading-text":"Loading...","element-loading-spinner":e.svg,"element-loading-svg-view-box":"-10, -10, 50, 50",style:{padding:"0px !important"}},[i("div",to,[a(Le,null,{default:l(()=>[a(Y,{span:19},{default:l(()=>[i("div",ao,[i("div",lo,[i("div",io,m(d(k).roleName),1),i("div",ro," ("+m(e.truncateString(d(k).responsibilities,60))+") ",1),i("div",co,[a(s,{type:"primary",text:"",bg:"",size:"large",onClick:o[0]||(o[0]=n=>e.taskFlowDialogVisible=!0)},{default:l(()=>[uo]),_:1})])]),i("div",{class:"robot-chat-body inner-robot-chat-body",style:$e("height:calc(100vh - "+d(L)+"px)")},[a(Se,{class:"scroll-panel",ref_key:"scrollbarRef",ref:O,loading:"",always:"","wrap-style":"padding:10px"},{default:l(()=>[i("div",{ref_key:"innerRef",ref:G},[(r(!0),_(ne,null,se(d(u),(n,F)=>(r(),_("div",{class:"robot-chat-ai-say-box",onMouseover:t=>ke(n),onMouseleave:t=>be(n),key:F},[i("div",{class:S(["chat-ai-header",n.roleType=="person"?"say-right-window":""])},[i("div",ho,[i("img",{src:e.imagePath(n)},null,8,po)])],2),i("div",{class:S(["chat-ai-say-body",n.roleType=="person"?"say-right-window":""]),style:{"max-width":"calc(100% - 135px)"}},[n.roleType=="person"?(r(),_("div",fo,[i("span",{style:{"margin-left":"10px"},class:S(n.showTools?"show-tools":"hide-tools")},m(n.dateTime),3),b(" "+m(n.name),1)])):(r(),_("div",_o,[b(m(n.name)+" ",1),n.loading?(r(),y(s,{key:0,size:"default",type:"primary",loading:"",text:""},{default:l(()=>[b("\u4EFB\u52A1\u5904\u7406\u4E2D")]),_:1})):h("",!0),n.reasoningText&&!n.chatText?(r(),y(s,{key:1,size:"default",type:"primary",loading:"",text:""},{default:l(()=>[b("\u63A8\u7406\u4E2D")]),_:1})):h("",!0),i("span",{style:{"margin-left":"10px"},class:S(n.showTools?"show-tools":"hide-tools")},m(n.dateTime),3)])),a(d(Oe),{message:n,onHandleFileIdToMessageBox:pe},null,8,["message"]),(r(!0),_(ne,null,se(n.flowStepArr,(t,Z)=>(r(),_("div",{class:"chat-debugger-box",onClick:$o=>ue(F,Z),key:Z},[i("div",yo,[i("div",ko,[(t==null?void 0:t.status)==="start"?(r(),y(v,{key:0,class:"is-loading"},{default:l(()=>[a(c)]),_:1})):h("",!0),(t==null?void 0:t.status)==="process"?(r(),y(v,{key:1,class:"is-loading"},{default:l(()=>[a(c)]),_:1})):h("",!0),(t==null?void 0:t.status)==="finish"?(r(),y(v,{key:2},{default:l(()=>[a(me)]),_:1})):h("",!0),b(" "+m(t.message)+" ",1),a(X,null,{default:l(()=>[!t.isPrint&&(t==null?void 0:t.flowChatText)?(r(),y(v,{key:0},{default:l(()=>[a(xe)]),_:1})):h("",!0),t.isPrint?(r(),y(v,{key:1},{default:l(()=>[a(Ce)]),_:1})):h("",!0)]),_:2},1024)]),a(X,null,{default:l(()=>[t.isPrint?(r(),_("div",bo,[t.flowReasoningText?(r(),_("div",{key:0,class:"say-message-body markdown-body chat-reasoning",innerHTML:q(t.flowReasoningText)},null,8,mo)):h("",!0),t.flowChatText?(r(),_("div",{key:1,class:"say-message-body markdown-body",innerHTML:W(t.flowChatText)},null,8,xo)):h("",!0)])):h("",!0)]),_:2},1024)])],8,vo))),128)),n.reasoningText?(r(),_("div",{key:2,class:"say-message-body markdown-body chat-reasoning",innerHTML:q(n.reasoningText)},null,8,Co)):h("",!0),n.chatText?(r(),_("div",{key:3,class:"say-message-body markdown-body",innerHTML:W(n.chatText)},null,8,So)):h("",!0),i("div",{class:S(["chat-ai-say-tools",n.roleType=="agent"&&n.chatText&&(n.showTools||n.isPlaySpeaking||n.getSpeechLoading)?"show-tools":"hide-tools"])},[n.isPlaySpeaking?(r(),_("img",{key:0,src:d(eo),style:{width:"25px","margin-right":"10px",cursor:"pointer"}},null,8,To)):h("",!0),!n.isPlaySpeaking&&d(k).voicePlayStatus?(r(),y(s,{key:1,type:"info",link:"",icon:"Headset",size:"small",onClick:t=>ve(n),loading:n.getSpeechLoading},{default:l(()=>[b("\u64AD\u653E")]),_:2},1032,["onClick","loading"])):h("",!0),a(s,{type:"info",link:"",icon:"Position",size:"small",onClick:t=>he(n)},{default:l(()=>[b("\u5F15\u7528")]),_:2},1032,["onClick"]),a(s,{type:"info",link:"",icon:"CopyDocument",size:"small",onClick:t=>d(ze)(n)},{default:l(()=>[b("\u590D\u5236")]),_:2},1032,["onClick"]),n.messageId&&n.roleId&&d(k).functionCallbackScript?(r(),y(s,{key:2,type:"info",size:"small",link:"",icon:"Promotion",onClick:t=>de(n)},{default:l(()=>[b("\u6267\u884C")]),_:2},1032,["onClick"])):h("",!0)],2),n.roleType=="agent"&&F==d(u).length-1?(r(),y(d(Je),{key:4,ref_for:!0,ref_key:"userQuestionSuggestionsRef",ref:le,onHandleUserQuestionSuggestionsClick:j,onInitChatBoxScroll:$,roleId:n.roleId,channelId:d(A),greetingQuestion:n.greetingQuestion,chatStreamLoading:d(x)},null,8,["roleId","channelId","greetingQuestion","chatStreamLoading"])):h("",!0)],2)],40,go))),128))],512)]),_:1},512)],4),i("div",wo,[a(d(Ke),{onUpdateChatWindowHeight:_e,onSendAttachmentActions:j,ref_key:"attachmentPanelRef",ref:w},null,512),i("div",Lo,[i("div",Ao,[i("div",Io,[a(Te,{class:"input-chat-box",onKeydown:Ue(Fe(re,["ctrl","prevent"]),["enter"]),modelValue:d(f),"onUpdate:modelValue":o[1]||(o[1]=n=>oe(f)?f.value=n:null),options:e.mentionOptions,prefix:["@"],placeholder:"\u8BF7\u8F93\u5165\u4F60\u7684\u95EE\u9898.",onSelect:e.handleSelect},{label:l(({item:n})=>[b(m(n.label),1)]),_:1},8,["onKeydown","modelValue","options","onSelect"])])]),i("div",Po,[d(k).voiceInputStatus?(r(),y(d(je),{key:0,onSendAudioToBackend:ye,role:d(k)},null,8,["role"])):h("",!0),a(U,{class:"box-item",effect:"dark",content:"\u786E\u8BA4\u53D1\u9001\u6307\u4EE4\u7ED9Agent\uFF0C\u5FEB\u6377\u952E\uFF1AEnter+Ctrl",placement:"top"},{default:l(()=>[a(s,{type:"danger",loading:d(x),text:"",bg:"",size:"large",onClick:o[2]||(o[2]=n=>C("send"))},{default:l(()=>[a(we,{"icon-class":"send",class:"icon-btn",style:{"font-size":"25px"}})]),_:1},8,["loading"])]),_:1}),a(U,{class:"box-item",effect:"dark",content:"\u6267\u884C\u4EFB\u52A1",placement:"top"},{default:l(()=>[a(s,{type:"warning",text:"",bg:"",size:"large",onClick:o[3]||(o[3]=n=>C("function"))},{default:l(()=>[Ro]),_:1})]),_:1}),d(k).uploadStatus?(r(),y(U,{key:1,class:"box-item",effect:"dark",content:"\u4E0A\u4F20\u6587\u6863\u6587\u4EF6",placement:"top"},{default:l(()=>[a(s,{type:"primary",text:"",bg:"",size:"large",onClick:ce},{default:l(()=>[Bo]),_:1})]),_:1})):h("",!0)])])]),Do])]),_:1}),a(Y,{span:5},{default:l(()=>[a(Ge,{ref_key:"agentSingleRightPanelRef",ref:M},null,512)]),_:1})]),_:1})]),a(Ae,{modelValue:d(D),"onUpdate:modelValue":o[4]||(o[4]=n=>oe(D)?D.value=n:null),title:"\u4EFB\u52A1\u5185\u5BB9\u7F16\u8F91",width:"60%","destroy-on-close":"","append-to-body":""},{default:l(()=>[a(oo,{businessId:d(ie)},null,8,["businessId"])]),_:1},8,["modelValue"])],8,so)),[[Ie,d(Q)]])}}},Ko=Pe(Ho,[["__scopeId","data-v-0ddbba35"]]);export{Ko as default};
