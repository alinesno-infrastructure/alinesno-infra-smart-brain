import{_ as j,r as d,B as E,o as G,K as O,a as v,b as Q,c as Z,e as s,d as c,u as f,L as $,w as m,M as ee,N as te,l as x,t as oe,p as ne,i as se,J as le,I as ie}from"./index.d9d30be3.js";import{m as ae,o as re,E as ce,s as ue}from"./index.79cc8ea8.js";import{p as de}from"./longText.4d182a25.js";const g=w=>(ne("data-v-9bf5d7e0"),w=w(),se(),w),me={class:"cm-container"},pe=g(()=>s("p",null,"\u8BF7\u8F93\u5165\u60A8\u7684\u8981\u6C42\uFF1A",-1)),fe=g(()=>s("i",{class:"fa-solid fa-file-pen"},null,-1)),ge=g(()=>s("i",{class:"fa-solid fa-pen-nib"},null,-1)),_e=g(()=>s("i",{class:"fa-solid fa-marker"},null,-1)),he={class:"confimation-text-panel"},ve=g(()=>s("p",null,"\u4EE5\u4E0B\u4E3A\u65B0\u7684\u5185\u5BB9:",-1)),xe={style:{height:"150px"}},we=g(()=>s("br",null,null,-1)),ye={slot:"footer",class:"dialog-footer"},be={__name:"chapterEditor",props:{businessId:{type:String,default:null}},setup(w,{expose:D}){const R=d(null),k=d(null),B=ae(),{proxy:W}=le(),H={"&":{fontSize:"10.5pt"}},_=d(""),I=d(""),h=E({userRequirement:""}),L=E({userRequirement:[{required:!0,message:"\u8BF7\u8F93\u5165\u8981\u6C42",trigger:"blur"},{pattern:/^\S+.*$/,message:"\u4E0D\u80FD\u5168\u4E3A\u7A7A\u767D\u5B57\u7B26",trigger:"blur"}]}),S=d(null),U=(t,e)=>{t||(t="\u672A\u751F\u6210\u5185\u5BB9"),_.value=t,k.value=e!=null?e:"0",console.log("data.value  = "+_.value+" , chapterEditor = "+k.value)},K=()=>_.value,N=t=>{console.log("this is a test:"+t)};let q=d(null),i=null;const M=d(!1),y=d(""),T=async({text:t,from:e,to:n,viewUpdate:a},o,u)=>{try{const r=await A(t,a,o,e,n,u);y.value=`${r}`,M.value=!0}catch(r){console.error("\u5904\u7406\u6587\u672C\u65F6\u53D1\u751F\u9519\u8BEF:",r)}},A=async(t,e,n,a,o,u)=>{const r=ie.service({lock:!0,text:"\u6B63\u5728\u91CD\u5199\u4E2D...",background:"rgba(0, 0, 0, 0.2)"});let l={roleId:k.value,sceneId:R.value,modifyContent:t,action:n,requirement:u},p="";return await de(l).then(V=>{V.data&&(p=V.data),r.close()}).catch(V=>{r.close()}),p},P=(t,e,n,a)=>{if(!e){console.error("editorView is undefined");return}console.log("new text = "+t);const o={changes:{from:n,to:a,insert:t}};e.dispatch(o)},z=t=>{var n;b();const e=(n=q.value)==null?void 0:n.view;if(e){const a=e.state.sliceDoc(e.state.selection.main.from,e.state.selection.main.to);if(a.trim()){i={text:a,from:e.state.selection.main.from,to:e.state.selection.main.to,editorView:e};const o=document.getElementById("custom-context-menu"),u=500,r=468;let l=t.pageX,p=t.pageY+10;l+u>window.innerWidth&&(l-=u),p+r>window.innerHeight&&(p-=r),console.log("window.innerWidth = "+window.innerWidth+" left + menuWidth = "+(l+u)),console.log("window.innerHeight = "+window.innerHeight+" top + menuHeight = "+(p+r)),o.style.left=`${l}px`,o.style.top=`${p}px`,o.classList.remove("hidden"),h.userRequirement="",y.value=""}}},b=()=>{document.getElementById("custom-context-menu").classList.add("hidden")},F=t=>{document.getElementById("custom-context-menu").contains(t.target)||b()},C=t=>{S.value.validate(e=>{if(e)J(t);else return console.log("\u6821\u9A8C\u5931\u8D25"),!1})},J=async t=>{console.log("currentSelection.text:"+i.text),console.log("currentSelection.viewUpdate:"+i.viewUpdate),i&&i.text.trim()&&await T(i,t,h.userRequirement)},X=()=>{const t=y.value;if(t==""){W.$modal.msgWarning("\u66FF\u6362\u5185\u5BB9\u4E3A\u7A7A.");return}const e=i.editorView,n=i.from,a=i.to,o=e.state.doc.length;if(n<0||a<0||n>o||a>o){console.error("Selection range is out of document bounds");return}P(t,i.editorView,i.from,i.to),i={text:t,from:n,to:n+t.length,editorView:e},M.value=!1,b()};G(()=>{R.value=O("sceneId")});const Y=[re,ce.lineWrapping];return D({setData:U,getData:K}),(t,e)=>{const n=v("el-form-item"),a=v("el-form"),o=v("el-button"),u=v("el-divider"),r=v("el-scrollbar");return Q(),Z("div",{style:{width:"100%"},onClick:F},[s("div",me,[c(f(ue),{ref_key:"editorRef",ref:q,basic:"",lang:f(B),modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=l=>_.value=l),onChange:N,extensions:Y,style:{height:"calc( 100vh - 250px)"},theme:H,onContextmenu:$(z,["prevent"])},null,8,["lang","modelValue","onContextmenu"])]),s("div",{id:"custom-context-menu",class:"hidden",onClick:e[6]||(e[6]=$(()=>{},["stop"]))},[pe,c(a,{style:{width:"100%"},model:f(h),rules:f(L),ref_key:"formRef",ref:S},{default:m(()=>[c(n,{prop:"userRequirement"},{default:m(()=>[c(f(ee),{modelValue:f(h).userRequirement,"onUpdate:modelValue":e[1]||(e[1]=l=>f(h).userRequirement=l),placeholder:"\u8BF7\u8F93\u5165\u8981\u6C42 ...",clearable:"",onKeyup:te(C,["enter"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1},8,["model","rules"]),s("ul",null,[s("li",{onClick:e[2]||(e[2]=l=>{I.value="rewrite",C("rewrite")})},[c(o,{type:"primary",text:"",bg:""},{default:m(()=>[fe,x(" \u91CD\u5199")]),_:1})]),s("li",{onClick:e[3]||(e[3]=l=>{I.value="polish",C("polish")})},[c(o,{type:"primary",text:"",bg:""},{default:m(()=>[ge,x(" \u6DA6\u8272")]),_:1})]),s("li",{onClick:e[4]||(e[4]=l=>{I.value="expand",C("expand")})},[c(o,{type:"primary",text:"",bg:""},{default:m(()=>[_e,x(" \u6269\u5199")]),_:1})])]),s("div",he,[c(u),ve,c(r,{height:"150px"},{default:m(()=>[s("p",xe,oe(y.value),1)]),_:1}),we,s("span",ye,[c(o,{onClick:e[5]||(e[5]=l=>b()),text:"",bg:""},{default:m(()=>[x("\u53D6 \u6D88")]),_:1}),c(o,{type:"primary",text:"",bg:"",onClick:X},{default:m(()=>[x("\u786E\u8BA4\u66FF\u6362")]),_:1})])])])])}}},Ve=j(be,[["__scopeId","data-v-9bf5d7e0"]]);export{Ve as default};
