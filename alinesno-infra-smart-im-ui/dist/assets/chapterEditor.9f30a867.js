import{_ as G,r as d,B as $,o as Q,K as Z,a as h,b as ee,c as te,e as s,d as u,u as f,L as D,S as oe,w as m,M as ne,N as se,l as v,t as le,E as ie,p as ae,i as re,J as ce,I as ue}from"./index.d9d30be3.js";import{m as de,o as me,E as pe,s as fe}from"./index.79cc8ea8.js";import{p as ge}from"./longText.4d182a25.js";const g=x=>(ae("data-v-08a8e5a4"),x=x(),re(),x),_e=g(()=>s("p",null,"\u8BF7\u8F93\u5165\u60A8\u7684\u8981\u6C42\uFF1A",-1)),he=g(()=>s("i",{class:"fa-solid fa-file-pen"},null,-1)),ve=g(()=>s("i",{class:"fa-solid fa-pen-nib"},null,-1)),xe=g(()=>s("i",{class:"fa-solid fa-marker"},null,-1)),we={class:"confimation-text-panel"},ye=g(()=>s("p",null,"\u4EE5\u4E0B\u4E3A\u65B0\u7684\u5185\u5BB9:",-1)),be={style:{height:"150px"}},Ce=g(()=>s("br",null,null,-1)),ke={slot:"footer",class:"dialog-footer"},Ie={__name:"chapterEditor",props:{businessId:{type:String,default:null}},setup(x,{expose:B}){const R=d(null),M=d(null),W=de(),{proxy:H}=ce(),L={"&":{fontSize:"10.5pt"}},w=d(""),k=d(""),_=$({userRequirement:""}),U=$({userRequirement:[{required:!0,message:"\u8BF7\u8F93\u5165\u8981\u6C42",trigger:"blur"},{pattern:/^\S+.*$/,message:"\u4E0D\u80FD\u5168\u4E3A\u7A7A\u767D\u5B57\u7B26",trigger:"blur"}]}),q=d(null),A=(t,e)=>{t||(t="\u672A\u751F\u6210\u5185\u5BB9"),w.value=t,M.value=e!=null?e:"0"},K=()=>w.value,N=t=>{console.log("this is a test:"+t)};let I=d(null),i=null;const E=d(!1),y=d(""),V=d(null),T=async({text:t,from:e,to:n,viewUpdate:a},o,r)=>{try{const c=await z(t,a,o,e,n,r);y.value=`${c}`,E.value=!0}catch(c){console.error("\u5904\u7406\u6587\u672C\u65F6\u53D1\u751F\u9519\u8BEF:",c)}},z=async(t,e,n,a,o,r)=>{const c=ue.service({lock:!0,text:"\u6B63\u5728\u91CD\u5199\u4E2D...",background:"rgba(0, 0, 0, 0.2)"});let l={roleId:M.value,sceneId:R.value,modifyContent:t,action:n,requirement:r},p="";return await ge(l).then(S=>{S.data&&(p=S.data),c.close()}).catch(S=>{c.close()}),p},P=(t,e,n,a)=>{if(!e){console.error("editorView is undefined");return}console.log("new text = "+t);const o={changes:{from:n,to:a,insert:t}};e.dispatch(o)},F=t=>{var n;b();const e=(n=I.value)==null?void 0:n.view;if(e){const a=e.state.sliceDoc(e.state.selection.main.from,e.state.selection.main.to);if(a.trim()){i={text:a,from:e.state.selection.main.from,to:e.state.selection.main.to,editorView:e};const o=document.getElementById("custom-context-menu"),r=500,c=468;let l=t.pageX,p=t.pageY+10;l+r>window.innerWidth&&(l-=r),p+c>window.innerHeight&&(p-=c),console.log("window.innerWidth = "+window.innerWidth+" left + menuWidth = "+(l+r)),console.log("window.innerHeight = "+window.innerHeight+" top + menuHeight = "+(p+c)),o.style.left=`${l}px`,o.style.top=`${p}px`,o.classList.remove("hidden"),_.userRequirement="",y.value=""}}},b=()=>{document.getElementById("custom-context-menu").classList.add("hidden")},J=t=>{document.getElementById("custom-context-menu").contains(t.target)||b()},C=t=>{q.value.validate(e=>{if(e)O(t);else return console.log("\u6821\u9A8C\u5931\u8D25"),!1})},O=async t=>{console.log("currentSelection.text:"+i.text),console.log("currentSelection.viewUpdate:"+i.viewUpdate),i&&i.text.trim()&&await T(i,t,_.userRequirement)},X=()=>{const t=y.value;if(t==""){H.$modal.msgWarning("\u66FF\u6362\u5185\u5BB9\u4E3A\u7A7A.");return}const e=i.editorView,n=i.from,a=i.to,o=e.state.doc.length;if(n<0||a<0||n>o||a>o){console.error("Selection range is out of document bounds");return}P(t,i.editorView,i.from,i.to),i={text:t,from:n,to:n+t.length,editorView:e},E.value=!1,b()},Y=t=>{var n;V.value=!0;const e=(n=I.value)==null?void 0:n.view;if(e){const o=e.state.doc.toString().indexOf(t);if(o!==-1){const r=o+t.length;console.log("position = "+r),e.dispatch({selection:{anchor:r},scrollIntoView:!0})}else console.log("\u672A\u627E\u5230\u6307\u5B9A\u5B57\u7B26"),V.value=null,ie.warning("\u672A\u627E\u5230\u6307\u5B9A\u5B57\u7B26")}};Q(()=>{R.value=Z("sceneId")});const j=[me,pe.lineWrapping];return B({setData:A,getData:K,locateAfterText:Y}),(t,e)=>{const n=h("el-form-item"),a=h("el-form"),o=h("el-button"),r=h("el-divider"),c=h("el-scrollbar");return ee(),te("div",{style:{width:"100%"},onClick:J},[s("div",{class:oe(["cm-container content-formater-box",V.value?"find-text-locate":""])},[u(f(fe),{ref_key:"editorRef",ref:I,basic:"",lang:f(W),modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=l=>w.value=l),onChange:N,extensions:j,style:{height:"calc( 100vh - 120px)"},theme:L,onContextmenu:D(F,["prevent"])},null,8,["lang","modelValue","onContextmenu"])],2),s("div",{id:"custom-context-menu",class:"hidden",onClick:e[6]||(e[6]=D(()=>{},["stop"]))},[_e,u(a,{style:{width:"100%"},model:f(_),rules:f(U),ref_key:"formRef",ref:q},{default:m(()=>[u(n,{prop:"userRequirement"},{default:m(()=>[u(f(ne),{modelValue:f(_).userRequirement,"onUpdate:modelValue":e[1]||(e[1]=l=>f(_).userRequirement=l),placeholder:"\u8BF7\u8F93\u5165\u8981\u6C42 ...",clearable:"",onKeyup:se(C,["enter"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1},8,["model","rules"]),s("ul",null,[s("li",{onClick:e[2]||(e[2]=l=>{k.value="rewrite",C("rewrite")})},[u(o,{type:"primary",text:"",bg:""},{default:m(()=>[he,v(" \u91CD\u5199")]),_:1})]),s("li",{onClick:e[3]||(e[3]=l=>{k.value="polish",C("polish")})},[u(o,{type:"primary",text:"",bg:""},{default:m(()=>[ve,v(" \u6DA6\u8272")]),_:1})]),s("li",{onClick:e[4]||(e[4]=l=>{k.value="expand",C("expand")})},[u(o,{type:"primary",text:"",bg:""},{default:m(()=>[xe,v(" \u6269\u5199")]),_:1})])]),s("div",we,[u(r),ye,u(c,{height:"150px"},{default:m(()=>[s("p",be,le(y.value),1)]),_:1}),Ce,s("span",ke,[u(o,{onClick:e[5]||(e[5]=l=>b()),text:"",bg:""},{default:m(()=>[v("\u53D6 \u6D88")]),_:1}),u(o,{type:"primary",text:"",bg:"",onClick:X},{default:m(()=>[v("\u786E\u8BA4\u66FF\u6362")]),_:1})])])])])}}},Me=G(Ie,[["__scopeId","data-v-08a8e5a4"]]);export{Me as default};
