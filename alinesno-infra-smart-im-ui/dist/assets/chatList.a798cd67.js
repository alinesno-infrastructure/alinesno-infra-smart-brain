import{M as X,H as C,m as Y}from"./index.23422e4c.js";import{p as Z}from"./roleChat.91ed275b.js";import{s as ee}from"./speaking.fcefe2d3.js";import{_ as se,a8 as oe,r as x,a as y,b as t,y as h,w as i,e as g,c as d,F as E,f as $,S as f,t as k,l as p,G as c,d as _,u as z,a6 as ne,n as ae,E as te}from"./index.d9d30be3.js";const le=["onMouseover","onMouseleave"],re={class:"header-images"},ie=["src"],ce={key:0,class:"say-message-info"},de={key:1,class:"say-message-info"},ue=["onClick"],he={class:"chat-debugger"},ge={class:"chat-debugger-item"},pe={key:0,class:"chat-debugger-content"},_e=["innerHTML"],ye=["innerHTML"],fe=["innerHTML"],ke=["innerHTML"],ve=["src"],xe={__name:"chatList",emits:["sendMessageToChatBox","handleEditorContent","executorMessage"],setup(Te,{expose:M,emit:v}){const L=oe();x(!1);const w=x(null),A=x(null),l=x([]),D=e=>{let s="";for(let r=0;r<e.length;r++){let a=e[r];a.type==="text"?s+='<span class="mention-text">'+a.text+"</span>":a.type==="mention"?s+='<span class="mention">'+("@"+a.username)+"</span>":a.type==="business"&&(s+='<span class="mention-business">'+("#"+a.businessId)+"</span>")}l.value.push({roleType:"person",businessId:"1733452663532019712",dateTime:"2023-12-11 16:32:10",readerType:"html",icon:L.avatar,name:L.nickName,date:"12-10 13:58:21",chatText:s}),T()},G=e=>{l.value=e,T()},N=e=>{if(e.llmStream===!0){const s=l.value.findIndex(r=>r.businessId===e.businessId);if(s!==-1){l.value[s].reasoningText+=e.reasoningText,l.value[s].chatText+=e.chatText,l.value[s].messageId=e.messageId;const r=l.value[s];if(e.flowStep){const a=r.flowStepArr.findIndex(u=>u.stepId===e.flowStep.stepId);console.log("existingStepIdIndex = "+a),a!==-1?(l.value[s].flowStepArr[a].status=e.flowStep.status,l.value[s].flowStepArr[a].isPrint=e.flowStep.print,l.value[s].flowStepArr[a].flowChatText+=e.flowStep.flowChatText,l.value[s].flowStepArr[a].flowReasoningText+=e.flowStep.flowReasoningText,console.log("flow chat text = "+l.value[s].flowStepArr[a].flowChatText)):l.value[s].flowStepArr.push(e.flowStep)}}else e.flowStep&&e.flowStepArr.push(e.flowStep),l.value.push(e)}else l.value.push(e);l.value.forEach(s=>{console.log("--->>> item = "+s),s.loading&&e.roleId==s.roleId&&e.status==="completed"&&(s.loading=!1)}),T()};function T(){ae(()=>{const s=w.value.scrollHeight;A.value.setScrollTop(s)})}const b=new X({html:!0,linkify:!0,highlight(e,s){if(!!(s&&C.getLanguage(s))){const a=s||"";return B(C.highlight(e,{language:a}).value,a)}return B(C.highlightAuto(e).value,"")}});b.use(Y,{blockClass:"katexmath-block rounded-md p-[10px]",errorColor:" #cc0000"});function B(e,s){return`<pre class="code-block-wrapper"><code class="hljs code-block-body ${s}">${e}</code></pre>`}function P(e){return b.render(e)}const U=(e,s)=>{console.log("handleShowDebuggerContent messageIndex = "+e+" , stepIndex = "+s),l.value[e].flowStepArr[s].isPrint=!l.value[e].flowStepArr[s].isPrint};function m(e){if(e)return b.render(e)}function V(e){const s=" #"+e.messageId+" ";v("sendMessageToChatBox",s),v("handleSelectPreBusinessId",e.messageId)}function j(e){const s=e.messageId+"";console.log("businessId = "+s),v("handleEditorContent",s)}const F=e=>{e.getSpeechLoading=!0,Z(e).then(s=>{const r=new Blob([s],{type:"audio/wav"}),a=URL.createObjectURL(r),u=new Audio(a);u.addEventListener("ended",()=>{console.log("\u97F3\u9891\u64AD\u653E\u5B8C\u6210"),e.isPlaySpeaking=!1}),e.getSpeechLoading=!1,e.isPlaySpeaking=!0,u.play()}).catch(s=>{e.getSpeechLoading=!1,te.error("\u64AD\u653E\u5931\u8D25\uFF0C\u8BF7\u786E\u8BA4\u662F\u5426\u914D\u7F6E\u8BED\u97F3\u670D\u52A1")})};function I(e){v("executorMessage",e)}function J(e){l.value.forEach(s=>{s.showTools=s===e})}function K(e){e.showTools=!1}return M({pushMessageList:D,currentResponseMessageList:G,pushResponseMessageList:N}),(e,s)=>{const r=y("el-button"),a=y("Loading"),u=y("el-icon"),O=y("CircleCheck"),q=y("ArrowRightBold"),Q=y("ArrowDownBold"),H=y("el-collapse-transition"),W=y("el-scrollbar");return t(),h(W,{class:"scroll-panel",ref_key:"scrollbarRef",ref:A,loading:"",always:"","wrap-style":"padding:10px"},{default:i(()=>[g("div",{ref_key:"innerRef",ref:w},[(t(!0),d(E,null,$(l.value,(o,R)=>(t(),d("div",{class:"robot-chat-ai-say-box",onMouseover:n=>J(o),onMouseleave:n=>K(o),key:R},[g("div",{class:f(["chat-ai-header",o.roleType=="person"?"say-right-window":""])},[g("div",re,[g("img",{src:e.imagePath(o)},null,8,ie)])],2),g("div",{class:f(["chat-ai-say-body",o.roleType=="person"?"say-right-window":""]),style:{"max-width":"calc(100% - 135px)"}},[o.roleType=="person"?(t(),d("div",ce,[g("span",{style:{"margin-left":"10px"},class:f(o.showTools?"show-tools":"hide-tools")},k(o.dateTime),3),p(" "+k(o.name),1)])):(t(),d("div",de,[p(k(o.name)+" ",1),o.loading?(t(),h(r,{key:0,size:"default",type:"primary",loading:"",text:""},{default:i(()=>[p("\u4EFB\u52A1\u5904\u7406\u4E2D")]),_:1})):c("",!0),o.reasoningText&&!o.chatText?(t(),h(r,{key:1,size:"default",type:"primary",loading:"",text:""},{default:i(()=>[p("\u63A8\u7406\u4E2D")]),_:1})):c("",!0),g("span",{style:{"margin-left":"10px"},class:f(o.showTools?"show-tools":"hide-tools")},k(o.dateTime),3)])),(t(!0),d(E,null,$(o.flowStepArr,(n,S)=>(t(),d("div",{class:"chat-debugger-box",onClick:be=>U(R,S),key:S},[g("div",he,[g("div",ge,[(n==null?void 0:n.status)==="start"?(t(),h(u,{key:0,class:"is-loading"},{default:i(()=>[_(a)]),_:1})):c("",!0),(n==null?void 0:n.status)==="process"?(t(),h(u,{key:1,class:"is-loading"},{default:i(()=>[_(a)]),_:1})):c("",!0),(n==null?void 0:n.status)==="finish"?(t(),h(u,{key:2},{default:i(()=>[_(O)]),_:1})):c("",!0),p(" "+k(n.message)+" ",1),_(H,null,{default:i(()=>[!n.isPrint&&(n==null?void 0:n.flowChatText)?(t(),h(u,{key:0},{default:i(()=>[_(q)]),_:1})):c("",!0),n.isPrint?(t(),h(u,{key:1},{default:i(()=>[_(Q)]),_:1})):c("",!0)]),_:2},1024)]),_(H,null,{default:i(()=>[n.isPrint?(t(),d("div",pe,[n.flowReasoningText?(t(),d("div",{key:0,class:"say-message-body markdown-body chat-reasoning",innerHTML:m(n.flowReasoningText)},null,8,_e)):c("",!0),n.flowChatText?(t(),d("div",{key:1,class:"say-message-body markdown-body",innerHTML:P(n.flowChatText)},null,8,ye)):c("",!0)])):c("",!0)]),_:2},1024)])],8,ue))),128)),o.reasoningText?(t(),d("div",{key:2,class:"say-message-body markdown-body chat-reasoning",innerHTML:m(o.reasoningText)},null,8,fe)):c("",!0),o.chatText?(t(),d("div",{key:3,class:"say-message-body markdown-body",innerHTML:P(o.chatText)},null,8,ke)):c("",!0),g("div",{class:f(["chat-ai-say-tools",o.roleType=="agent"&&o.chatText&&(o.showTools||o.isPlaySpeaking||o.getSpeechLoading)?"show-tools":"hide-tools"])},[o.isPlaySpeaking?(t(),d("img",{key:0,src:z(ee),style:{width:"25px","margin-right":"10px",cursor:"pointer"}},null,8,ve)):c("",!0),o.isPlaySpeaking?c("",!0):(t(),h(r,{key:1,type:"danger",link:"",icon:"Headset",size:"small",onClick:n=>F(o),loading:o.getSpeechLoading},{default:i(()=>[p("\u64AD\u653E")]),_:2},1032,["onClick","loading"])),_(r,{type:"primary",link:"",icon:"Position",size:"small",onClick:n=>V(o)},{default:i(()=>[p("\u5F15\u7528")]),_:2},1032,["onClick"]),_(r,{type:"primary",link:"",icon:"EditPen",size:"small",onClick:n=>j(o)},{default:i(()=>[p("\u67E5\u770B")]),_:2},1032,["onClick"]),_(r,{type:"info",link:"",icon:"CopyDocument",size:"small",onClick:n=>z(ne)(o)},{default:i(()=>[p("\u590D\u5236")]),_:2},1032,["onClick"]),o.messageId&&o.roleId?(t(),h(r,{key:2,type:"info",size:"small",link:"",icon:"Promotion",onClick:n=>I(o)},{default:i(()=>[p("\u6267\u884C")]),_:2},1032,["onClick"])):c("",!0)],2)],2)],40,le))),128))],512)]),_:1},512)}}},Be=se(xe,[["__scopeId","data-v-65f62e08"]]);export{Be as default};
