import{q as S,v as te,_ as ne,r as p,B as W,o as oe,K as se,n as ae,a as w,b as le,c as re,e as n,d as l,u as h,L as H,w as m,l as v,M as ie,N as ue,t as ce,p as de,i as me,J as pe,I as fe}from"./index.d9d30be3.js";import{m as ge,o as he,E as ve,s as _e}from"./index.79cc8ea8.js";/* empty css                                                                          */var R="/v1/api/infra/base/im/workflow/",V={detailUrl:R+"detail",updateContent:R+"updateContent",processParagraph:R+"processParagraph"};function xe(r){return S({url:V.detailUrl+"?messageId="+te(r),method:"get"})}function we(r){return S({url:V.updateContent,method:"post",headers:{isEncrypt:!0},data:r})}function ye(r){return S({url:V.processParagraph,headers:{isEncrypt:!0},method:"post",data:r})}const _=r=>(de("data-v-409f3941"),r=r(),me(),r),be={class:"cm-container"},Ce={class:"submit-button-group"},ke=_(()=>n("p",null,"\u8BF7\u8F93\u5165\u60A8\u7684\u8981\u6C42\uFF1A",-1)),Ie=_(()=>n("i",{class:"fa-solid fa-file-pen"},null,-1)),Me=_(()=>n("i",{class:"fa-solid fa-pen-nib"},null,-1)),Re=_(()=>n("i",{class:"fa-solid fa-marker"},null,-1)),Se={class:"confimation-text-panel"},Ve=_(()=>n("p",null,"\u4EE5\u4E0B\u4E3A\u65B0\u7684\u5185\u5BB9:",-1)),qe={style:{height:"150px"}},Ee=_(()=>n("br",null,null,-1)),$e={slot:"footer",class:"dialog-footer"},De={__name:"chatMessageEditor",props:{businessId:{type:String,default:null}},setup(r,{expose:P}){const q=r,E=p(null),y=p(null),K=ge(),{proxy:$}=pe(),L={"&":{fontSize:"10.5pt"}},f=p(""),I=p(""),x=W({userRequirement:""}),N=W({userRequirement:[{required:!0,message:"\u8BF7\u8F93\u5165\u8981\u6C42",trigger:"blur"},{pattern:/^\S+.*$/,message:"\u4E0D\u80FD\u5168\u4E3A\u7A7A\u767D\u5B57\u7B26",trigger:"blur"}]}),D=p(null),T=(t,e)=>{f.value=t!=null?t:"\u672A\u751F\u6210\u5185\u5BB9.",y.value=e!=null?e:"0",console.log("data.value  = "+f.value+" , chapterEditor = "+y.value)},z=()=>f.value,A=t=>{console.log("this is a test:"+t)};let U=p(null),u=null;const B=p(!1),b=p(""),F=async({text:t,from:e,to:o,viewUpdate:c},i,d)=>{try{const a=await G(t,c,i,e,o,d);b.value=`${a}`,B.value=!0}catch(a){console.error("\u5904\u7406\u6587\u672C\u65F6\u53D1\u751F\u9519\u8BEF:",a)}},G=async(t,e,o,c,i,d)=>{const a=fe.service({lock:!0,text:"\u6B63\u5728\u91CD\u5199\u4E2D...",background:"rgba(0, 0, 0, 0.2)"});let s={roleId:y.value,channelId:E.value,modifyContent:t,action:o,requirement:d},g="";return await ye(s).then(M=>{M.data&&(g=M.data),a.close()}).catch(M=>{a.close()}),g},J=(t,e,o,c)=>{if(!e){console.error("editorView is undefined");return}console.log("new text = "+t);const i={changes:{from:o,to:c,insert:t}};e.dispatch(i)},X=t=>{var o;C();const e=(o=U.value)==null?void 0:o.view;if(e){const c=e.state.sliceDoc(e.state.selection.main.from,e.state.selection.main.to);if(c.trim()){u={text:c,from:e.state.selection.main.from,to:e.state.selection.main.to,editorView:e};const i=document.getElementById("custom-context-menu"),d=500,a=468;let s=t.pageX,g=t.pageY+10;s+d>window.innerWidth&&(s-=d),g+a>window.innerHeight&&(g-=a),console.log("window.innerWidth = "+window.innerWidth+" left + menuWidth = "+(s+d)),console.log("window.innerHeight = "+window.innerHeight+" top + menuHeight = "+(g+a)),i.style.left=`${s}px`,i.style.top=`${g}px`,i.classList.remove("hidden"),x.userRequirement="",b.value=""}}},C=()=>{document.getElementById("custom-context-menu").classList.add("hidden")},Y=t=>{document.getElementById("custom-context-menu").contains(t.target)||C()},k=t=>{D.value.validate(e=>{if(e)j(t);else return console.log("\u6821\u9A8C\u5931\u8D25"),!1})},j=async t=>{console.log("currentSelection.text:"+u.text),console.log("currentSelection.viewUpdate:"+u.viewUpdate),u&&u.text.trim()&&await F(u,t,x.userRequirement)},O=()=>{const t=b.value;if(t==""){$.$modal.msgWarning("\u66FF\u6362\u5185\u5BB9\u4E3A\u7A7A.");return}J(t,u.editorView,u.from,u.to),B.value=!1,C()};oe(()=>{E.value=se("channel")});const Q=[he,ve.lineWrapping];ae(()=>{Z()});const Z=()=>{xe(q.businessId).then(t=>{let e=t.data;y.value=e.roleId,f.value=e.content})},ee=()=>{let t={code:!1,content:f.value,businessId:q.businessId};we(t).then(e=>{$.$modal.msgSuccess("\u4FEE\u6539\u6210\u529F")})};return P({setData:T,getData:z}),(t,e)=>{const o=w("el-button"),c=w("el-form-item"),i=w("el-form"),d=w("el-divider"),a=w("el-scrollbar");return le(),re("div",{style:{width:"100%"},onClick:Y},[n("div",be,[l(h(_e),{ref_key:"editorRef",ref:U,basic:"",lang:h(K),modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=s=>f.value=s),onChange:A,extensions:Q,style:{height:"680px"},theme:L,onContextmenu:H(X,["prevent"])},null,8,["lang","modelValue","onContextmenu"]),n("div",Ce,[l(o,{type:"primary",size:"large",onClick:e[1]||(e[1]=s=>ee())},{default:m(()=>[v(" \u66F4\u65B0 ")]),_:1})])]),n("div",{id:"custom-context-menu",class:"hidden",onClick:e[7]||(e[7]=H(()=>{},["stop"]))},[ke,l(i,{style:{width:"100%"},model:h(x),rules:h(N),ref_key:"formRef",ref:D},{default:m(()=>[l(c,{prop:"userRequirement"},{default:m(()=>[l(h(ie),{modelValue:h(x).userRequirement,"onUpdate:modelValue":e[2]||(e[2]=s=>h(x).userRequirement=s),placeholder:"\u8BF7\u8F93\u5165\u8981\u6C42 ...",clearable:"",onKeyup:ue(k,["enter"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1},8,["model","rules"]),n("ul",null,[n("li",{onClick:e[3]||(e[3]=s=>{I.value="rewrite",k("rewrite")})},[l(o,{type:"primary",text:"",bg:""},{default:m(()=>[Ie,v(" \u91CD\u5199")]),_:1})]),n("li",{onClick:e[4]||(e[4]=s=>{I.value="polish",k("polish")})},[l(o,{type:"primary",text:"",bg:""},{default:m(()=>[Me,v(" \u6DA6\u8272")]),_:1})]),n("li",{onClick:e[5]||(e[5]=s=>{I.value="expand",k("expand")})},[l(o,{type:"primary",text:"",bg:""},{default:m(()=>[Re,v(" \u6269\u5199")]),_:1})])]),n("div",Se,[l(d),Ve,l(a,{height:"150px"},{default:m(()=>[n("p",qe,ce(b.value),1)]),_:1}),Ee,n("span",$e,[l(o,{onClick:e[6]||(e[6]=s=>C()),text:"",bg:""},{default:m(()=>[v("\u53D6 \u6D88")]),_:1}),l(o,{type:"primary",text:"",bg:"",onClick:O},{default:m(()=>[v("\u786E\u8BA4\u66FF\u6362")]),_:1})])])])])}}},He=ne(De,[["__scopeId","data-v-409f3941"]]);export{He as default};
