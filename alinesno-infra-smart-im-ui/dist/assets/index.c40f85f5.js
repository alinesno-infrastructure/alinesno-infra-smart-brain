import{_ as ve,r as d,B as ye,a as p,C as be,b as h,c as v,d as e,w as t,e as n,l as f,F as $,f as z,y as M,u as i,D as Ce,G as B,t as O,H as xe,g as ke,a2 as we,E as Se,a3 as Ie,n as Ne,a4 as Ve,I as Ee,a5 as Pe,p as De,i as Te,J as Ue}from"./index.d9d30be3.js";import $e from"./mediaOutlineEditor.3a630506.js";import"./user.9e8a1ab9.js";const b=x=>(De("data-v-8ead92a6"),x=x(),Te(),x),ze={class:"app-container",style:{"background-color":"#fff","padding-top":"10px","padding-left":"0px !important"}},Me={class:"chapter-edit"},Be={class:"card-header"},Oe={style:{display:"flex","align-items":"center",gap:"5px"}},Ae={class:"edit-header-avatar"},Re=["src","onClick"],Fe=b(()=>n("i",{class:"fa-solid fa-user-plus"},null,-1)),Ge=[Fe],Le=b(()=>n("i",{class:"fa-solid fa-ferry"},null,-1)),Ke=b(()=>n("i",{class:"fa-solid fa-file-word icon-btn"},null,-1)),Je=b(()=>n("i",{class:"fa-solid fa-floppy-disk"},null,-1)),je=b(()=>n("i",{class:"fa-solid fa-download"},null,-1)),qe=b(()=>n("i",{class:"fa-solid fa-pen-nib"},null,-1)),He={style:{"margin-bottom":"20px","text-align":"right"}},Qe={style:{width:"100%","text-align":"right"}},We={style:{display:"flex",width:"90%","flex-wrap":"wrap","justify-content":"flex-start","align-items":"center",gap:"10px","margin-top":"10px"}},Xe=["src"],Ye={style:{padding:"0px"}},Ze={key:0},et={class:"user-info"},tt=["src"],lt={class:"chapter-tree-content"},ot={class:"custom-tree-node",style:{height:"auto"}},at={style:{display:"flex","flex-direction":"column"}},nt={style:{"font-size":"16px","font-weight":"bold",color:"#333"}},st={class:"description"},it={style:{color:"#777"}},ct={style:{"margin-right":"10px",display:"flex","align-items":"center",gap:"5px"}},dt={class:"dialog-footer"},rt={__name:"index",setup(x){const H=ke(),{proxy:A}=Ue(),R=d([]),F=d(!1),G=d(""),y=d(!1),E=d(null),m=d(null),L=d({roleAvatar:"",roleName:"\u5F20\u4E09",responsibilities:"\u4E3B\u8981\u8D1F\u8D23\u4E0E\u5BA2\u6237\u8FDB\u884C\u6C9F\u901A\uFF0C\u89E3\u7B54\u5BA2\u6237\u5173\u4E8E\u4EA7\u54C1\u7684\u5404\u79CD\u7591\u95EE\uFF0C\u63D0\u4F9B\u4E13\u4E1A\u7684\u54A8\u8BE2\u670D\u52A1\uFF0C\u4EE5\u5E2E\u52A9\u5BA2\u6237\u66F4\u597D\u5730\u7406\u89E3\u548C\u4F7F\u7528\u4EA7",email:"zhangsan@example.com"}),P=d(null),K=d(null),D=d(null),J=d(null),k=d(null),w=d(H.query.screenId),T=d(0),c=ye({id:0,titles:[""],title:"",content:""}),S=d([]),I=d([{cover:"http://training-static.linesno.com/public/2024-12-29/67706f8de4b03e1aaa099357.png"},{cover:"http://training-static.linesno.com/public/2024-12-18/676299eee4b03e1aaa09931c.png"}]);d(""),d(!1);const Q=()=>{I.value.push({cover:"http://training-static.linesno.com/public/2024-12-18/6761fcc6e4b03e1aaa0992f5.png"})},W=l=>{I.value.splice(l,1)},X=()=>{console.log("\u63D0\u4EA4\u7684\u6570\u636E:",c);let l={id:c.id,title:c.title,content:P.value.getData()};we(l).then(o=>{Se.success("\u4FDD\u5B58"+c.title+"\u6210\u529F\uFF01")})};function Y(){Ie(w.value).then(l=>{window.open(l.data)})}function Z(){K.value.handleOpenUpload(!0)}const ee=()=>{c.titles.push("")},te=l=>{c.titles.splice(l,1)};function le(){D.value.configAgent("content")}function oe(l){R.value=l,S.value=l.chapterTree}const ae=l=>{G.value="\u8BF7\u9009\u62E9["+l.roleName+"]\u9700\u8981\u7F16\u8F91\u7684\u7AE0\u8282",L.value=l,L.value.email="zhangsan@example.com",m.value=l,m.value.selectedChapters=[],y.value=!0,Ne(()=>{Ve(l.id,w.value).then(o=>{if(o.data){let s=o.data.map(a=>a.id);console.log("selectKey = "+s),E.value.setCheckedKeys(s)}})})},ne=async()=>{try{T.value=j(S.value),console.log("\u6587\u6863\u603B\u6570\u91CF = "+T.value);const l=[],o=s=>{for(let a of s)l.push(a),a.children&&a.children.length&&o(a.children)};o(S.value),k.value=Ee.service({lock:!0,background:"rgba(255, 255, 255, 0.5)",customClass:"custom-loading"});for(let s=0;s<l.length;s++){const a=l[s];console.log(`\u8282\u70B9 ${s+1}: ID = ${a.id}, Label = ${a.label}`);let C=` ${s+1}: \u7AE0\u8282:${a.label}`+" \u4EFB\u52A1\u751F\u6210\u4E2D\uFF0C\u8FD8\u6709\u3010"+(T.value-s)+"\u3011\u7BC7";k.value.setText(C),c.title=a.label;let g={screenId:w.value,chapterTitle:a.label,chapterDescription:a.description,chapterId:a.id};const N=await chatRoleSync(g);P.value.setData(N.data)}}catch(l){console.error("Error fetching data:",l),A.$modal.msgError("\u751F\u6210\u5931\u8D25"),k.value.close()}k.value.close()},j=l=>{let o=0;for(let s of l)o++,s.children&&s.children.length&&(o+=j(s.children));return o},se=()=>{J.value.openGlobalConfigPanel()},ie=(l,o)=>{console.log("node = "+l),console.log("data = "+o);let s=o.id;c.id=o.id,c.title=l.label,Pe(s).then(a=>{console.log("res = "+JSON.stringify(a)),P.value.setData(a.data),F.value=!1})},ce=()=>{const l=E.value.getCheckedNodes(!1,!0);console.log("newChapterIds= "+l);const o=l.map(a=>a.id);console.log("newChapterIds = "+o),m.value.selectedChapters=[...new Set([...m.value.selectedChapters,...o])],console.log("currentUser.value.selectedChapters="+m.value.selectedChapters);let s={screenId:w.value,roleId:m.value.id,chapters:m.value.selectedChapters};updateChapterContentEditor(s).then(a=>{console.log(a),A.$modal.msgSuccess("\u5206\u914D\u6210\u529F"),y.value=!1,D.value.handleGetScreen()})};return(l,o)=>{const s=p("el-col"),a=p("el-tooltip"),_=p("el-button"),C=p("el-input"),g=p("el-form-item"),N=p("el-row"),V=p("el-checkbox"),de=p("el-checkbox-group"),re=p("el-form"),q=p("el-scrollbar"),pe=p("el-card"),ue=p("el-avatar"),_e=p("el-tree"),fe=p("el-dialog"),he=p("ScreenUploadFile"),me=p("MediaGlobalConfigPanel"),ge=be("loading");return h(),v("div",ze,[e(N,null,{default:t(()=>[e(s,{span:10},{default:t(()=>[e($e,{ref_key:"OutlineEditorRef",ref:D,onSetCurrentScreenInfo:oe,onEditContent:ie},null,512)]),_:1}),e(s,{span:14,class:"miedia-editor-panel"},{default:t(()=>[n("div",Me,[e(pe,{class:"box-card",shadow:"never"},{header:t(()=>[n("div",Be,[n("div",Oe,[f(" \u955C\u5934\u7F16\u8F91 "),(h(!0),v($,null,z(i(R).contentEditors,(r,u)=>(h(),M(a,{key:u,class:"box-item",effect:"dark",content:r.roleName,placement:"top"},{default:t(()=>[n("span",Ae,[n("img",{src:l.imagePathByPath(r.roleAvatar),onClick:U=>ae(r)},null,8,Re)])]),_:2},1032,["content"]))),128)),e(a,{class:"box-item",effect:"dark",content:"\u6DFB\u52A0\u5185\u5BB9\u7F16\u5199\u4EBA\u5458",placement:"top"},{default:t(()=>[n("span",{class:"edit-header-avatar",onClick:o[0]||(o[0]=r=>le())},Ge)]),_:1})]),n("div",null,[e(a,{class:"box-item",effect:"dark",content:"\u6267\u884C\u6587\u6863\u751F\u6210",placement:"top"},{default:t(()=>[e(_,{type:"primary",text:"",bg:"",size:"large",onClick:o[1]||(o[1]=r=>ne())},{default:t(()=>[Le]),_:1})]),_:1}),e(a,{class:"box-item",effect:"dark",content:"\u4E0A\u4F20\u6587\u6863\u6587\u4EF6",placement:"top"},{default:t(()=>[e(_,{type:"danger",text:"",bg:"",size:"large",onClick:Z},{default:t(()=>[Ke]),_:1})]),_:1}),e(a,{class:"box-item",effect:"dark",content:"\u4FDD\u5B58\u7AE0\u8282",placement:"top"},{default:t(()=>[e(_,{type:"primary",text:"",bg:"",size:"large",onClick:X},{default:t(()=>[Je]),_:1})]),_:1}),e(a,{class:"box-item",effect:"dark",content:"\u5BFC\u51FA\u6587\u6863",placement:"top"},{default:t(()=>[e(_,{type:"primary",text:"",bg:"",size:"large",onClick:Y},{default:t(()=>[je]),_:1})]),_:1}),e(a,{class:"box-item",effect:"dark",content:"\u5168\u5C40\u914D\u7F6E",placement:"top"},{default:t(()=>[e(_,{type:"danger",text:"",bg:"",size:"large",onClick:se},{default:t(()=>[qe]),_:1})]),_:1})])])]),default:t(()=>[e(q,{style:{height:"calc(100vh - 180px)"}},{default:t(()=>[Ce((h(),M(re,{model:i(c),"label-width":"100px","label-position":"top"},{default:t(()=>[e(g,{label:"\u955C\u5934\u540D\u79F0"},{default:t(()=>[e(C,{modelValue:i(c).title,"onUpdate:modelValue":o[2]||(o[2]=r=>i(c).title=r),placeholder:"\u5728\u6267\u884C\u5F53\u4E2D\u7684\u7AE0\u8282\u540D\u79F0",style:{width:"50%"}},null,8,["modelValue"])]),_:1}),e(g,null,{default:t(()=>[e(N,{gutter:20,style:{width:"100%"}},{default:t(()=>[e(s,{span:24},{default:t(()=>[(h(!0),v($,null,z(i(c).titles,(r,u)=>(h(),v("div",{key:u,style:{"margin-bottom":"16px"}},[e(g,{label:u===0?"\u89C6\u9891\u53E3\u64AD\u5185\u5BB9":""},{default:t(()=>[e(C,{modelValue:i(c).titles[u],"onUpdate:modelValue":U=>i(c).titles[u]=U,style:{width:"calc(100% - 70px)"},placeholder:"\u8BF7\u8F93\u5165\u89C6\u9891\u53E3\u64AD\u5185\u5BB9"},null,8,["modelValue","onUpdate:modelValue"]),e(_,{type:"danger",onClick:U=>te(u),style:{"margin-left":"8px"},disabled:i(c).titles.length<=1},{default:t(()=>[f("\u5220\u9664")]),_:2},1032,["onClick","disabled"])]),_:2},1032,["label"])]))),128)),n("div",He,[e(_,{type:"primary",icon:"Plus",onClick:ee},{default:t(()=>[f("\u6DFB\u52A0\u6807\u9898\u6587\u6848")]),_:1})])]),_:1})]),_:1})]),_:1}),e(g,{label:"\u7279\u6548",prop:"type"},{default:t(()=>[e(de,{modelValue:i(c).type,"onUpdate:modelValue":o[3]||(o[3]=r=>i(c).type=r)},{default:t(()=>[e(V,{value:"Online activities",name:"type"},{default:t(()=>[f(" \u81EA\u52A8\u65CB\u8F6C ")]),_:1}),e(V,{value:"Promotion activities",name:"type"},{default:t(()=>[f(" \u65CB\u8F6C ")]),_:1}),e(V,{value:"Offline activities",name:"type"},{default:t(()=>[f(" \u7F29\u653E ")]),_:1}),e(V,{value:"Simple brand exposure",name:"type"},{default:t(()=>[f(" \u955C\u50CF ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"\u5E7F\u544A\u6587\u6848"},{default:t(()=>[e(C,{placeholder:"\u955C\u50CF\u4E2D\u51FA\u73B0\u7684\u5546\u5BB6\u5E7F\u544A\u4FE1\u606F\uFF0C\u6BD4\u5982logo\u4FE1\u606F\u4E4B\u7C7B",resize:"none",style:{width:"50%"}})]),_:1}),e(g,{label:"\u7D20\u6750\u7BA1\u7406"},{default:t(()=>[n("div",Qe,[e(_,{type:"primary",onClick:Q,icon:"Plus",style:{position:"absolute",right:"20px",top:"-30px"}},{default:t(()=>[f("\u6DFB\u52A0\u7D20\u6750")]),_:1}),n("div",We,[(h(!0),v($,null,z(i(I),(r,u)=>(h(),v("div",{key:u,style:{display:"flex","align-items":"flex-end","flex-direction":"column","align-content":"space-between"}},[n("img",{src:r.cover,class:"cover-image"},null,8,Xe),n("div",Ye,[e(_,{type:"primary",text:"",onClick:()=>W(u)},{default:t(()=>[f("\u5220\u9664")]),_:2},1032,["onClick"])])]))),128)),i(I).length===0?(h(),v("div",Ze,"\u6682\u65E0\u6570\u636E")):B("",!0)])])]),_:1})]),_:1},8,["model"])),[[ge,i(F)]])]),_:1})]),_:1})])]),_:1})]),_:1}),e(fe,{modelValue:i(y),"onUpdate:modelValue":o[5]||(o[5]=r=>xe(y)?y.value=r:null),title:i(G),"append-to-body":"",width:"700px"},{default:t(()=>[n("div",et,[i(m).roleAvatar?(h(),v("img",{key:0,class:"avatar",src:l.imagePathByPath(i(m).roleAvatar)},null,8,tt)):B("",!0),f(" \u89D2\u8272\u80FD\u529B: "+O(i(m).responsibilities),1)]),e(q,{style:{height:"calc(100vh - 400px)"}},{default:t(()=>[n("div",lt,[e(_e,{data:i(S),"node-key":"id","default-expand-all":"","show-checkbox":"","allow-drop":l.allowDrop,"allow-drag":l.allowDrag,onNodeClick:l.handleNodeClick,onNodeContextmenu:l.handleNodeContextMenu,"check-strictly":"",ref_key:"chapterSelectionTree",ref:E},{default:t(({node:r,data:u})=>[n("div",ot,[n("div",at,[n("div",nt,O(r.label),1),n("div",st,[n("span",it,O(u.description),1)])]),n("span",ct,[u.chapterEditor?(h(),M(ue,{key:0,size:20,src:l.imagePathByPath(u.chapterEditorAvatar)},null,8,["src"])):B("",!0)])])]),_:1},8,["data","allow-drop","allow-drag","onNodeClick","onNodeContextmenu"])])]),_:1}),n("div",dt,[e(_,{onClick:o[4]||(o[4]=r=>y.value=!1)},{default:t(()=>[f("\u53D6 \u6D88")]),_:1}),e(_,{type:"primary",onClick:ce},{default:t(()=>[f("\u786E \u5B9A")]),_:1})])]),_:1},8,["modelValue","title"]),e(he,{ref_key:"uploadChildComp",ref:K},null,512),e(me,{ref_key:"globalConfigPanelComp",ref:J},null,512)])}}},ft=ve(rt,[["__scopeId","data-v-8ead92a6"]]);export{ft as default};
