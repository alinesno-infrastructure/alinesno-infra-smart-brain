import{_ as Ce,g as xe,r as s,n as be,a as r,b as D,c as F,d as l,w as o,e as a,l as v,t as S,F as Se,f as ke,y as H,G as we,L as T,u as Ee,E as Ie,K as Ve,I as Ne,P as Ae,p as De,i as $e,J as ze}from"./index.d9d30be3.js";import Be from"./transferAgent.7a5c15ef.js";import{k as Pe,l as Te,g as qe,m as Ge,s as K}from"./longText.4d182a25.js";import"./user.9e8a1ab9.js";const q=k=>(De("data-v-ae24f07d"),k=k(),$e(),k),Le={class:"card-header"},Oe={style:{display:"flex","align-items":"center",gap:"5px"}},Re=q(()=>a("i",{class:"fa-solid fa-file-pdf"},null,-1)),Je={class:"edit-header-avatar"},Me=["src","onClick"],Ue=q(()=>a("i",{class:"fa-solid fa-plus-minus"},null,-1)),je=q(()=>a("i",{class:"fa-solid fa-file-shield"},null,-1)),Fe={class:"chapter-tree-content"},He={class:"custom-tree-node",style:{height:"auto"}},Ke={style:{display:"flex","flex-direction":"column"}},Qe={style:{"font-size":"16px","font-weight":"bold"}},We={class:"description"},Xe={style:{color:"#777"}},Ye={style:{"margin-right":"10px",display:"flex","align-items":"center",gap:"5px"}},Ze={class:"dialog-footer"},et={style:{display:"flex",gap:"20px","align-items":"center"}},tt={style:{"font-weight":"bold"}},lt={style:{"margin-bottom":"10px"}},nt={class:"dialog-footer"},ot={__name:"outlineEditor",emits:["setCurrentSceneInfo","getChannelStreamId","openChatBox","closeShowDebugRunDialog","genChapterContentByAgent","editContent","handleExecuteHandle"],setup(k,{expose:Q,emit:y}){const f=xe(),{proxy:_}=ze(),$=s(f.query.channelStreamId),W=s("\u4F60\u5148\u8FD8\u6CA1\u6709\u751F\u6210\u7AE0\u8282\u5185\u5BB9,\u8BF7\u70B9\u51FB\u667A\u80FD\u4F53\u5934\u50CF\u751F\u6210\u7AE0\u8282\u5185\u5BB9"),G=s(null),w=s(null),d=s({roleAvatar:"",roleName:"",responsibilities:"",email:"zhangsan@example.com"}),g=s([]),C=s(!1);s("");const L=s(!1),z=s([]),O=s("chapter"),u=s({id:0,sceneName:null,sceneDesc:null,sceneCount:0,knowledgeId:null,chapterEditors:[],contentEditors:[]}),x=s(f.query.sceneId),X=s(f.query.genStatus);s([]);const h=s(!1),E=s(null),I=s(""),V=s(""),m=s("");s(!1);const Y=(e,t,i)=>i!=="inner",Z=e=>e.data.id!==1,ee=e=>{console.log("Node clicked: ",e)},R=()=>{h.value=!1,y("openChatBox",d.value.id,m.value)},te=(e,t,i)=>{e.preventDefault(),console.log("Node context menu: ",t,i)},le=e=>{const t={id:Date.now(),label:"\u65B0\u8282\u70B9",description:"\u8282\u70B9\u5185\u5BB9\u63CF\u8FF0\u4FE1\u606F",children:[]};e.children||(e.children=[]),e.children.push(t)},ne=(e,t)=>{const i=e.parent,c=i.data.children||i.data,N=c.findIndex(B=>B.id===t.id);c.splice(N,1)},oe=(e,t)=>{E.value=e,V.value=t.description,I.value=e.label,C.value=!0},ae=(e,t)=>{y("editContent",e,t)},se=()=>{E.value&&(E.value.data.label=I.value,E.value.data.description=V.value,Ie.success("\u7F16\u8F91\u6210\u529F"),C.value=!1)},ie=async(e,t)=>{m.value=t,d.value.id=e,x.value=Ve("sceneId"),await ce()},ce=async()=>{if(!m.value){_.$modal.msgError("\u8BF7\u8F93\u5165\u6D88\u606F\u5185\u5BB9.");return}if(console.log("channelStreamId = "+$.value),!$.value){_.$modal.msgError("\u8BF7\u5148\u521B\u5EFA\u573A\u666F.");return}w.value=Ne.service({lock:!0,text:"\u4EFB\u52A1\u6267\u884C\u4E2D\uFF0C\u8BF7\u52FF\u64CD\u4F5C\u5176\u5B83\u754C\u9762 ...",background:"rgba(0, 0, 0, 0.2)"});let e={sceneId:x.value,channelStreamId:$.value,message:m.value,roleId:d.value.id};const t=await Pe(e);console.log("response = "+t),_.$modal.msgSuccess("\u53D1\u9001\u6210\u529F"),h.value=!1,m.value="",Array.prototype.push.apply(g.value,t.data),J(),me()},re=()=>{const e={id:Date.now(),label:`\u7B2C${g.value.length+1}\u7AE0`,description:"\u8282\u70B9\u5185\u5BB9\u63CF\u8FF0\u4FE1\u606F",children:[]};g.value.push(e)};function de(e){h.value=!0,console.log("selectChaterGenerator"),d.value=e,d.value.email="zhangsan@example.com"}function ue(e){L.value=!0,console.log("configAgent"),O.value=e;const t=e=="chapter"?"\u9009\u62E9\u5927\u7EB2\u751F\u6210\u4E13\u5458":"\u9009\u62E9\u5185\u5BB9\u751F\u6210\u4E13\u5458";e==="chapter"?z.value=u.value.chapterEditors.map(i=>i.id):e==="content"&&(z.value=u.value.contentEditors.map(i=>i.id)),G.value.handleOpendAgent(t,z.value)}function pe(e){L.value=!1,Te(x.value,e,O.value).then(t=>{_.$modal.msgSuccess("\u66F4\u65B0\u6210\u529F"),b()})}function b(){qe(x.value).then(e=>{u.value=e.data,g.value=e.data.chapterTree,y("setCurrentSceneInfo",e.data),u.value.genStatus==0&&X.value&&Ae.confirm("\u68C0\u6D4B\u5230\u751F\u6210\u6307\u4EE4["+u.value.chapterPromptContent+"]\u662F\u5426\u8981\u751F\u6210\u7AE0\u8282\u5927\u7EB2\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{Ge(x.value,1).then(i=>{d.value=u.value.chapterEditors[0],m.value=u.value.chapterPromptContent,R()})}).catch(()=>{console.log("\u7528\u6237\u53D6\u6D88\u4E86\u751F\u6210\u7AE0\u8282\u64CD\u4F5C")})})}const me=()=>{const e=JSON.stringify(g.value,null,2);K(e,f.query.sceneId).then(t=>{_.$modal.msgSuccess("\u4FDD\u5B58\u6210\u529F"),b(),y("genChapterContentByAgent")})},ge=()=>{const e=JSON.stringify(g.value,null,2);K(e,f.query.sceneId).then(t=>{_.$modal.msgSuccess("\u4FDD\u5B58\u6210\u529F"),b()})},J=()=>{console.log("child method. "+w.value),w.value&&w.value.close(),y("closeShowDebugRunDialog")};return Q({closeStreamDialog:J,handleGetScene:b,genStreamContentByMessage:ie,configAgent:ue}),be(()=>{console.log("sceneId = "+f.query.sceneId),b()}),(e,t)=>{const i=r("el-tooltip"),c=r("el-button"),N=r("el-avatar"),B=r("el-popconfirm"),ve=r("el-tree"),fe=r("el-scrollbar"),M=r("el-card"),P=r("el-input"),U=r("el-form-item"),_e=r("el-form"),j=r("el-dialog"),he=r("el-col"),ye=r("el-row");return D(),F("div",null,[l(M,{class:"box-card",shadow:"never"},{header:o(()=>[a("div",Le,[a("div",Oe,[Re,v(" "+S(u.value.sceneName)+" ",1),(D(!0),F(Se,null,ke(u.value.chapterEditors,(n,p)=>(D(),H(i,{key:p,class:"box-item",effect:"dark",content:n.roleName,placement:"top"},{default:o(()=>[a("span",Je,[a("img",{src:e.imagePathByPath(n.roleAvatar),onClick:A=>de(n)},null,8,Me)])]),_:2},1032,["content"]))),128))]),a("span",null,[l(i,{class:"box-item",effect:"dark",content:"\u6DFB\u52A0\u7AE0\u8282",placement:"top"},{default:o(()=>[l(c,{type:"primary",text:"",bg:"",size:"large",onClick:re},{default:o(()=>[Ue,v(" \xA0 \u6DFB\u52A0 ")]),_:1})]),_:1}),l(i,{class:"box-item",effect:"dark",content:"\u4FDD\u5B58\u7AE0\u8282",placement:"top"},{default:o(()=>[l(c,{type:"success",text:"",bg:"",size:"large",onClick:ge},{default:o(()=>[je,v(" \xA0 \u4FDD\u5B58 ")]),_:1})]),_:1})])])]),default:o(()=>[l(fe,{style:{height:"calc(100vh - 180px)"}},{default:o(()=>[a("div",Fe,[l(ve,{data:g.value,"node-key":"id","default-expand-all":"",draggable:"","empty-text":W.value,"allow-drop":Y,"allow-drag":Z,onNodeClick:ee,onNodeContextmenu:te},{default:o(({node:n,data:p})=>[a("div",He,[a("div",Ke,[a("div",Qe,S(n.label),1),a("div",We,[a("span",Xe,S(p.description),1)])]),a("span",Ye,[p.chapterEditor?(D(),H(N,{key:0,size:20,src:e.imagePathByPath(p.chapterEditorAvatar),style:{"margin-right":"10px"}},null,8,["src"])):we("",!0),l(c,{type:"text",icon:"Plus",bg:"",size:"mini",onClick:T(A=>le(p),["stop"])},null,8,["onClick"]),l(c,{type:"text",icon:"Edit",bg:"",size:"mini",onClick:T(A=>oe(n,p),["stop"])},null,8,["onClick"]),l(c,{type:"text",icon:"EditPen",bg:"",size:"mini",onClick:T(A=>ae(n,p),["stop"])},null,8,["onClick"]),l(B,{title:"\u786E\u8BA4\u8981\u5220\u9664\u7AE0\u8282\u4E48?",onConfirm:A=>ne(n,p)},{reference:o(()=>[l(c,{type:"text",icon:"Delete",bg:"",size:"mini"})]),_:2},1032,["onConfirm"])])])]),_:1},8,["data","empty-text"])])]),_:1})]),_:1}),l(j,{title:"\u7F16\u8F91\u8282\u70B9",modelValue:C.value,"onUpdate:modelValue":t[4]||(t[4]=n=>C.value=n),width:"900px"},{default:o(()=>[l(_e,{"label-width":"80px",size:"large"},{default:o(()=>[l(U,{label:"\u8282\u70B9\u540D\u79F0"},{default:o(()=>[l(P,{modelValue:I.value,"onUpdate:modelValue":t[0]||(t[0]=n=>I.value=n),placeholder:"\u8BF7\u8F93\u5165\u8282\u70B9\u540D\u79F0"},null,8,["modelValue"])]),_:1}),l(U,{label:"\u8282\u70B9\u63CF\u8FF0"},{default:o(()=>[l(P,{type:"textarea",rows:5,resize:"none",modelValue:V.value,"onUpdate:modelValue":t[1]||(t[1]=n=>V.value=n),placeholder:"\u8BF7\u8F93\u5165\u8282\u70B9\u63CF\u8FF0"},null,8,["modelValue"])]),_:1})]),_:1}),a("div",Ze,[l(c,{onClick:t[2]||(t[2]=n=>C.value=!1)},{default:o(()=>[v("\u53D6 \u6D88")]),_:1}),l(c,{type:"primary",onClick:t[3]||(t[3]=n=>se())},{default:o(()=>[v("\u786E \u8BA4")]),_:1})])]),_:1},8,["modelValue"]),l(j,{title:"\u7531\u4EE5\u4E0B\u5DE5\u7A0B\u5E08\u751F\u6210\u5927\u7EB2",modelValue:h.value,"onUpdate:modelValue":t[8]||(t[8]=n=>h.value=n),width:"600px"},{default:o(()=>[l(M,{class:"person-card",shadow:"never"},{default:o(()=>[a("div",et,[a("div",null,[l(N,{size:60,src:e.imagePathByPath(d.value.roleAvatar)},null,8,["src"])]),a("div",null,[a("h2",tt,S(d.value.roleName),1),l(ye,null,{default:o(()=>[l(he,{span:24},{default:o(()=>[a("div",lt,S(d.value.responsibilities),1)]),_:1})]),_:1})])])]),_:1}),l(P,{size:"large",modelValue:m.value,"onUpdate:modelValue":t[5]||(t[5]=n=>m.value=n),placeholder:"\u8BF7\u8F93\u51FA\u9488\u5BF9\u4E8E\u672C\u7AE0\u8282\u5185\u5BB9\u7684\u4E00\u4E9B\u81EA\u5B9A\u4E49\u8981\u6C42"},null,8,["modelValue"]),a("div",nt,[l(c,{size:"large",onClick:t[6]||(t[6]=n=>h.value=!1)},{default:o(()=>[v("\u53D6 \u6D88")]),_:1}),l(c,{size:"large",type:"primary",onClick:t[7]||(t[7]=n=>R())},{default:o(()=>[v("\u751F\u6210\u5927\u7EB2")]),_:1})])]),_:1},8,["modelValue"]),l(Ee(Be),{ref_key:"transferAgentPanel",ref:G,onHandleCloseAgentConfig:pe},null,512)])}}},rt=Ce(ot,[["__scopeId","data-v-ae24f07d"]]);export{rt as default};
