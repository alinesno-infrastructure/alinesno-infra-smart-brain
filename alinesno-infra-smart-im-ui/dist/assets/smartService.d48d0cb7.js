import{r as o,o as ie,Q as ce,j as de,a as h,C as re,b as y,c as k,e as n,d as s,w as l,u as w,l as E,t as R,G as U,D as ue,h as pe,ae as fe,K as N,I as K,J as he,af as ge,n as O}from"./index.d9d30be3.js";import ve from"./chatList.a798cd67.js";import me from"./chatUploadFile.b91e52f4.js";import _e from"./smartServiceAgent.af3282b9.js";import be from"./agentTaskFlow.e65e6f25.js";import ye from"./chatMessageEditor.d2d25d40.js";import{c as ke,s as A,a as we}from"./robot.d131c4e4.js";import{h as Ce,o as xe}from"./chatsse.0657b2ca.js";import{S as Me}from"./snowflake-id.35ef5390.js";import"./index.23422e4c.js";import"./roleChat.91ed275b.js";import"./speaking.fcefe2d3.js";import"./roleAgent.624ff91b.js";import"./roleAgentStore.66d91e5d.js";import"./store.b23b57b8.js";import"./user.9e8a1ab9.js";import"./index.79cc8ea8.js";/* empty css                                                                          */const Se={class:"acp-dashboard aip-chat-dashboard-panel"},Ie={class:"smart-container"},Le={class:"robot-chat-windows"},Ve={class:"robot-chat-header"},Ee={class:"chat-header-title"},Re=["src"],Ue={class:"chat-header-desc"},Ne={class:"chat-header-desc",style:{float:"right","margin-top":"-10px",display:"flex"}},De={key:0},Te={key:0,src:"http://data.linesno.com/dataset_icons/docx.webp",style:{width:"30px",margin:"5px"}},Be={key:1,src:"http://data.linesno.com/dataset_icons/pdf.webp",style:{width:"30px",margin:"5px"}},$e=n("i",{class:"fa-solid fa-truck-fast icon-btn"},null,-1),Pe={class:"robot-chat-body"},ze={class:"robot-chat-footer chat-container",style:{float:"left",width:"100%"}},He={class:"message-input-box"},Ke={class:"message-input"},Oe={class:"message-btn-box"},Ae=n("i",{class:"fa-solid fa-feather icon-btn"},null,-1),Fe=n("i",{class:"fa-solid fa-file-word icon-btn"},null,-1),Ge=n("div",{class:"aigen-text-warning"}," \u5185\u5BB9\u7531\u7B2C\u4E09\u65B9 AI \u751F\u6210\uFF0C\u65E0\u6CD5\u786E\u4FDD\u771F\u5B9E\u51C6\u786E\uFF0C\u4EC5\u4F9B\u53C2\u8003 ",-1),Je=n("br",null,null,-1),je={class:"dialog-footer"},ft={__name:"smartService",setup(Qe){const F=new Me,C=o(F.generate()),g=o(null),p=o(),G=pe(),{proxy:J}=he(),M=o(!1),D=o("");o(!0);const x=o(!1),m=o(!1),T=o(null),S=o([]),I=o([]),_=o([]),B=o([]),$=o(null),c=o(""),r=o({}),L=o([]),j=e=>{if(e.length==0){_.value=[],L.value=[{}];return}_.value.length!=0&&(B.value=e.filter(t=>!_.value.some(a=>a.id===t.id)),Q(B.value)),_.value=e,L.value=e.map(t=>({value:t.roleName,label:t.roleName,id:t.id}))},Q=e=>{e.forEach(t=>{const a=t.greeting?t.greeting:`\u60A8\u597D\uFF0C\u6211\u662F${t.roleName}`;t.greeting=a,ke(t,r.value.id).then(u=>{const i={roleId:t.id,icon:t.roleAvatar,name:t.roleName,chatText:a,loading:!1,readerType:"html",businessId:t.id,status:"completed"};p.value.pushResponseMessageList(i)})})},q=(e,t)=>{console.log(e,t),S.value.push(e)},W=()=>{x.value=!1,m.value=!1},b=e=>{if(!c.value){J.$modal.msgError("\u8BF7\u8F93\u5165\u6D88\u606F\u5185\u5BB9.");return}const t=fe(c.value,_.value);p.value.pushMessageList(t),X(c.value,e),c.value="",S.value=[],I.value=[]};function X(e,t){let a=N("channel"),u=S.value.map(i=>i.id);g.value=K.service({lock:!0,text:"\u4EFB\u52A1\u6267\u884C\u4E2D\uFF0C\u8BF7\u52FF\u64CD\u4F5C\u5176\u5B83\u754C\u9762 ...",background:"rgba(0, 0, 0, 0.2)"}),A(e,u,I.value,a,t,C.value).then(i=>{console.log("\u53D1\u9001\u6D88\u606F",i.data),i.data.forEach(f=>{p.value.pushResponseMessageList(f)})}).catch(i=>{g.value.close()})}function Y(e){let t=N("channel"),a=[e.roleId],u=[e.messageId],i="function",f=" #"+e.messageId+" ";g.value=K.service({lock:!0,text:"\u4EFB\u52A1\u6267\u884C\u4E2D\uFF0C\u8BF7\u52FF\u64CD\u4F5C\u5176\u5B83\u754C\u9762 ...",background:"rgba(0, 0, 0, 0.2)"}),A(f,a,u,t,i).then(v=>{console.log("\u53D1\u9001\u6D88\u606F",v.data),v.data.forEach(V=>{p.value.pushResponseMessageList(V)})}).catch(v=>{g.value.close()})}function P(e){p.value.pushResponseMessageList(e)}function Z(){T.value.handleOpenUpload(!0)}const ee=e=>{c.value+=e},te=e=>{I.value.push(e)};function se(e){e&&(M.value=!0,we(e).then(t=>{const a=t.data;p.value.currentResponseMessageList(a),ne(C.value),M.value=!1}))}function ae(e){x.value=!0,D.value=e}function oe(e){e&&ge(e).then(t=>{r.value=t.data,O(()=>{$.value.setChannelInfo(r.value)})})}function ne(e){O(()=>{if(e){let t=xe(e);console.log("channelStreamId = "+e+"\u8FDE\u63A5\u6210\u529F.."),t.onmessage=function(a){if(a.data.includes("[DONE]"))console.log("\u6D88\u606F\u63A5\u6536\u7ED3\u675F."),g.value&&g.value.close();else{let u=a.data;if(u!="ping"){const i=JSON.parse(u);P(i)}}}}})}function z(e){if(!c.value){console.log("\u7A7A\u6D88\u606F,\u4E0D\u5904\u7406.");return}e.ctrlKey&&e.keyCode==13?(b("send"),c.value=""):e.altKey&&e.keyCode==13?(b("modify"),c.value=""):e.shiftKey&&e.keyCode==13&&(b("function"),c.value="")}return ie(()=>{window.addEventListener("keydown",z)}),ce(()=>{window.removeEventListener("keydown",z,!1),Ce(C.value).then(e=>{console.log("\u5173\u95EDsse\u8FDE\u63A5\u6210\u529F:"+C.value)})}),de(()=>G.currentRoute.value.path,e=>{const t=N("channel");oe(t),se(t)},{immediate:!0,deep:!0}),(e,t)=>{const a=h("el-button"),u=h("el-mention"),i=h("svg-icon"),f=h("el-tooltip"),v=h("el-col"),V=h("el-row"),H=h("el-dialog"),le=re("loading");return y(),k("div",Se,[n("div",Ie,[s(V,null,{default:l(()=>[s(v,{span:19},{default:l(()=>[n("div",Le,[n("div",Ve,[n("div",Ee,[n("img",{class:"aip-chat-box-title-img",src:e.imagePath(r.value)},null,8,Re),E(" "+R(r.value.channelName),1)]),n("div",Ue," ("+R(e.truncateString(r.value.channelDesc,30))+") ",1),n("div",Ne,[r.value.knowledgeType?(y(),k("div",De,[r.value.knowledgeType.includes("docx")?(y(),k("img",Te)):U("",!0),r.value.knowledgeType.includes("pdf")?(y(),k("img",Be)):U("",!0)])):U("",!0),s(a,{type:"primary",text:"",bg:"",size:"large",onClick:t[0]||(t[0]=d=>m.value=!0)},{default:l(()=>[$e]),_:1})])]),ue((y(),k("div",Pe,[s(w(ve),{ref_key:"chatListRef",ref:p,onSendMessageToChatBox:ee,onExecutorMessage:Y,onHandleSelectPreBusinessId:te,onHandleEditorContent:ae},null,512)])),[[le,M.value]]),n("div",ze,[n("div",He,[n("div",Ke,[s(u,{size:"large",class:"input-chat-box",modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=d=>c.value=d),options:L.value,prefix:["@"],placeholder:"\u8F93\u5165@\u53EF\u6307\u5B9A\u89D2\u8272, #\u53EF\u6307\u5B9A\u8F93\u51FA\u7ED3\u679C",onSelect:q},{label:l(({item:d})=>[E(R(d.label),1)]),_:1},8,["modelValue","options"])])]),n("div",Oe,[s(f,{class:"box-item",effect:"dark",content:"\u786E\u8BA4\u53D1\u9001\u6307\u4EE4\u7ED9Agent\uFF0C\u5FEB\u6377\u952E\uFF1AEnter+Ctrl",placement:"top"},{default:l(()=>[s(a,{type:"danger",text:"",bg:"",size:"large",onClick:t[2]||(t[2]=d=>b("send"))},{default:l(()=>[s(i,{"icon-class":"send",class:"icon-btn",style:{"font-size":"25px"}})]),_:1})]),_:1}),s(f,{class:"box-item",effect:"dark",content:"\u6267\u884C\u4EFB\u52A1",placement:"top"},{default:l(()=>[s(a,{type:"warning",text:"",bg:"",size:"large",onClick:t[3]||(t[3]=d=>b("function"))},{default:l(()=>[Ae]),_:1})]),_:1}),s(f,{class:"box-item",effect:"dark",content:"\u4E0A\u4F20\u6587\u6863\u6587\u4EF6",placement:"top"},{default:l(()=>[s(a,{type:"primary",text:"",bg:"",size:"large",onClick:Z},{default:l(()=>[Fe]),_:1})]),_:1})])]),Ge])]),_:1}),s(v,{span:5,class:"chat-agent-right-panel"},{default:l(()=>[s(w(_e),{ref_key:"smartServiceAgentRef",ref:$,onMentionUser:j},null,512)]),_:1})]),_:1})]),s(H,{modelValue:m.value,"onUpdate:modelValue":t[5]||(t[5]=d=>m.value=d),title:"\u9891\u9053\u4EFB\u52A1\u8FD0\u884C\u72B6\u6001",width:"60%","before-close":W,"destroy-on-close":"","append-to-body":""},{footer:l(()=>[n("span",je,[s(a,{type:"warning",onClick:t[4]||(t[4]=d=>m.value=!1)},{default:l(()=>[E("\u5173\u95ED")]),_:1})])]),default:l(()=>[Je,s(w(be))]),_:1},8,["modelValue"]),s(w(me),{ref_key:"uploadChildComp",ref:T,onHandlePushResponseMessageList:P},null,512),s(H,{modelValue:x.value,"onUpdate:modelValue":t[6]||(t[6]=d=>x.value=d),title:"\u4EFB\u52A1\u5185\u5BB9\u7F16\u8F91",width:"60%","destroy-on-close":"","append-to-body":""},{default:l(()=>[s(w(ye),{businessId:D.value},null,8,["businessId"])]),_:1},8,["modelValue"])])}}};export{ft as default};
