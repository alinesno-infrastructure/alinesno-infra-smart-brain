import{_ as Ee,r as s,B as Ne,a as u,C as Re,b as v,c as P,d as o,w as n,e as r,l as f,F as Be,f as Pe,y as A,u as c,D as se,G as re,t as G,H,g as Ve,E as L,n as S,I as ce,p as Te,i as ze,J as Oe}from"./index.d9d30be3.js";import $e from"./chapterEditor.825739e6.js";import Ue from"./sceneUploadFile.b3801e78.js";import Ae from"./outlineEditor.a5a770eb.js";import Ge from"./chatPanel.7a6ad93a.js";import He from"./executeHandle.b9ea7b42.js";import{a as Le,b as Je,c as Me,d as Ke,e as de,f as je,g as qe,h as Fe,i as We,j as Qe}from"./longText.4d182a25.js";import"./index.79cc8ea8.js";import"./transferAgent.7a5c15ef.js";import"./user.9e8a1ab9.js";import"./index.23422e4c.js";import"./speaking.fcefe2d3.js";import"./userQuestionSuggestionsPanel.cb0efdab.js";import"./roleChat.91ed275b.js";import"./chatsse.0657b2ca.js";const I=D=>(Te("data-v-975ea8b2"),D=D(),ze(),D),Xe={class:"app-container",style:{"background-color":"#fff","padding-top":"10px","padding-left":"0px !important"}},Ye={class:"chapter-edit"},Ze={class:"card-header"},et={style:{display:"flex","align-items":"center",gap:"5px"}},tt={class:"edit-header-avatar"},lt=["src","onClick"],ot=I(()=>r("i",{class:"fa-solid fa-ferry"},null,-1)),at=I(()=>r("i",{class:"fa-brands fa-firefox-browser"},null,-1)),nt=I(()=>r("i",{class:"fa-solid fa-floppy-disk"},null,-1)),st=I(()=>r("i",{class:"fa-solid fa-display"},null,-1)),rt={class:"user-info"},ct=["src"],dt={class:"chapter-tree-content"},it={class:"custom-tree-node",style:{height:"auto"}},ut={style:{display:"flex","flex-direction":"column"}},pt={style:{"font-size":"16px","font-weight":"bold",color:"#333"}},ht={class:"description"},ft={style:{color:"#777"}},_t={style:{"margin-right":"10px",display:"flex","align-items":"center",gap:"5px"}},mt={class:"dialog-footer"},gt={class:"aip-flow-drawer"},vt={style:{"margin-top":"0px"}},Ct={class:"document-wrapper"},yt=["src"],xt={class:"word-download-button"},bt=I(()=>r("i",{class:"el-icon-download"},null,-1)),wt={__name:"textParser",setup(D){const J=Ve(),{proxy:M}=Oe(),K=s({}),j=s(J.query.channelStreamId),q=s(!1),F=s(""),C=s(!1),V=s(null),p=s(null),E=s(null),h=s(!1),y=s(null),W=s(null),x=s(null),ie=s(null),N=s(null),m=s(null),g=s(J.query.sceneId),T=s(0),b=s(!1),z=s(""),O=s(""),w=s(!1),Q=s(null),ue=()=>{if(w.value){L.warning("\u6B63\u5728\u4E0B\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u540E...");return}b.value=!1,z.value="",O.value=""},X=s({roleAvatar:"",roleName:"\u5F20\u4E09",responsibilities:"\u4E3B\u8981\u8D1F\u8D23\u4E0E\u5BA2\u6237\u8FDB\u884C\u6C9F\u901A\uFF0C\u89E3\u7B54\u5BA2\u6237\u5173\u4E8E\u4EA7\u54C1\u7684\u5404\u79CD\u7591\u95EE\uFF0C\u63D0\u4F9B\u4E13\u4E1A\u7684\u54A8\u8BE2\u670D\u52A1\uFF0C\u4EE5\u5E2E\u52A9\u5BA2\u6237\u66F4\u597D\u5730\u7406\u89E3\u548C\u4F7F\u7528\u4EA7",email:"zhangsan@example.com"}),d=Ne({id:0,title:"",description:"",content:""}),R=s([]),pe=()=>{console.log("\u63D0\u4EA4\u7684\u6570\u636E:",d);let e={id:d.id,title:d.title,content:x.value.getData()};Le(e).then(t=>{L.success("\u4FDD\u5B58"+d.title+"\u6210\u529F\uFF01")})};function Y(){z.value="\u663E\u793A\u6587\u6863\u5217\u8868",b.value=!0,w.value=!0,Je(g.value).then(e=>{const t=e.data;Q.value=t,S(async()=>{const a=await Me(t);console.log("response.data:"+a),O.value=window.URL.createObjectURL(a),w.value=!1})})}function Z(e){K.value=e,R.value=e.chapterTree}const he=e=>{F.value="\u8BF7\u9009\u62E9["+e.roleName+"]\u9700\u8981\u7F16\u8F91\u7684\u7AE0\u8282",X.value=e,X.value.email="zhangsan@example.com",p.value=e,p.value.selectedChapters=[],C.value=!0,S(()=>{Ke(e.id,g.value).then(t=>{if(t.data){let a=t.data.map(l=>l.id);console.log("selectKey = "+a),V.value.setCheckedKeys(a)}})})},fe=async()=>{if(!d.id){L.error("\u8BF7\u5148\u9009\u62E9\u6307\u5B9A\u7AE0\u8282\uFF01");return}m.value=ce.service({lock:!0,background:"rgba(255, 255, 255, 0.2)",customClass:"custom-loading"}),h.value=!0;let e="\u6B63\u5728\u91CD\u65B0\u751F\u6210\u3010"+d.title+"\u3011\u5185\u5BB9\uFF0C\u8BF7\u7A0D\u7B49.";m.value.setText(e);let t={sceneId:g.value,channelStreamId:j.value,chapterTitle:d.title,chapterDescription:d.description,chapterId:d.id};S(()=>{y.value.openChatBox(E.value,t.chapterTitle)});const a=await de(t);x.value.setData(a.data),m.value.close(),h.value=!1},_e=async()=>{console.log("\u5F00\u59CB\u751F\u6210\u5168\u90E8\u7AE0\u8282\u5185\u5BB9\u901A\u8FC7\u89D2\u8272 = genChapterContentByAgent"),je(g.value).then(e=>{qe(g.value).then(t=>{Z(t.data),ee(),h.value=!0})})},me=()=>{const e=y.value.getChannelStreamId();return console.log("getChannelStreamId = "+e),e},ee=async()=>{try{T.value=te(R.value),console.log("\u6587\u6863\u603B\u6570\u91CF = "+T.value);const e=[],t=a=>{for(let l of a)console.log("--->>> node = "+JSON.stringify(l)),e.push(l),l.children&&l.children.length&&t(l.children)};t(R.value),m.value=ce.service({lock:!0,background:"rgba(255, 255, 255, 0.5)",customClass:"custom-loading"}),h.value=!0;for(let a=0;a<e.length;a++){const l=e[a];console.log("\u8282\u70B9 = "+JSON.stringify(l)),console.log(`\u8282\u70B9 ${a+1}: ID = ${l.id}, Label = ${l.label}`);let $=` ${a+1}: \u7AE0\u8282:${l.label}`+" \u4EFB\u52A1\u751F\u6210\u4E2D\uFF0C\u8FD8\u6709\u3010"+(T.value-a)+"\u3011\u7BC7";m.value.setText($),d.title=l.label;let B={sceneId:g.value,channelStreamId:j.value,chapterTitle:l.label,chapterDescription:l.description,chapterId:l.id};S(()=>{console.log("--->> editorRoleId = "+l.chapterEditor),y.value.openChatBox(l.chapterEditor,l.label)});const U=await de(B);x.value.setData(U.data)}}catch(e){console.error("Error fetching data:",e),M.$modal.msgError("\u751F\u6210\u5931\u8D25"),m.value.close()}m.value.close(),h.value=!1,Y()},te=e=>{let t=0;for(let a of e)t++,a.children&&a.children.length&&(t+=te(a.children));return t},ge=(e,t)=>{console.log("node = "+JSON.stringify(e.data)),console.log("data = "+t);let a=t.id;E.value=e.data.chapterEditor,console.log("editorRoleId = "+E.value),d.id=t.id,d.title=e.label,d.chapterEditor=e.chapterEditor,d.description=e.data.description,Fe(a).then(l=>{console.log("res = "+JSON.stringify(l)),x.value.setData(l.data==null?"":l.data,E.value),q.value=!1})},ve=()=>{const e=V.value.getCheckedNodes(!1,!0);console.log("newChapterIds= "+e);const t=e.map(l=>l.id);console.log("newChapterIds = "+t),p.value.selectedChapters=[...new Set([...p.value.selectedChapters,...t])],console.log("currentUser.value.selectedChapters="+p.value.selectedChapters);let a={sceneId:g.value,roleId:p.value.id,chapters:p.value.selectedChapters};We(a).then(l=>{console.log(l),M.$modal.msgSuccess("\u5206\u914D\u6210\u529F"),C.value=!1,N.value.handleGetScene()})},Ce=()=>{console.log("handleGetScene"),N.value.handleGetScene()},ye=e=>{console.log("currentSceneInfo = "+e),W.value.handleOpen(e)},le=(e,t)=>{h.value=!0,console.log("roleId = "+e+" , message = "+t),S(()=>{y.value.openChatBox(e,t),N.value.genStreamContentByMessage(e,t),console.log("-->>> \u7F16\u5199\u4EFB\u52A1\u5B8C\u6210")})},xe=()=>{Qe(Q.value).then(e=>{window.open(e.data)})},be=()=>{h.value=!1};return(e,t)=>{const a=u("el-col"),l=u("el-tooltip"),_=u("el-button"),$=u("el-input"),B=u("el-form-item"),U=u("el-form"),we=u("el-card"),ke=u("el-row"),Se=u("el-avatar"),Ie=u("el-tree"),oe=u("el-scrollbar"),ae=u("el-dialog"),De=u("el-drawer"),ne=Re("loading");return v(),P("div",Xe,[o(ke,null,{default:n(()=>[o(a,{span:10},{default:n(()=>[o(Ae,{ref_key:"OutlineEditorRef",ref:N,onOpenChatBox:le,onHandleExecuteHandle:ye,onHandleGetChannelStreamId:me,onCloseShowDebugRunDialog:be,onGenChapterContentByAgent:_e,onSetCurrentSceneInfo:Z,onEditContent:ge},null,512)]),_:1}),o(a,{span:14},{default:n(()=>[r("div",Ye,[o(we,{class:"box-card",shadow:"never"},{header:n(()=>[r("div",Ze,[r("div",et,[f(" \u7AE0\u8282\u7F16\u8F91 "),(v(!0),P(Be,null,Pe(c(K).contentEditors,(i,k)=>(v(),A(l,{key:k,class:"box-item",effect:"dark",content:i.roleName,placement:"top"},{default:n(()=>[r("span",tt,[r("img",{src:e.imagePathByPath(i.roleAvatar),onClick:kt=>he(i)},null,8,lt)])]),_:2},1032,["content"]))),128))]),r("div",null,[o(l,{class:"box-item",effect:"dark",content:"\u6267\u884C\u6587\u6863\u751F\u6210",placement:"top"},{default:n(()=>[o(_,{type:"primary",text:"",bg:"",size:"large",onClick:t[0]||(t[0]=i=>ee())},{default:n(()=>[ot,f("\xA0 \u751F\u6210\u6587\u6863 ")]),_:1})]),_:1}),o(l,{class:"box-item",effect:"dark",content:"\u91CD\u65B0\u751F\u6210\u7AE0\u8282",placement:"top"},{default:n(()=>[o(_,{type:"primary",text:"",bg:"",size:"large",onClick:t[1]||(t[1]=i=>fe())},{default:n(()=>[at,f("\xA0 \u91CD\u65B0\u751F\u6210 ")]),_:1})]),_:1}),o(l,{class:"box-item",effect:"dark",content:"\u4FDD\u5B58\u7AE0\u8282",placement:"top"},{default:n(()=>[o(_,{type:"primary",text:"",bg:"",size:"large",onClick:pe},{default:n(()=>[nt,f("\xA0 \u4FDD\u5B58 ")]),_:1})]),_:1}),o(l,{class:"box-item",effect:"dark",content:"\u9884\u89C8\u5BFC\u51FA\u6587\u6863",placement:"top"},{default:n(()=>[o(_,{type:"primary",text:"",bg:"",size:"large",onClick:Y},{default:n(()=>[st,f("\xA0 \u9884\u89C8 ")]),_:1})]),_:1})])])]),default:n(()=>[se((v(),A(U,{model:c(d),"label-width":"100px","label-position":"top"},{default:n(()=>[o(B,null,{default:n(()=>[o($,{disabled:"disabled",modelValue:c(d).title,"onUpdate:modelValue":t[2]||(t[2]=i=>c(d).title=i),placeholder:"\u5728\u6267\u884C\u5F53\u4E2D\u7684\u7AE0\u8282\u540D\u79F0"},null,8,["modelValue"])]),_:1}),o(B,{label:"\u7AE0\u8282\u5185\u5BB9",class:"chapter-content"},{default:n(()=>[o(c($e),{ref_key:"chapterEditorRef",ref:x},null,512)]),_:1})]),_:1},8,["model"])),[[ne,c(q)]])]),_:1})])]),_:1})]),_:1}),o(ae,{modelValue:c(C),"onUpdate:modelValue":t[4]||(t[4]=i=>H(C)?C.value=i:null),title:c(F),"append-to-body":"",width:"700px"},{default:n(()=>[r("div",rt,[c(p).roleAvatar?(v(),P("img",{key:0,class:"avatar",src:e.imagePathByPath(c(p).roleAvatar)},null,8,ct)):re("",!0),f(" \u89D2\u8272\u80FD\u529B: "+G(c(p).responsibilities),1)]),o(oe,{style:{height:"calc(100vh - 400px)"}},{default:n(()=>[r("div",dt,[o(Ie,{data:c(R),"node-key":"id","default-expand-all":"","show-checkbox":"","allow-drop":e.allowDrop,"allow-drag":e.allowDrag,onNodeClick:e.handleNodeClick,onNodeContextmenu:e.handleNodeContextMenu,"check-strictly":"",ref_key:"chapterSelectionTree",ref:V},{default:n(({node:i,data:k})=>[r("div",it,[r("div",ut,[r("div",pt,G(i.label),1),r("div",ht,[r("span",ft,G(k.description),1)])]),r("span",_t,[k.chapterEditor?(v(),A(Se,{key:0,size:20,src:e.imagePathByPath(k.chapterEditorAvatar)},null,8,["src"])):re("",!0)])])]),_:1},8,["data","allow-drop","allow-drag","onNodeClick","onNodeContextmenu"])])]),_:1}),r("div",mt,[o(_,{size:"large",onClick:t[3]||(t[3]=i=>C.value=!1)},{default:n(()=>[f("\u53D6 \u6D88")]),_:1}),o(_,{type:"primary",size:"large",onClick:ve},{default:n(()=>[f("\u786E \u5B9A")]),_:1})])]),_:1},8,["modelValue","title"]),o(Ue,{ref_key:"uploadChildComp",ref:ie},null,512),o(c(He),{ref_key:"executeHandleRef",ref:W,onOpenChatBox:le,onHandleGetScene:Ce},null,512),r("div",gt,[o(De,{modelValue:c(h),"onUpdate:modelValue":t[5]||(t[5]=i=>H(h)?h.value=i:null),modal:!1,size:"40%",style:{"max-width":"700px"},title:"\u9884\u89C8\u4E0E\u8C03\u8BD5","with-header":!0},{default:n(()=>[r("div",vt,[o(c(Ge),{ref_key:"roleChatPanelRef",ref:y},null,512)])]),_:1},8,["modelValue"])]),o(ae,{modelValue:c(b),"onUpdate:modelValue":t[6]||(t[6]=i=>H(b)?b.value=i:null),title:c(z),width:"1300px","before-close":ue,"show-close":!0},{default:n(()=>[se((v(),P("div",Ct,[o(oe,{class:"scrollable-area",style:{height:"calc(70vh)","margin-top":"20px","padding-right":"0px"}},{default:n(()=>[r("iframe",{src:c(O),style:{position:"absolute",width:"100%","border-radius":"5px",height:"100%",border:"0px","padding-bottom":"10px",background:"#323639"}},`
                `,8,yt)]),_:1})])),[[ne,c(w)]]),r("div",xt,[o(_,{type:"primary",size:"large",loading:c(w),onClick:xe},{default:n(()=>[bt,f(" \u4E0B\u8F7DWord\u6587\u6863 ")]),_:1},8,["loading"])])]),_:1},8,["modelValue","title"])])}}},Gt=Ee(wt,[["__scopeId","data-v-975ea8b2"]]);export{Gt as default};
