import{r as fe,u as he,a as ge}from"./roleChat.91ed275b.js";import{s as me}from"./speaking.fcefe2d3.js";import{Z as ve,Y as ye,_ as J,r as M,o as le,V as _e,a as k,b as B,y as te,w as C,c as x,e as _,u as Q,d as y,G as U,E as F,p as re,i as ce,x as ne,U as ae,j as K,l as T,S as N,t as E,F as oe,f as se,B as we,R as be}from"./index.d9d30be3.js";var ue={exports:{}},de={exports:{}};/*!
 * 
 * js-audio-recorder - js audio recorder plugin
 * 
 * @version v1.0.7
 * @homepage https://github.com/2fps/recorder
 * @author 2fps <echoweb@126.com> (https://www.zhuyuntao.cn)
 * @license MIT
 *         
 */(function(A,L){(function(w,f){A.exports=f()})(ve,function(){return function(w){var f={};function l(a){if(f[a])return f[a].exports;var t=f[a]={i:a,l:!1,exports:{}};return w[a].call(t.exports,t,t.exports,l),t.l=!0,t.exports}return l.m=w,l.c=f,l.d=function(a,t,o){l.o(a,t)||Object.defineProperty(a,t,{enumerable:!0,get:o})},l.r=function(a){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},l.t=function(a,t){if(1&t&&(a=l(a)),8&t||4&t&&typeof a=="object"&&a&&a.__esModule)return a;var o=Object.create(null);if(l.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:a}),2&t&&typeof a!="string")for(var e in a)l.d(o,e,function(n){return a[n]}.bind(null,e));return o},l.n=function(a){var t=a&&a.__esModule?function(){return a.default}:function(){return a};return l.d(t,"a",t),t},l.o=function(a,t){return Object.prototype.hasOwnProperty.call(a,t)},l.p="",l(l.s=1)}([function(w,f,l){function a(t,o,e){for(var n=0;n<e.length;n++)t.setUint8(o+n,e.charCodeAt(n))}Object.defineProperty(f,"__esModule",{value:!0}),f.compress=function(t,o,e){for(var n=o/e,p=Math.max(n,1),u=t.left,r=t.right,s=Math.floor((u.length+r.length)/n),c=new Float32Array(s),d=0,b=0;d<s;){var i=Math.floor(b);c[d]=u[i],d++,r.length&&(c[d]=r[i],d++),b+=p}return c},f.encodePCM=function(t,o,e){e===void 0&&(e=!0);var n=0,p=t.length*(o/8),u=new ArrayBuffer(p),r=new DataView(u);if(o===8)for(var s=0;s<t.length;s++,n++){var c=(d=Math.max(-1,Math.min(1,t[s])))<0?128*d:127*d;c=+c+128,r.setInt8(n,c)}else for(s=0;s<t.length;s++,n+=2){var d=Math.max(-1,Math.min(1,t[s]));r.setInt16(n,d<0?32768*d:32767*d,e)}return r},f.encodeWAV=function(t,o,e,n,p,u){u===void 0&&(u=!0);var r=e>o?o:e,s=p,c=new ArrayBuffer(44+t.byteLength),d=new DataView(c),b=n,i=0;a(d,i,"RIFF"),i+=4,d.setUint32(i,36+t.byteLength,u),a(d,i+=4,"WAVE"),a(d,i+=4,"fmt "),i+=4,d.setUint32(i,16,u),i+=4,d.setUint16(i,1,u),i+=2,d.setUint16(i,b,u),i+=2,d.setUint32(i,r,u),i+=4,d.setUint32(i,b*r*(s/8),u),i+=4,d.setUint16(i,b*(s/8),u),i+=2,d.setUint16(i,s,u),a(d,i+=2,"data"),i+=4,d.setUint32(i,t.byteLength,u),i+=4;for(var g=0;g<t.byteLength;)d.setUint8(i,t.getUint8(g)),i++,g++;return d}},function(w,f,l){var a,t=this&&this.__extends||(a=function(u,r){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var d in c)c.hasOwnProperty(d)&&(s[d]=c[d])})(u,r)},function(u,r){function s(){this.constructor=u}a(u,r),u.prototype=r===null?Object.create(r):(s.prototype=r.prototype,new s)});Object.defineProperty(f,"__esModule",{value:!0});var o=l(2),e=l(0),n=l(3),p=function(u){function r(s){s===void 0&&(s={});var c=u.call(this,s)||this;return c.isrecording=!1,c.ispause=!1,c.isplaying=!1,c}return t(r,u),r.prototype.setOption=function(s){s===void 0&&(s={}),this.setNewOption(s)},r.prototype.start=function(){return this.isrecording?Promise.reject():(this.isrecording=!0,this.startRecord())},r.prototype.pause=function(){this.isrecording&&!this.ispause&&(this.ispause=!0,this.pauseRecord())},r.prototype.resume=function(){this.isrecording&&this.ispause&&(this.ispause=!1,this.resumeRecord())},r.prototype.stop=function(){this.isrecording&&(this.isrecording=!1,this.ispause=!1,this.stopRecord())},r.prototype.play=function(){this.stop(),this.isplaying=!0,this.onplay&&this.onplay(),n.default.addPlayEnd(this.onplayend);var s=this.getWAV();s.byteLength>44&&n.default.play(s.buffer)},r.prototype.getPlayTime=function(){return n.default.getPlayTime()},r.prototype.pausePlay=function(){!this.isrecording&&this.isplaying&&(this.isplaying=!1,this.onpauseplay&&this.onpauseplay(),n.default.pausePlay())},r.prototype.resumePlay=function(){this.isrecording||this.isplaying||(this.isplaying=!0,this.onresumeplay&&this.onresumeplay(),n.default.resumePlay())},r.prototype.stopPlay=function(){this.isrecording||(this.isplaying=!1,this.onstopplay&&this.onstopplay(),n.default.stopPlay())},r.prototype.destroy=function(){return n.default.destroyPlay(),this.destroyRecord()},r.prototype.getRecordAnalyseData=function(){return this.getAnalyseData()},r.prototype.getPlayAnalyseData=function(){return n.default.getAnalyseData()},r.prototype.getPCM=function(){this.stop();var s=this.getData();return s=e.compress(s,this.inputSampleRate,this.outputSampleRate),e.encodePCM(s,this.oututSampleBits,this.littleEdian)},r.prototype.getPCMBlob=function(){return new Blob([this.getPCM()])},r.prototype.downloadPCM=function(s){s===void 0&&(s="recorder");var c=this.getPCMBlob();o.downloadPCM(c,s)},r.prototype.getWAV=function(){var s=this.getPCM();return e.encodeWAV(s,this.inputSampleRate,this.outputSampleRate,this.config.numChannels,this.oututSampleBits,this.littleEdian)},r.prototype.getWAVBlob=function(){return new Blob([this.getWAV()],{type:"audio/wav"})},r.prototype.downloadWAV=function(s){s===void 0&&(s="recorder");var c=this.getWAVBlob();o.downloadWAV(c,s)},r.prototype.download=function(s,c,d){o.download(s,c,d)},r.prototype.getChannelData=function(){var s=this.getPCM(),c=s.byteLength,d=this.littleEdian,b={left:null,right:null};if(this.config.numChannels===2){var i=new DataView(new ArrayBuffer(c/2)),g=new DataView(new ArrayBuffer(c/2));if(this.config.sampleBits===16)for(var m=0;m<c/2;m+=2)i.setInt16(m,s.getInt16(2*m,d),d),g.setInt16(m,s.getInt16(2*m+2,d),d);else for(m=0;m<c/2;m+=2)i.setInt8(m,s.getInt8(2*m)),g.setInt8(m,s.getInt8(2*m+1));b.left=i,b.right=g}else b.left=s;return b},r}(l(5).default);f.default=p},function(w,f,l){function a(t,o,e){var n=document.createElement("a");n.href=window.URL.createObjectURL(t),n.download=o+"."+e,n.click()}Object.defineProperty(f,"__esModule",{value:!0}),f.downloadWAV=function(t,o){o===void 0&&(o="recorder"),a(t,o,"wav")},f.downloadPCM=function(t,o){o===void 0&&(o="recorder"),a(t,o,"pcm")},f.download=function(t,o,e){return a(t,o,e)}},function(w,f,l){Object.defineProperty(f,"__esModule",{value:!0});var a=l(4),t=null,o=0,e=0,n=null,p=null,u=null,r=!1,s=0,c=function(){};function d(){return r=!1,n.decodeAudioData(u.slice(0),function(g){(t=n.createBufferSource()).onended=function(){r||(s=n.currentTime-e+o,c())},t.buffer=g,t.connect(p),p.connect(n.destination),t.start(0,o),e=n.currentTime},function(g){a.throwError(g)})}function b(){t&&(t.stop(),t=null)}var i=function(){function g(){}return g.play=function(m){return n||(n=new(window.AudioContext||window.webkitAudioContext),(p=n.createAnalyser()).fftSize=2048),this.stopPlay(),u=m,s=0,d()},g.pausePlay=function(){b(),o+=n.currentTime-e,r=!0},g.resumePlay=function(){return d()},g.stopPlay=function(){o=0,u=null,b()},g.destroyPlay=function(){this.stopPlay()},g.getAnalyseData=function(){var m=new Uint8Array(p.frequencyBinCount);return p.getByteTimeDomainData(m),m},g.addPlayEnd=function(m){m===void 0&&(m=function(){}),c=m},g.getPlayTime=function(){var m=r?o:n.currentTime-e+o;return s||m},g}();f.default=i},function(w,f,l){Object.defineProperty(f,"__esModule",{value:!0}),f.throwError=function(a){throw new Error(a)}},function(w,f,l){Object.defineProperty(f,"__esModule",{value:!0});var a=l(0),t=function(){function o(e){e===void 0&&(e={}),this.size=0,this.lBuffer=[],this.rBuffer=[],this.tempPCM=[],this.inputSampleBits=16,this.fileSize=0,this.duration=0,this.needRecord=!0;var n,p=new(window.AudioContext||window.webkitAudioContext);this.inputSampleRate=p.sampleRate,this.setNewOption(e),this.littleEdian=(n=new ArrayBuffer(2),new DataView(n).setInt16(0,256,!0),new Int16Array(n)[0]===256),o.initUserMedia()}return o.prototype.setNewOption=function(e){e===void 0&&(e={}),this.config={sampleBits:~[8,16].indexOf(e.sampleBits)?e.sampleBits:16,sampleRate:~[8e3,11025,16e3,22050,24e3,44100,48e3].indexOf(e.sampleRate)?e.sampleRate:this.inputSampleRate,numChannels:~[1,2].indexOf(e.numChannels)?e.numChannels:1},this.outputSampleRate=this.config.sampleRate,this.oututSampleBits=this.config.sampleBits},o.prototype.startRecord=function(){var e=this;return this.context&&this.destroyRecord(),this.initRecorder(),navigator.mediaDevices.getUserMedia({audio:!0}).then(function(n){e.audioInput=e.context.createMediaStreamSource(n),e.stream=n}).then(function(){e.audioInput.connect(e.analyser),e.analyser.connect(e.recorder),e.recorder.connect(e.context.destination)})},o.prototype.pauseRecord=function(){this.needRecord=!1},o.prototype.resumeRecord=function(){this.needRecord=!0},o.prototype.stopRecord=function(){this.audioInput&&this.audioInput.disconnect(),this.source&&this.source.stop(),this.recorder.disconnect(),this.analyser.disconnect(),this.needRecord=!0},o.prototype.destroyRecord=function(){return this.clearRecordStatus(),this.stopStream(),this.closeAudioContext()},o.prototype.getAnalyseData=function(){var e=new Uint8Array(this.analyser.frequencyBinCount);return this.analyser.getByteTimeDomainData(e),e},o.prototype.getData=function(){return this.flat()},o.prototype.clearRecordStatus=function(){this.lBuffer.length=0,this.rBuffer.length=0,this.size=0,this.fileSize=0,this.PCM=null,this.audioInput=null,this.duration=0},o.prototype.flat=function(){var e=null,n=new Float32Array(0);this.config.numChannels===1?e=new Float32Array(this.size):(e=new Float32Array(this.size/2),n=new Float32Array(this.size/2));for(var p=0,u=0;u<this.lBuffer.length;u++)e.set(this.lBuffer[u],p),p+=this.lBuffer[u].length;for(p=0,u=0;u<this.rBuffer.length;u++)n.set(this.rBuffer[u],p),p+=this.rBuffer[u].length;return{left:e,right:n}},o.prototype.initRecorder=function(){var e=this;this.clearRecordStatus(),this.context=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.context.createAnalyser(),this.analyser.fftSize=2048;var n=this.context.createScriptProcessor||this.context.createJavaScriptNode;this.recorder=n.apply(this.context,[4096,this.config.numChannels,this.config.numChannels]),this.recorder.onaudioprocess=function(p){if(e.needRecord){var u,r=p.inputBuffer.getChannelData(0),s=null;e.lBuffer.push(new Float32Array(r)),e.size+=r.length,e.config.numChannels===2&&(s=p.inputBuffer.getChannelData(1),e.rBuffer.push(new Float32Array(s)),e.size+=s.length),e.fileSize=Math.floor(e.size/Math.max(e.inputSampleRate/e.outputSampleRate,1))*(e.oututSampleBits/8),u=100*Math.max.apply(Math,r),e.duration+=4096/e.inputSampleRate,e.onprocess&&e.onprocess(e.duration),e.onprogress&&e.onprogress({duration:e.duration,fileSize:e.fileSize,vol:u})}}},o.prototype.stopStream=function(){this.stream&&this.stream.getTracks&&(this.stream.getTracks().forEach(function(e){return e.stop()}),this.stream=null)},o.prototype.closeAudioContext=function(){return this.context&&this.context.close&&this.context.state!=="closed"?this.context.close():new Promise(function(e){e()})},o.initUserMedia=function(){navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(e){var n=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return n?new Promise(function(p,u){n.call(navigator,e,p,u)}):Promise.reject(new Error("\u6D4F\u89C8\u5668\u4E0D\u652F\u6301 getUserMedia !"))})},o.prototype.transformIntoPCM=function(e,n){var p=new Float32Array(e),u=new Float32Array(n),r=a.compress({left:p,right:u},this.inputSampleRate,this.outputSampleRate);return a.encodePCM(r,this.oututSampleBits,this.littleEdian)},o.getPermission=function(){return this.initUserMedia(),navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){e&&e.getTracks().forEach(function(n){return n.stop()})})},o}();f.default=t}]).default})})(de);(function(A){A.exports=de.exports})(ue);const Ce=ye(ue.exports);const pe=A=>(re("data-v-7c74bffa"),A=A(),ce(),A),Be={key:0,style:{"margin-right":"10px",display:"flex"}},xe=["src"],Ae=pe(()=>_("i",{class:"fa-solid fa-headset icon-btn"},null,-1)),Se=pe(()=>_("i",{class:"fa-solid fa-microphone-lines icon-btn"},null,-1)),Me={__name:"aiVoiceInput",props:{roleId:{type:Number,default:0},role:{type:Object}},emits:["sendAudioToBackend"],setup(A,{emit:L}){const w=A,f=M(!1),l=M(!1),a=new Ce({sampleBits:16,sampleRate:16e3,numChannels:1}),t=M({duration:0,fileSize:0,vol:0}),o=M({start:0,isGo:!1});a.onprogress=c=>{t.value={duration:c.duration,fileSize:c.fileSize,vol:c.vol}};const e=async()=>{l.value=!l.value,a.start().then(()=>{o.value.start=1,o.value.isGo=!0}).catch(c=>{console.log("\u5F55\u97F3\u9519\u8BEF",c),F.error("\u5F55\u97F3\u5931\u8D25")})},n=()=>{l.value=!1,o.value.start=0,a.stop(),a.stopPlay(),p()},p=async()=>{var m,D;console.log("recorder.getWAVBlob() = "+a.getWAVBlob()),console.log("stat.value = "+t.value);const c=a.getWAVBlob();if(!c){console.error("\u83B7\u53D6\u7684\u97F3\u9891\u6570\u636E\u4E3A\u7A7A");return}const d="whisper.wav";new File([c],d,{type:"audio/wav"});var b=new Blob([c],{type:"audio/wav"}),i=new File([b],new Date().getTime()+".wav");(m=t.value)==null||m.duration;var g=new FormData;g.append("roleId",w.role.id),g.append("act","gpt.whisper"),g.append("prompt","whisper"),g.append("duration",(D=t.value)==null?void 0:D.duration),g.append("file",i),await u(g),t.value={duration:0,fileSize:0,vol:0}},u=async c=>{f.value=!0;const d=await fe(c);f.value=!1,console.log("response = "+d.data),d.data?L("sendAudioToBackend",d.data):F.error("\u5F55\u97F3\u8BC6\u522B\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5\u6216\u8005\u786E\u8BA4\u9EA6\u514B\u98CE\u6B63\u5E38.")},r=c=>{c.ctrlKey&&c.key==="b"&&!l.value&&e()},s=c=>{c.ctrlKey&&c.key==="b"&&l.value&&n()};return le(()=>{window.addEventListener("keydown",r),window.addEventListener("keyup",s)}),_e(()=>{window.removeEventListener("keydown",r),window.removeEventListener("keyup",s)}),(c,d)=>{const b=k("el-button"),i=k("el-tooltip");return B(),te(i,{class:"box-item",effect:"dark",content:"\u8BED\u97F3\u8F93\u5165",placement:"top"},{default:C(()=>[l.value?(B(),x("span",Be,[_("img",{src:Q(me),style:{width:"35px"}},null,8,xe),y(b,{type:"primary",text:"",bg:"",size:"large",onClick:n},{default:C(()=>[Ae]),_:1})])):U("",!0),l.value?U("",!0):(B(),te(b,{key:1,type:"primary",size:"large",text:"",bg:"",onClick:e,loading:f.value},{default:C(()=>[Se]),_:1},8,["loading"]))]),_:1})}}},ut=J(Me,[["__scopeId","data-v-7c74bffa"]]);const ke=A=>(re("data-v-cbefd242"),A=A(),ce(),A),Pe={style:{width:"100%"}},Re={key:0,class:"chat-fileds-reference"},Fe={class:"reference-panel"},Ue={class:"file-info"},De=ke(()=>_("i",{class:"fa-solid fa-paperclip"},null,-1)),Ie={class:"file-remove"},ze={key:1,class:"chat-attachment-wrapper"},Le=["onMouseenter","onMouseleave"],$e={class:"file-header"},Oe={class:"file-info"},Ve={class:"file-name"},je={class:"file-details"},Te={key:2,class:"chat-attachment-actions"},Ee={key:1},We=ne({name:"ChatAttachmentPanel"}),Ne=Object.assign(We,{emits:["updateChatWindowHeight","sendAttachmentActions"],setup(A,{expose:L,emit:w}){const f=M(null),l=M([]),a=M(null),t=M(!1),o=M(!1),e=M({}),n=M(null),p=M(null),u=h=>{switch(h){case"pdf":return"fa-solid fa-file-pdf";case"ppt":return"fa-solid fa-file-powerpoint";case"xlsx":return"fa-solid fa-file-excel";case"docx":case"doc":return"fa-solid fa-file-word";case"jpg":case"png":case"gif":return"fa-solid fa-file-image";case"mp4":return"fa-solid fa-file-video";case"mp3":return"fa-solid fa-file-audio";default:return"fa-solid fa-file-question"}},r=h=>{l.value.splice(h,1),i()},s=h=>{e.value[h]=!0},c=h=>{e.value[h]=!1},d=()=>{a.value.scrollBy({left:-200,behavior:"smooth"})},b=()=>{a.value.scrollBy({left:200,behavior:"smooth"})},i=()=>{if(a.value){const{scrollLeft:h,scrollWidth:v,clientWidth:R}=a.value;t.value=h>0,o.value=h<v-R}l.value.length>0?w("updateChatWindowHeight",360):p.value?w("updateChatWindowHeight",306):w("updateChatWindowHeight",0)},g=h=>{if(l.value.some(v=>v.uploading)){F.warning("\u8BF7\u7B49\u5F85\u6240\u6709\u6587\u4EF6\u4E0A\u4F20\u5B8C\u6210");return}w("sendAttachmentActions",h)},m=ae(()=>{var h;return((h=p.value)==null?void 0:h.type)==="image"||l.value.some(v=>v.type==="image")}),D=ae(()=>{var v;const h=["pdf","word","ppt","excel"];return h.includes((v=p.value)==null?void 0:v.type)||l.value.some(R=>h.includes(R.type))}),Y=h=>{if(l.value.length>0){F.warning("\u5F15\u7528\u4E0E\u4E0A\u4F20\u6587\u4EF6\u4E0D\u80FD\u540C\u65F6\u5B58\u5728");return}h.type=I(h.extension),p.value=h,w("updateChatWindowHeight",305)},Z=()=>{p.value=null,w("updateChatWindowHeight",260)},X=h=>{const v=h.target.files;if(!v||v.length===0)return;if(!n.value.enable){F.warning("\u5F53\u524D\u4E0D\u5141\u8BB8\u4E0A\u4F20\uFF0C\u8BF7\u68C0\u67E5\u4E0A\u4F20\u8BBE\u7F6E");return}let R=[];for(const P of v){const O=P.name.split(".").pop().toLowerCase(),V=I(O);if(V==="image"){if(n.value.imageUploadLimit===0){F.warning("\u5F53\u524D\u4E0D\u5141\u8BB8\u4E0A\u4F20\u56FE\u7247\uFF0C\u8BF7\u68C0\u67E5\u4E0A\u4F20\u8BBE\u7F6E");return}}else if(n.value.fileUploadLimit===0){F.warning("\u5F53\u524D\u4E0D\u5141\u8BB8\u4E0A\u4F20\u6587\u4EF6\uFF0C\u8BF7\u68C0\u67E5\u4E0A\u4F20\u8BBE\u7F6E");return}let q=0,H=0;for(const j of l.value)I(j.extension)==="image"?H++:q++;if(V==="image"){if(H>=n.value.imageUploadLimit){F.warning(`\u6700\u591A\u53EA\u80FD\u4E0A\u4F20 ${n.value.imageUploadLimit} \u5F20\u56FE\u7247`);continue}}else if(q>=n.value.fileUploadLimit){F.warning(`\u6700\u591A\u53EA\u80FD\u4E0A\u4F20 ${n.value.fileUploadLimit} \u4E2A\u6587\u4EF6`);continue}R.push(P)}if(R.length===0)return;const S=[];for(const P of R){const O=P.name.split(".").pop().toLowerCase(),V=$(P.size);S.push(we({id:-1,name:P.name,extension:O,size:V,wordCount:"\u65E0",type:I(O),uploading:!1,uploadProgress:0,file:P}))}l.value.push(...S),i(),S.forEach(P=>ee(P))},ee=h=>{h.uploading=!0,h.uploadProgress=0;const v=new FormData;v.append("file",h.file),he(v).then(R=>{const S=R.data;h.id=S.id,h.wordCount=S.wordCount||"\u65E0",h.uploading=!1,F.success("\u6587\u4EF6\u4E0A\u4F20\u6210\u529F")}).catch(R=>{h.uploading=!1,F.error(`\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25\uFF1A${R.message}`)})},I=h=>{switch(h){case"pdf":return"pdf";case"ppt":case"pptx":return"ppt";case"xlsx":case"xls":return"excel";case"docx":case"doc":return"word";case"jpg":case"jpeg":case"png":case"gif":return"image";case"mp4":return"video";case"mp3":return"audio";default:return"unknown"}},$=h=>{if(h===0)return"0 Bytes";const v=1024,R=["Bytes","KB","MB","GB"],S=Math.floor(Math.log(h)/Math.log(v));return parseFloat((h/Math.pow(v,S)).toFixed(2))+" "+R[S]},G=h=>{if(!h){F.warning("\u5F53\u524D\u4E0A\u4F20\u672A\u914D\u7F6E\uFF0C\u8BF7\u5148\u8FDB\u914D\u7F6E\u4E0A\u4F20\u8BBE\u7F6E");return}if(p.value){F.warning("\u5F15\u7528\u4E0E\u4E0A\u4F20\u6587\u4EF6\u4E0D\u80FD\u540C\u65F6\u5B58\u5728");return}if(console.log("uploadData = "+JSON.stringify(h)),n.value=h,!n.value.enable){F.warning("\u5F53\u524D\u4E0D\u5141\u8BB8\u4E0A\u4F20\uFF0C\u8BF7\u68C0\u67E5\u4E0A\u4F20\u8BBE\u7F6E");return}if(n.value.imageUploadLimit===0){const v=f.value;v.accept=v.accept.replace("image/*, ","")}f.value.click()};return K(l,()=>{setTimeout(()=>{i()},0)}),L({openFileSelector:G,setReferenceFile:Y,handleGetUploadFiles:()=>{const h=l.value.map(v=>v.id);return l.value=[],i(),[...h,p.value?p.value.id:null]}}),(h,v)=>{const R=k("CloseBold"),S=k("el-icon"),P=k("el-button"),O=k("el-tooltip"),V=k("ArrowLeftBold"),q=k("CircleCloseFilled"),H=k("ArrowRightBold"),j=k("Right");return B(),x("div",Pe,[p.value?(B(),x("div",Re,[_("div",Fe,[_("div",Ue,[_("span",null,[De,T(),_("i",{class:N(u(p.value.extension))},null,2)]),_("span",null,E(p.value.name),1)]),_("div",Ie,[y(O,{class:"box-item",effect:"dark",content:"\u56DE\u7B54\u95EE\u9898\u5C06\u4E0D\u518D\u4EC5\u4EC5\u56F4\u7ED5\u9644\u4EF6\u8FDB\u884C\u56DE\u7B54",placement:"top"},{default:C(()=>[y(P,{onClick:v[0]||(v[0]=z=>Z()),size:"default",text:""},{default:C(()=>[y(S,null,{default:C(()=>[y(R)]),_:1})]),_:1})]),_:1})])])])):U("",!0),_("input",{ref_key:"fileInput",ref:f,type:"file",multiple:"",accept:"image/*, application/pdf, application/vnd.ms-powerpoint, application/vnd.openxmlformats-officedocument.presentationml.presentation, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document",onChange:X,style:{display:"none"}},null,544),l.value.length!=0?(B(),x("div",ze,[t.value?(B(),x("button",{key:0,onClick:d,class:"scroll-button left"},[y(S,null,{default:C(()=>[y(V)]),_:1})])):U("",!0),_("div",{ref_key:"containerRef",ref:a,class:"chat-attachment-container"},[(B(!0),x(oe,null,se(l.value,(z,W)=>(B(),x("div",{key:W,class:"file-item",onMouseenter:ie=>s(W),onMouseleave:ie=>c(W)},[_("div",$e,[_("span",null,[z.uploading?U("",!0):(B(),x("i",{key:0,class:N(u(z.extension))},null,2)),y(P,{type:"text",text:"",loading:z.uploading},null,8,["loading"])]),_("div",Oe,[_("div",Ve,E(z.name),1),_("div",je,[_("span",null,E(z.size),1)])]),y(P,{class:N({"delete-button":!0,"delete-button-visible":e.value[W]}),onClick:ie=>r(W),size:"default",text:""},{default:C(()=>[y(S,null,{default:C(()=>[y(q)]),_:1})]),_:2},1032,["class","onClick"])])],40,Le))),128))],512),o.value?(B(),x("button",{key:1,onClick:b,class:"scroll-button right"},[y(S,null,{default:C(()=>[y(H)]),_:1})])):U("",!0)])):U("",!0),l.value.length!=0?(B(),x("div",Te,[y(P,{type:"info",size:"small",class:"chat-attachment-action-btn",bg:"",text:"",style:{"margin-right":"10px"},onClick:v[1]||(v[1]=z=>g("\u89E3\u6790\u5185\u5BB9"))},{default:C(()=>[T(" \u89E3\u6790\u5185\u5BB9 "),y(S,null,{default:C(()=>[y(j)]),_:1})]),_:1}),Q(m)?(B(),te(P,{key:0,type:"info",class:"chat-attachment-action-btn",size:"small",bg:"",text:"",onClick:v[2]||(v[2]=z=>g("\u89E3\u6790\u56FE\u7247\u5185\u5BB9"))},{default:C(()=>[T(" \u89E3\u6790\u56FE\u7247\u5185\u5BB9 "),y(S,null,{default:C(()=>[y(j)]),_:1})]),_:1})):U("",!0),Q(D)?(B(),x("div",Ee,[y(P,{type:"info",size:"small",class:"chat-attachment-action-btn",bg:"",text:"",onClick:v[3]||(v[3]=z=>g("\u603B\u7ED3\u8FD9\u4EFD\u6587\u6863\u5185\u5BB9"))},{default:C(()=>[T(" \u603B\u7ED3\u8FD9\u4EFD\u6587\u6863\u5185\u5BB9 "),y(S,null,{default:C(()=>[y(j)]),_:1})]),_:1}),y(P,{type:"info",size:"small",class:"chat-attachment-action-btn",bg:"",text:"",onClick:v[4]||(v[4]=z=>g("\u8BF4\u8BF4\u6587\u6863\u8BB2\u4E86\u4EC0\u4E48"))},{default:C(()=>[T(" \u8BF4\u8BF4\u6587\u6863\u8BB2\u4E86\u4EC0\u4E48 "),y(S,null,{default:C(()=>[y(j)]),_:1})]),_:1})])):U("",!0)])):U("",!0)])}}}),dt=J(Ne,[["__scopeId","data-v-cbefd242"]]);const Qe={class:"chat-attachment-wrapper"},Ge=["onMouseenter","onMouseleave"],qe={class:"file-header"},He={class:"file-info"},Ke={class:"file-name"},Je={class:"file-details"},Ye={key:0,class:"progress-bar"},Ze=ne({name:"ChatAttachmentPanel"}),Xe=Object.assign(Ze,{props:{message:{type:String,default:""}},emits:["handleFileIdToMessageBox"],setup(A,{emit:L}){var b;const f=M((b=A.message)==null?void 0:b.fileAttributeList),l=M(null),a=M(!1),t=M(!1),o=M({}),e=i=>i.includes("pdf")?"fa-solid fa-file-pdf":i.includes("ppt")?"fa-solid fa-file-powerpoint":i.includes("xlsx")?"fa-solid fa-file-excel":i.includes("docx")||i.includes("doc")?"fa-solid fa-file-word":i.includes("jpg")||i.includes("png")||i.includes("gif")?"fa-solid fa-file-image":i.includes("mp4")?"fa-solid fa-file-video":i.includes("mp3")?"fa-solid fa-file-audio":"fa-solid fa-file-question",n=i=>{if(i===0)return"0 Bytes";const g=1024,m=["Bytes","KB","MB","GB"],D=Math.floor(Math.log(i)/Math.log(g));return parseFloat((i/Math.pow(g,D)).toFixed(2))+" "+m[D]},p=i=>{const g=f.value[i];L("handleFileIdToMessageBox",g)},u=i=>{o.value[i]=!0},r=i=>{o.value[i]=!1},s=()=>{l.value.scrollBy({left:-200,behavior:"smooth"})},c=()=>{l.value.scrollBy({left:200,behavior:"smooth"})},d=()=>{if(l.value){const{scrollLeft:i,scrollWidth:g,clientWidth:m}=l.value;a.value=i>0,t.value=i<g-m}};return le(()=>{setTimeout(()=>{d()},0),l.value.addEventListener("scroll",d)}),K(f,()=>{setTimeout(()=>{d()},0)}),(i,g)=>{const m=k("ArrowLeftBold"),D=k("el-icon"),Y=k("Position"),Z=k("el-button"),X=k("el-tooltip"),ee=k("ArrowRightBold");return B(),x("div",null,[_("div",Qe,[a.value?(B(),x("button",{key:0,onClick:s,class:"scroll-button left"},[y(D,null,{default:C(()=>[y(m)]),_:1})])):U("",!0),_("div",{ref_key:"containerRef",ref:l,class:"chat-attachment-container"},[(B(!0),x(oe,null,se(f.value,(I,$)=>(B(),x("div",{key:$,class:"file-item",onMouseenter:G=>u($),onMouseleave:G=>r($)},[_("div",qe,[_("span",null,[_("i",{class:N(e(I.fileType))},null,2)]),_("div",He,[_("div",Ke,E(I.fileName),1),_("div",Je,[_("span",null,E(n(I.length)),1)])]),y(X,{class:"box-item",effect:"dark",content:"\u5F15\u7528\u6587\u6863",placement:"top"},{default:C(()=>[y(Z,{class:N({"delete-button":!0,"delete-button-visible":o.value[$]}),onClick:G=>p($),size:"default",text:""},{default:C(()=>[y(D,null,{default:C(()=>[y(Y)]),_:1})]),_:2},1032,["class","onClick"])]),_:2},1024)]),I.uploading?(B(),x("div",Ye,[_("div",{style:be({width:`${I.uploadProgress}%`}),class:"progress"},null,4)])):U("",!0)],40,Ge))),128))],512),t.value?(B(),x("button",{key:1,onClick:c,class:"scroll-button right"},[y(D,null,{default:C(()=>[y(ee)]),_:1})])):U("",!0)])])}}}),pt=J(Xe,[["__scopeId","data-v-a9d2e8e0"]]);const et={key:0,class:"user-question-suggestions-container"},tt={class:"user-question-suggestions-wrapper"},nt=["onClick"],ot={class:"user-question-suggestions-item"},st=ne({name:"UserQuestionSuggestions"}),it=Object.assign(st,{props:{roleId:{type:Number,default:0},greetingQuestion:{type:Array,default:[]},channelId:{type:Number,default:0},chatStreamLoading:{type:Boolean,default:!1}},emits:["handleUserQuestionSuggestionsClick","initChatBoxScroll"],setup(A,{emit:L}){const w=A,f=M(w.greetingQuestion?w.greetingQuestion:[]),l=()=>{const t={roleId:w.roleId,channelId:w.channelId};ge(t).then(o=>{f.value=o.data,L("initChatBoxScroll")})},a=t=>{L("handleUserQuestionSuggestionsClick",t)};return K(()=>w.chatStreamLoading,(t,o)=>{t||l()}),K(()=>w.greetingQuestion,(t,o)=>{t.length>0&&(f.value=t)}),(t,o)=>{const e=k("Right"),n=k("el-icon");return Q(f).length>0?(B(),x("div",et,[_("div",tt,[(B(!0),x(oe,null,se(Q(f),(p,u)=>(B(),x("div",{key:u,onClick:r=>a(p)},[_("span",ot,[T(E(p)+" ",1),y(n,null,{default:C(()=>[y(e)]),_:1})])],8,nt))),128))])])):U("",!0)}}}),ft=J(it,[["__scopeId","data-v-95dfc3ab"]]);export{ut as A,pt as C,ft as U,dt as a};
