<template>

  <div class="app-container tpl-app">

    <div class="search-container-panel">
      <el-row>
        <el-col :span="24">
          <div class="feature-header-xqbyQk" style="    
    position: relative;
    display: grid;
    grid-template-columns: 1fr minmax(auto, 480px) 1fr;
    gap: 12px;
    width: 100%;">
            <div style="gap: 12px;">
              <h1 style="font-size: 20px; font-weight: 500; font-style: normal; line-height: 32px; color: rgba(var(--coze-fg-4), var(--coze-fg-4-alpha)); margin: 0px 0px 0px 10px; float: left;">
                é¢‘é“å¸‚åœº</h1>
            </div>
            <div class="search-container-weDuEn">
              <el-input
      v-model="input1"
      style="width: 400px"
      size="large"
      placeholder="æœç´¢é¢‘é“"
      :suffix-icon="Search"
    />
            </div>
          </div>
        </el-col>
      </el-row>
    </div>

    <div class="banner-container-panel">
      <el-row>
        <el-col :span="15">

          <div
            style="gap: 0px;margin-left:10px;cursor: pointer;align-items: flex-start;width: 100%;height: 270px;padding: 16px 0;display: inline-flex;flex-direction: column;">
            <div>
              <div style="height: 28px;"><img
                  src="https://lf-coze-web-cdn.coze.cn/obj/coze-web-cn/mf/marketplace/static/image/brand-daily-rec.48709716.png"
                  data-src="https://lf-coze-web-cdn.coze.cn/obj/coze-web-cn/mf/marketplace/static/image/brand-daily-rec.48709716.png"
                  height="28"></div>
              <h1
                style="-webkit-line-clamp: 2;max-height: 112px;margin-bottom: 8px;font-size: 40px;font-weight: 700;line-height: 48px;color: #1D1C23;">
                <span>ğŸª¡æ‹†è§£äº§å“å–ç‚¹ï¼Œæç‚¼æ ¸å¿ƒç‰¹è‰²ï¼Œç¥å™¨åœ¨æ­¤ï¼Œè½¬åŒ–æ— å¿§</span>
              </h1>
              <p style="
    height: 24px;
    margin-bottom: 28px;
    font-size: 16px;
    font-weight: 400;
    line-height: 24px;
    color: rgba(29, 28, 35, 0.6);
"><span>å¿«é€Ÿè®©äº§å“çš„æ ¸å¿ƒä»·å€¼å¾—åˆ°ç”¨æˆ·è®¤å¯ï¼Œå°†å–ç‚¹è½¬åŒ–é¡¾å®¢çš„ä¹°ç‚¹ï¼Œå¿«æ¥ä½“éªŒå§ï¼</span></p>
            </div>
            <el-button type="primary" bg text size="large">
              <span class="semi-button-content" x-semi-prop="children">ç«‹å³èŠèŠ</span>
            </el-button>
          </div>


        </el-col>
        <el-col :span="9">

          <div class="right-container-_0GQ3U"
            style="background-image: url(&quot;https://p9-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/765a47720e944173bbbd678aefbcae0a~tplv-13w3uml6bg-crop-center-v1:160:90.image?rk3s=2e2596fd&amp;x-expires=1731720832&amp;x-signature=06aGzxG4xmlYmTcQjLXvchlLric%3D&quot;); background-repeat: no-repeat; background-size: cover;">
            <img
              src="https://p3-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/765a47720e944173bbbd678aefbcae0a~tplv-13w3uml6bg-crop-center-v1:960:540.image?rk3s=2e2596fd&amp;x-expires=1731720832&amp;x-signature=3mc%2BXg3y33CglmFfKM1ZekRzLA8%3D"
              class="bot-banner-bg-_IItqZ" style="
    width: 100%;
    height: 100%;
    box-shadow: 0 4px 24px 0 rgba(0, 0, 0, 0.12);
">
            <div class=""
              style="gap: 16px;position: absolute;bottom: 0;left: 0;width: 100%;padding: 5px;background: linear-gradient(0deg, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0) 100%);align-items: center;flex-direction: row;display: inline-flex;position: absolute;bottom: 0;left: 0;width: 100%;/* padding: 32px 24px 24px; */background: linear-gradient(0deg, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0) 100%);">
              <span class="" style="
    width: 64px;
    height: 64px;
    background: #f0f0f5;
    border-radius: 8px;
"><img src="https://p6-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/6f8d3536f35a4e9ab28ffccfbb8b12c9~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&amp;x-expires=1731720832&amp;x-signature=YJXYms7Xo1cTrUMOL6TVPo3GSiA%3D"
                  class="" style="
    display: block;
    height: 100%;
    object-fit: cover;
    width: 100%;
"></span>
              <div class="" x-semi-prop="children"
                style="gap: 4px;overflow: hidden;flex: 1;align-items: flex-start;width: 100%;display: inline-flex;flex-direction: column;">
                <p class="" style="
    width: 100%;
    font-size: 10px;
    font-weight: 400;
    font-style: normal;
    line-height: 12px;
    color: #FFF;
    display: block;
    text-overflow: ellipsis;
    white-space: nowrap;
    margin: 0px;
"><span>å•†ä¸šæœåŠ¡</span></p>
                <h1 class="" style="
    width: 100%;
    font-size: 18px;
    font-weight: 600;
    font-style: normal;
    line-height: 24px;
    color: #FFF;
    margin: 0px;
"><span>äº§å“å–ç‚¹æç‚¼ç¥å™¨</span></h1>
                <div class=""
                  style="gap: 4px;flex-shrink: 0;max-width: 100%;height: 18px;margin: 0px;color: rgba(255, 255, 255, 0.39);display: inline-flex;flex-direction: row;">
                  <div class="semi-image avatar-oDHtb3"
                    style="width: 14px;height: 14px;overflow: hidden;border-radius: 12px;"><img
                      src="https://p3-passport.byteacctimg.com/img/user-avatar/2f5f197d9767f138e735359e3822661b~300x300.image"
                      data-src="https://p3-passport.byteacctimg.com/img/user-avatar/2f5f197d9767f138e735359e3822661b~300x300.image"
                      class="semi-image-img" width="14" height="14"></div>
                  <div class="" x-semi-prop="children"
                    style="gap: 2px;flex: 1;font-size: 12px;font-weight: 400;line-height: 18px;"><span class=""
                      style="max-width: 150px;"><span>ç½—æ–‡</span></span></div><span class="" style="
    flex: 1;
    font-size: 12px;
    font-weight: 400;
    line-height: 18px;
"><span>@LUOWEN</span></span>
                </div>
              </div>
            </div>
          </div>

        </el-col>
      </el-row>
    </div>

    <div class="channel-container-panel">
      <el-row>

        <el-col :span="6" v-for="(item, index) in publicChatChannel" :key="index" style="padding:8px;">
          <div class="semi-card-container" @click="enterChannel(item)">
            <div class="semi-space cart-head-continer" style="gap: 16px;">
              <div class="cart-head-content">
                <div class="cart-head-content">
                  <span class="semi-avatar semi-avatar-square">
                    <img :src="imagePath(item)"  class="">
                  </span>
                </div>
              </div>
              <div class="semi-space info-container" style="gap: 6px;">
                <span class="semi-typography card-title">
                  <span>
                    {{ item.channelName }}
                  </span>
                </span>
                <div class="semi-space container-center" style="gap: 6px;">
                  <div class="semi-image avatar-oDHtb3" style="width: 14px; height: 14px;">
                    <img
                      src="https://p3-passport.byteacctimg.com/img/user-avatar/7a7e80566f20a6944faaaa3a010fbff4~300x300.image"
                      class="semi-image-img" width="14" height="14">
                  </div>
                  <div class="semi-space semi-space-align-center semi-space-horizontal" style="gap: 2px;">
                    <span class="semi-typography text" style="max-width: 150px;"><span>éŸ¦æ©W</span></span>
                  </div>
                </div>
                <p class="semi-typography card-desc" style="-webkit-line-clamp: 3;">
                  <span>
                    {{ truncateString(item.channelDesc,65) }}
                  </span>
                </p>
                <div class="semi-space card-tag-list" style="gap: 4px;"></div>
              </div>
            </div>
            <div class="semi-divider semi-divider-horizontal"></div>
            <div class="semi-space" style="height: 20px; width: 100%; gap: 8px;">
              <div class="semi-space semi-space-align-center semi-space-horizontal" x-semi-prop="children"
                style="display: inline-flex;">
                <div class="semi-space card-statics" style="gap: 8px;">
                  <span class="semi-typography text-h6"><i class="fa-solid fa-user-ninja"></i> 1.2K</span>
                  <span class="semi-typography text-h6"><i class="fa-solid fa-link"></i> 2.1K</span>
                  <span class="semi-typography text-h6"><i class="fa-solid fa-pen-nib"></i> 45.3K</span>
                </div>
              </div>
              <div class="platform-container-YOpW3B">
                <div class="semi-space semi-space-align-center semi-space-horizontal" style="gap: 4px;">
                </div>
              </div>
            </div>
          </div>
        </el-col>
      </el-row>
    </div>

    <!-- é¢‘é“èŠå¤© -->
    <el-dialog v-model="dialogVisible" :title="chatTitle" width="80%" :before-close="handleClose">
      <iframe :src="roleChatUri" class="role-chat-iframe"></iframe>
    </el-dialog>

  </div>

</template>

<script setup>

import {
  allMyChannel,
} from '@/api/base/im/channel'
import { ref } from 'vue';

const router = useRouter();
const loading = ref(false)

const publicChatChannel = ref([]);
const recChatChannel = ref([]);

const chatTitle = ref("")
const dialogVisible = ref(false)
const roleChatUri = ref("")

const filterRules = ref([
  {
    "name": "åœºæ™¯", "codeValue": "initializr.admin.project.template.screen", "items": [
      { "code": "screen_code_1", "name": "æ—…æ¸¸é¢„è®¢" },
      { "code": "screen_code_2", "name": "åœ¨çº¿è´­ç‰©" },
      { "code": "screen_code_3", "name": "ç¤¾äº¤åª’ä½“" },
      { "code": "screen_code_4", "name": "å¥èº«å¥åº·" },
      { "code": "screen_code_5", "name": "åœ¨çº¿è§†é¢‘" }
    ]
  },
  {
    "name": "ç±»å‹", "codeValue": "initializr.admin.project.template.type", "items": [
      { "code": "type_code_1", "name": "ç§»åŠ¨åº”ç”¨" },
      { "code": "type_code_2", "name": "ç½‘é¡µåº”ç”¨" },
      { "code": "type_code_4", "name": "ç¤¾äº¤å¹³å°" },
      { "code": "type_code_5", "name": "å¥èº«åº”ç”¨" }
    ]
  }
]);

const demeChannel = ref([])

const data = reactive({
  form: {},
  queryParams: {
    total: 100,
    pageNum: 1,
    pageSize: 8,
    roleName: undefined,
    roleName: undefined,
    responsibilities: undefined,
    status: undefined,
    deptId: undefined
  },
});

const { queryParams } = toRefs(data);

function enterChannel(item) {
  router.push({
    path: '/chat',
    query: { 'channel': item.id }
  })
}

/** æŸ¥è¯¢æ‰€æ‰€æœ‰æˆ‘åœ¨å‚ä¸çš„é¢‘é“ */
function handleAllMyChannel() {
  loading.value = true;
  allMyChannel().then(response => {
    let items = response.data;

    publicChatChannel.value = items; // .filter(item => item.channelType === '9');
    // recChatChannel.value = items.filter(item => item.channelType === '3');

    // æ·»åŠ DemoChannelé¢‘é“
    // publicChatChannel.value = publicChatChannel.value.concat(demeChannel.value);

    loading.value = false;
  })
}

/** ä¸å•ä¸ªé¢‘é“å‘ä¿¡æ¯ */
function handleChannelChat(item) {
  roleChatUri.value = "/channelChat?channel=" + item.id;
  chatTitle.value = item.channelName;
  dialogVisible.value = true;
}

handleAllMyChannel();

</script>
